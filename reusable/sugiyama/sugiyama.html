<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sugiyama Layout with D3.js</title>
    <script src="libs/d3.min.js"></script>
    <script src="libs/d3-shape.min.js"></script>
    <script src="libs/d3-dag.iife.min.js"></script>
    <!-- <script src="js/src/index.js" type="module" defer></script> -->
    <style>
        #graph {
            border: 1px solid black;
            width: 100%;
            height: 800px;
        }

        .boundingBox {
            fill: none;
            stroke: rgba(255, 0, 0, 0.616);
            stroke-width: 1;
        }

        #minimap-container {
            border: 1px solid black;
        }

        #minimap {
            border: 1px solid darkblue;
            background-color: rgb(210, 255, 212);
        }

        .viewport {
            fill: none;
            stroke: rgba(255, 0, 0, 0.616);
            /* stroke-width: 8; */
            cursor: move;
        }

        .drawing_boundary {
            stroke: gray;
            stroke-width: 0.05;
            /* fill: rgba(255, 255, 224, 0.26); */
            fill: rgba(255, 255, 224, 0.86);
        }

        .node {
            stroke: rgba(70, 131, 180, 0.9);
            stroke-width: 0.05;
            /* fill: steelblue;             */
            fill: rgba(70, 131, 180, 0.9);
            cursor: zoom-in;
        }

        .edge {
            stroke: #ccc;
            stroke-width: 2px;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .marker {
            stroke: #ccc;
            stroke-width: 4px;
            fill: none;
            /* marker-end: url(#arrowhead); */
        }

        .label {
            font-size: 12px;
            text-anchor: middle;
            fill: white;
        }

        .connection-point {
            fill: rgb(70, 130, 180, 0.8);
            stroke: rgb(154, 169, 182);
            /* stroke: rgba(70, 131, 180, 0.5); */
        }
    </style>
</head>

<body>
    <h1 id="pageTitle">Title to be replaced with filename</h1>
    <script>
        // Separate block for handling the h1 content (page title and filename)
        (function () {
            // Function to get the filename from the URL
            function getFilename() {
                const path = window.location.pathname;
                const filename = path.substring(path.lastIndexOf('/') + 1);
                return filename || 'index.html'; // Default to 'index.html' if no filename
            }

            // Set the content of the h1 tag to the page title and filename
            const pageTitle = document.title;
            const filename = getFilename();
            document.getElementById('pageTitle').textContent = `${pageTitle} - ${filename}`;
        })();
    </script>

    <label for="horizontalCheckbox">Horizontal</label>
    <input type="checkbox" id="horizontalCheckbox">
    <!-- Dropdown to select JSON file -->
    <label for="fileSelect">Select JSON file:</label>
    <select id="fileSelect"></select>
    <script>
        // Simulating an array of JSON filenames from the data folder
        const jsonFiles = ["dwh-1.json", "dwh-2.json", "dwh-3.json", "dwh-4.json", "dwh-5.json", "dwh-6.json", "dwh-7a.json", "dwh-7b.json", "dwh-7.json", "dwh-8.json"];

        // Populate the dropdown menu with the JSON filenames
        const fileSelect = document.getElementById("fileSelect");
        jsonFiles.forEach(filename => {
            const option = document.createElement("option");
            option.value = filename;
            option.text = filename;
            fileSelect.appendChild(option);
        });
    </script>
    <label for="curveCheckbox">Curve</label>
    <input type="checkbox" id="curveCheckbox" checked>

    <div>
        <svg id="graph"></svg>
    </div>
    <div id="zoom-controls">
        <button id="zoom-in">Zoom In</button>
        <button id="zoom-out">Zoom Out</button>
        <button id="zoom-reset">Reset Zoom</button>
        <button id="zoom-random">Random Zoom</button>
        <button id="zoom-node">Zoom Node</button>
    </div>

    <div id="minimap-container">
        <svg id="minimap" width="200" height="200"></svg>
    </div>

    <script type="module">
        // Add an event listener to update the horizontal variable when the checkbox changes
        const checkbox = document.getElementById('horizontalCheckbox');
        checkbox.addEventListener('change', function () {
            horizontal = this.checked;

            const layout = { horizontal: horizontal, lineGenerator: lineGenerator, isEdgeCurved: isEdgeCurved };
            // Initial layout computation and drawing
            dashboard = FD.Layout.computeAndDraw(dag, mainView, minimap, layout);
        });

        let horizontal = checkbox.checked; // Default to horizontal layout

        const curveCheckbox = document.getElementById('curveCheckbox');
        let isEdgeCurved = curveCheckbox.checked; // Default to horizontal layout

        curveCheckbox.addEventListener('change', function () {
            isEdgeCurved = this.checked;
            lineGenerator = getLineGenerator();
            console.log("isEdgeCurved", isEdgeCurved);

            const layout = { horizontal: horizontal, lineGenerator: lineGenerator, isEdgeCurved: isEdgeCurved };
            // Initial layout computation and drawing
            dashboard = FD.Layout.computeAndDraw(dag, mainView, minimap, layout);
        });

        let selectedFile = jsonFiles[1]; // Default to the first JSON file

        // Event listener to update selected filename from the dropdown
        fileSelect.addEventListener("change", function () {
            console.log("Old Selected file:", selectedFile);
            selectedFile = this.value;
            console.log("Selected file:", selectedFile);
            // computeLayout(); // Redraw the layout when a new file is selected
            FD.GraphData.fetchFileToDag(selectedFile).then(dag => {
                if (dag) {
                    const layout = { horizontal: horizontal, lineGenerator: lineGenerator, isEdgeCurved: isEdgeCurved };
                    // Initial layout computation and drawing
                    dashboard = FD.Layout.computeAndDraw(dag, mainView, minimap, layout);
                }
            });
        });







        let dag, dashboard;

        // make sure to import, and not use script in header, otherwse FD will not be initialized
        import './js/src/index.js';

        // Setup the main view and minimap
        const mainView = FD.DrawNetwork.setup("#graph");
        const minimap = FD.Minimap.setup({ width: mainView.width, height: mainView.height }, mainView.onDragUpdate);


        // Main execution
        let lineGenerator = getLineGenerator();
        function getLineGenerator() {
            const curve = d3.curveBasis; // d3.curveCatmullRom; // d3.curveMonotoneY; //
            return isEdgeCurved ? d3.line().curve(curve) : d3.line();
        }


        // initial layout computation and drawing
        FD.GraphData.fetchFileToDag(selectedFile).then(dag => {
            if (dag) {
                const layout = { horizontal: horizontal, lineGenerator: lineGenerator, isEdgeCurved: isEdgeCurved };
                // Initial layout computation and drawing
                dashboard = FD.Layout.computeAndDraw(dag, mainView, minimap, layout);
            }
        });
    </script>
</body>

</html>