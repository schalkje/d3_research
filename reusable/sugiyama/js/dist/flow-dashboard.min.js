(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{computeBoundingBox:()=>g,getImmediateNeighbors:()=>l,initializeZoom:()=>d,zoomRandom:()=>c,zoomToNode:()=>s,zoomToNodeByName:()=>h});var n={};t.r(n),t.d(n,{setup:()=>p});var i={};t.r(i),t.d(i,{computeAndDraw:()=>y,convertToStratifyData:()=>x,fetchFileToDag:()=>v,initializeGraphData:()=>f});var o={};t.r(o),t.d(o,{draw:()=>D,setup:()=>z});var a={};t.r(a),t.d(a,{computeLayout:()=>k,getComputedDimensions:()=>B});var r={};function d(t,e,n,i,o,a,r){const d=d3.zoom().scaleExtent([1,40]).on("zoom",(function(t){e.attr("transform",t.transform),r(t.transform)}));return e.call(d),d3.select("#zoom-in").on("click",(function(){!function(t,e){t.transition().duration(750).call(e.scaleBy,1.2)}(e,d)})),d3.select("#zoom-out").on("click",(function(){!function(t,e){t.transition().duration(750).call(e.scaleBy,.8)}(e,d)})),d3.select("#zoom-reset").on("click",(function(){!function(t,e,n,i){t.transition().duration(750).call(e.transform,d3.zoomIdentity,d3.zoomTransform(t.node()).invert([n/2,i/2]))}(e,d,n,i)})),d3.select("#zoom-random").on("click",(function(){c(e,a,d,n,i,o)})),d3.select("#zoom-node").on("click",(function(){h(e,"EM_Stater",a,d,n,i,o)})),d}function h(t,e,n,i,o,a,r){console.log("zoomToNodeByName",e);for(const d of n.nodes())if(d.data.label===e)return s(t,d,n,i,o,a,r)}function c(t,e,n,i,o,a){const r=[];for(const t of e.nodes())r.push(t);const d=r[Math.floor(Math.random()*r.length)];return console.log("random node=",d.data.label,d),s(t,d,e,n,i,o,a)}function s(t,e,n,i,o,a,r){let d=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const h=g(l(e,n),r);d&&(console.log("boundingBox",h),t.selectAll(".boundingBox").remove(),t.append("rect").attr("class","boundingBox").attr("x",h.x).attr("y",h.y).attr("width",h.width).attr("height",h.height).attr("fill","none").attr("stroke","red")),console.log("main",mainView.width,mainView.height);const{scale:c,translate:s}=u(h,o,a);return console.log("scale",c),console.log("translate",s),t.transition().duration(750).call(i.transform,d3.zoomIdentity.translate(s.x,s.y).scale(c)),g}function l(t,e){const n=[t];for(const i of e.nodes())(t.data.parentIds.includes(i.data.id)||t.data.childrenIds.includes(i.data.id))&&n.push(i);return n}function g(t,e){console.log("computeBoundingBox nodes",t);let[n,i,o,a]=[1/0,1/0,-1/0,-1/0];const r=(t,e,r,d)=>{n=Math.min(n,t-r/2),i=Math.min(i,e-d/2),o=Math.max(o,t+r/2),a=Math.max(a,e+d/2)};return t.forEach((t=>{const{x:n,y:i,data:{width:o,height:a}}=t;e?r(i,n,o,a):r(n,i,o,a)})),{x:n-2,y:i-2,width:o-n+4,height:a-i+4}}function u(t,e,n,i){let o,a=n,r=e;e/n>mainView.width/mainView.height?a=e*(mainView.height/mainView.width):r=n*(mainView.width/mainView.height),o=Math.min(r/t.width,a/t.height);const d=.5*(width*(mainView.height/mainView.width)-height),h=.5*(height*(mainView.width/mainView.height)-width),c=e/n>mainView.width/mainView.height,s=t.width/t.height>r/a,l=.5*(t.width*(a/r)-t.height),g=.5*(t.height*(r/a)-t.width);let u=-t.x*o,m=-t.y*o;return c?m-=d:u-=h,s?m+=l*o:u+=g*o,{scale:o,translate:{x:u,y:m}}}let m,w;function p(t,e){const n=t.width/t.height;let i,o;t.width>=t.height?(i=200,o=i/n):(o=200,i=o*n);const a=d3.select("#minimap").attr("width",i+1).attr("height",o+1);console.log("minimap",i,o,t.width,t.height);let r=Math.min(i/t.width,o/t.height);console.log("minimapScale",r);const d=a.append("rect").attr("class","viewport").attr("width",i).attr("height",o);return d.call(d3.drag().on("start",(t=>{m=t.x-parseFloat(d.attr("x")),w=t.y-parseFloat(d.attr("y"))})).on("drag",(t=>{const n=t.x-m,i=t.y-w;d.attr("x",n).attr("y",i),e({x:n,y:i})}))),{svg:a,scale:r,width:i,height:o,viewport:d}}function f(t){t.nodes.forEach(((t,e)=>{t.id=t.id||e,t.width=t.width||150,t.height=t.height||40,t.children=[],t.childrenIds=[],t.parents=[]})),t.edges.forEach((e=>{e.sourceNode=e.source||0,e.targetNode=e.target||0;const n=t.nodes.find((t=>t.id===e.sourceNode)),i=t.nodes.find((t=>t.id===e.targetNode));n&&i?(n.children.push(i),n.childrenIds.push(i.id),i.parents.push(n)):console.warn("Edge refers to non-existent node:",e)}))}function y(t,e){({svg_canvas,width,height}=computeLayout(t,minimap.svg,dag,horizontal)),zoom=initializeZoom(t,svg_canvas,width,height,horizontal,dag,updateMinimapViewport),drawMain(svg_canvas,dag,horizontal,width,height,e),console.log("minimapScale",minimap.scale),minimap.svg.selectAll("g").remove();const n=minimap.svg.insert("g",":first-child");return drawMinimap(n,dag,horizontal,width,height,e),{svg:svg_canvas,width,height,zoom}}function x(t){const e=new Map(t.nodes.map((t=>[t.id,{...t,parentIds:[]}])));return t.edges.forEach((t=>{const n=e.get(t.targetNode);n&&n.parentIds.push(t.sourceNode)})),Array.from(e.values())}async function v(t){const e=await d3.json(`data/${t}`);f(e),console.log(e);const n=x(e);return{dag:d3.graphStratify()(n)}}function z(t){const e=d3.select(`${t}`),{width:n,height:i}=getComputedDimensions(e);return{svg:e,width:n,height:i}}function D(t,e,n,i,o,a){t.selectAll("*").remove(),function(t,e,n,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4]&&t.append("g").append("rect").attr("class",(t=>"drawing_boundary")).attr("x",(t=>0)).attr("y",(t=>0)).attr("width",(t=>n)).attr("height",(t=>i))}(t,e,i,o,!0),function(t,e,n,i,o,a){t.append("defs").append("marker").attr("id","arrowhead").attr("class","marker").attr("viewBox","-0 -5 10 10").attr("refX",changeDirection(10,10,o).x).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("svg:path").attr("d","M 0,-5 L 10 ,0 L 0,5"),t.append("g").selectAll(".edge").data(e.links()).enter().append("path").attr("class","edge").attr("d",(t=>{const e=function(t,e){const n=t.source,i=t.target,o=M(n.data.width,n.data.height),a=M(i.data.width,i.data.height);let r,d,h;e?(r=o.right,d=a.left):(r=o.bottom,d=a.top),r=[changeDirection(n.x,n.y,e).x+r.x-n.data.width/2,changeDirection(n.x,n.y,e).y+r.y-n.data.height/2],d=[changeDirection(i.x,i.y,e).x+d.x-i.data.width/2,changeDirection(i.x,i.y,e).y+d.y-i.data.height/2];const c=(d[0]-r[0])/2,s=(d[1]-r[1])/2;return h=e?isEdgeCurved?[[r[0]+.9*c,r[1]+.1*s],[r[0]+1.1*c,d[1]+.1*s]]:[[r[0]+c,r[1]],[r[0]+c,d[1]]]:isEdgeCurved?[[r[0]+.1*c,r[1]+.9*s],[d[0]-.1*c,r[1]+1.5*s]]:[[r[0],r[1]+s],[d[0],r[1]+s]],[r,...h,d]}(t,o);return a(e)}))}(t,e,0,0,n,a),function(t,e,n,i){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=t.append("g").selectAll(".nodecontainer").data(e.nodes()).enter().append("g").attr("class",(t=>"nodecontainer")).attr("transform",(t=>`translate(${changeDirection(t.x,t.y,n).x-t.data.width/2},${changeDirection(t.x,t.y,n).y-t.data.height/2})`));r.append("rect").attr("class",(t=>"node")).attr("width",(t=>t.data.width)).attr("height",(t=>t.data.height)).attr("rx",5).attr("ry",5).on("click",(function(t,e){i(t,e)})),a||r.append("text").attr("class","label").attr("x",(t=>t.data.width/2)).attr("y",(t=>t.data.height/2+5)).text((t=>t.data.label)),o&&r.each((function(t){const e=M(t.data.width,t.data.height);Object.values(e).forEach((t=>{d3.select(this).append("circle").attr("class","connection-point").attr("cx",t.x).attr("cy",t.y).attr("r",3)}))}))}(t,e,n,b)}function b(t,e){console.log("onClickFunction",e.data.label,e),zoomToNode(svg_canvas,e,dag,zoom,width,height,horizontal)}function M(t,e){return{top:{x:t/2,y:0},bottom:{x:t/2,y:e},left:{x:0,y:e/2},right:{x:t,y:e/2}}}function k(t,e,n,i){t.selectAll("*").remove();const o=t.append("g"),a=changeDirection(8,100,i).x,r=changeDirection(50,8,i).x,d=d3.sugiyama().layering(d3.layeringLongestPath()).decross(d3.decrossTwoLayer()).coord(d3.coordQuad()).nodeSize((t=>function(t){let{data:e}=t;return[changeDirection(e.width+a,e.height+r,i).x,changeDirection(e.width+a,e.height+r,i).y]}(t))),{width:h,height:c}=d(n);return width=changeDirection(h,c,i).x,height=changeDirection(h,c,i).y,t.attr("viewBox",[0,0,width,height]),e.attr("viewBox",[0,0,width,height]),{svg_canvas:o,width,height}}function B(t){const e=t.node().getBoundingClientRect();return{width:e.width,height:e.height}}function V(t){return Math.round(100*t)/100}function N(t,e){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?{x:t,y:e}:{x:e,y:t}}function T(t,e){return e?t.map((t=>[t[1],t[0]])):t}t.r(r),t.d(r,{changeDirection:()=>N,changePointDirection:()=>T,roundToTwoDecimals:()=>V});const S={};S.Zoom=e,S.Minimap=n,S.GraphData=i,S.DrawNetwork=o,S.Layout=a,S.Util=r,window.FD=S,console.log("Webpack bundling works!")})();