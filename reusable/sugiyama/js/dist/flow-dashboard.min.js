(()=>{"use strict";var t={d:(a,i)=>{for(var n in i)t.o(i,n)&&!t.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:i[n]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};t.r(a),t.d(a,{computeBoundingBox:()=>m,getImmediateNeighbors:()=>l,initializeZoom:()=>c,zoomRandom:()=>h,zoomToNode:()=>d,zoomToNodeByName:()=>s});var i={};t.r(i),t.d(i,{changeDirection:()=>v,changePointDirection:()=>w,roundToTwoDecimals:()=>g});var n={};t.r(n),t.d(n,{computeAndDraw:()=>u,computeLayoutAndCanvas:()=>p,getComputedDimensions:()=>f});var e={};t.r(e),t.d(e,{draw:()=>x,drawMinimap:()=>b,setup:()=>y,updateMainView:()=>S});var o={};t.r(o),t.d(o,{createViewPort:()=>C,setup:()=>A,updateMinimapViewport:()=>T});var r={};function c(t,a,i){const n=d3.zoom().scaleExtent([1,40]).on("zoom",(function(a){t.main.canvas.svg.attr("transform",a.transform),i(t,a.transform)}));return t.zoom=n,t.main.canvas.svg.call(n),d3.select("#zoom-in").on("click",(function(){!function(t,a){t.transition().duration(750).call(a.scaleBy,1.2)}(t.main.canvas.svg,n)})),d3.select("#zoom-out").on("click",(function(){!function(t,a){t.transition().duration(750).call(a.scaleBy,.8)}(t.main.canvas.svg,n)})),d3.select("#zoom-reset").on("click",(function(){!function(t,a){t.svg.transition().duration(750).call(a.transform,d3.zoomIdentity,d3.zoomTransform(t.svg.node()).invert([t.width/2,t.height/2]))}(t.main.canvas,n)})),d3.select("#zoom-random").on("click",(function(){h(t,a)})),d3.select("#zoom-node").on("click",(function(){s("EM_Stater",t,a)})),n}function s(t,a,i){console.log("zoomToNodeByName",t);for(const n of i.nodes())if(n.data.label===t)return d(n,a,i)}function h(t,a){const i=[];for(const t of a.nodes())i.push(t);const n=i[Math.floor(Math.random()*i.length)];return console.log("random node=",n.data.label,n),d(n,t,a)}function d(t,a,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const e=m(l(t,i),a.layout.horizontal);n&&(console.log("boundingBox",e),a.main.canvas.svg.selectAll(".boundingBox").remove(),a.main.canvas.svg.append("rect").attr("class","boundingBox").attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("fill","none").attr("stroke","red"));const{scale:o,translate:r}=function(t,a){let i,n=a.main.canvas.height,e=a.main.canvas.width;a.main.canvas.width/a.main.canvas.height>a.main.view.width/a.main.view.height?n=a.main.canvas.width*(a.main.view.height/a.main.view.width):e=a.main.canvas.height*(a.main.view.width/a.main.view.height),a.layout.horizontal,i=Math.min(e/t.width,n/t.height);const o=.5*(a.main.canvas.width*(a.main.view.height/a.main.view.width)-a.main.canvas.height),r=.5*(a.main.canvas.height*(a.main.view.width/a.main.view.height)-a.main.canvas.width),c=a.main.canvas.width/a.main.canvas.height>a.main.view.width/a.main.view.height,s=t.width/t.height>e/n,h=.5*(t.width*(n/e)-t.height),d=.5*(t.height*(e/n)-t.width);let l=-t.x*i,m=-t.y*i;return c?m-=o:l-=r,s?m+=h*i:l+=d*i,{scale:i,translate:{x:l,y:m}}}(e,a);return console.log("scale",o),console.log("translate",r),a.main.view.svg.transition().duration(750).call(a.zoom.transform,d3.zoomIdentity.translate(r.x,r.y).scale(o)),e}function l(t,a){const i=[t];for(const n of a.nodes())(t.data.parentIds.includes(n.data.id)||t.data.childrenIds.includes(n.data.id))&&i.push(n);return i}function m(t,a){let[i,n,e,o]=[1/0,1/0,-1/0,-1/0];const r=(t,a,r,c)=>{i=Math.min(i,t-r/2),n=Math.min(n,a-c/2),e=Math.max(e,t+r/2),o=Math.max(o,a+c/2)};return t.forEach((t=>{const{x:i,y:n,data:{width:e,height:o}}=t;a?r(n,i,e,o):r(i,n,e,o)})),{x:i-2,y:n-2,width:e-i+4,height:o-n+4}}function g(t){return Math.round(100*t)/100}function v(t,a){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?{x:t,y:a}:{x:a,y:t}}function w(t,a){return a?t.map((t=>[t[1],t[0]])):t}function u(t,a,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n=function(t){return{horizontal:void 0===t.horizontal||t.horizontal,lineGenerator:void 0!==t.lineGenerator?t.lineGenerator:(t.isEdgeCurved,isEdgeCurved?d3.line().curve(d3.curveBasis):d3.line()),isEdgeCurved:void 0!==t.isEdgeCurved&&t.isEdgeCurved}}(n),console.log("computeAndDraw",a,i,t);let e={main:{view:a},minimap:{view:i},layout:n};return p(e,t),c(e,t,T),x(e,t),function(t,a){t.svg.selectAll("g").remove();const i=a.main.canvas.width/a.main.canvas.height>a.minimap.view.width/a.minimap.view.height,n=i?.5*(a.main.canvas.width*(a.minimap.view.height/a.minimap.view.width)-a.main.canvas.height):0,e=i?0:.5*(a.main.canvas.height*(a.minimap.view.width/a.minimap.view.height)-a.main.canvas.width),o=a.main.view.width/a.main.canvas.width,r=a.main.view.height/a.main.canvas.height;a.minimap.canvas={svg:t.svg.insert("g",":first-child"),width:a.main.canvas.width,height:a.main.canvas.height,whiteSpaceX:e,whiteSpaceY:n,isHorizontalCanvas:i,widthScale:o,heightScale:r}}(i,e),b(e,t),C(e),e}function p(t,a){t.main.view.svg.selectAll("*").remove();const i=t.main.view.svg.append("g"),n=v(8,100,t.layout.horizontal).x,e=v(50,8,t.layout.horizontal).x,o=d3.sugiyama().layering(d3.layeringLongestPath()).decross(d3.decrossTwoLayer()).coord(d3.coordQuad()).nodeSize((a=>function(a){let{data:i}=a;return[v(i.width+n,i.height+e,t.layout.horizontal).x,v(i.width+n,i.height+e,t.layout.horizontal).y]}(a))),{width:r,height:c}=o(a),s=v(r,c,t.layout.horizontal).x,h=v(r,c,t.layout.horizontal).y;return t.main.view.svg.attr("viewBox",[0,0,s,h]),t.minimap.view.svg.attr("viewBox",[0,0,s,h]),t.main.canvas={svg:i,width:s,height:h},t.main.canvas}function f(t){const a=t.node().getBoundingClientRect();return{width:a.width,height:a.height}}function y(t){const a=d3.select(`${t}`),{width:i,height:n}=f(a);return{svg:a,width:i,height:n,onDragUpdate:S}}function x(t,a){t.main.canvas.svg.selectAll("*").remove(),k(t.main.canvas),B(t.main.canvas,t,a),M(t.main.canvas,t,a,z)}function z(t,a,i,n){console.log("onClickFunction",a.data.label,a),d(a,i,n)}function b(t,a){const i=t.minimap.canvas;i.svg.selectAll("*").remove(),k(i),B(i,t,a),M(i,t,a,z,!1,!0)}function S(t,a){console.log("updateMainView",t,a.minimap.view.scale);const i=-t.x/a.minimap.view.scale,n=-t.y/a.minimap.view.scale,e=d3.zoomTransform(a.minimap.canvas.svg.node()),o=a.minimap.view.scale;console.log("              ",i,n,o,e);const r=d3.zoomIdentity.translate(i,n).scale(o);a.minimap.view.svg.call(a.zoom.transform,r)}function k(t){t.svg.append("g").append("rect").attr("class",(t=>"drawing_boundary")).attr("x",(t=>0)).attr("y",(t=>0)).attr("width",(a=>t.width)).attr("height",(a=>t.height))}function M(t,a,i,n){let e=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=t.svg.append("g").selectAll(".nodecontainer").data(i.nodes()).enter().append("g").attr("class",(t=>"nodecontainer")).attr("transform",(t=>`translate(${v(t.x,t.y,a.layout.horizontal).x-t.data.width/2},${v(t.x,t.y,a.layout.horizontal).y-t.data.height/2})`));r.append("rect").attr("class",(t=>`node s${t.data.state}`)).attr("width",(t=>t.data.width)).attr("height",(t=>t.data.height)).attr("rx",5).attr("ry",5).on("click",(function(t,e){n(t,e,a,i)})),o||r.append("text").attr("class","label").attr("x",(t=>t.data.width/2)).attr("y",(t=>t.data.height/2+5)).text((t=>t.data.label)),e&&r.each((function(t){const a=E(t.data.width,t.data.height);Object.values(a).forEach((t=>{d3.select(this).append("circle").attr("class","connection-point").attr("cx",t.x).attr("cy",t.y).attr("r",3)}))}))}function E(t,a){return{top:{x:t/2,y:0},bottom:{x:t/2,y:a},left:{x:0,y:a/2},right:{x:t,y:a/2}}}function B(t,a,i){t.svg.append("defs").append("marker").attr("id","arrowhead").attr("class","marker").attr("viewBox","-0 -5 10 10").attr("refX",v(10,10,a.layout.horizontal).x).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("svg:path").attr("d","M 0,-5 L 10 ,0 L 0,5"),t.svg.append("g").selectAll(".edge").data(i.links()).enter().append("path").attr("class","edge").attr("d",(t=>{const i=function(t,a){const i=t.source,n=t.target,e=E(i.data.width,i.data.height),o=E(n.data.width,n.data.height);let r,c,s;a.horizontal?(r=e.right,c=o.left):(r=e.bottom,c=o.top),r=[v(i.x,i.y,a.horizontal).x+r.x-i.data.width/2,v(i.x,i.y,a.horizontal).y+r.y-i.data.height/2],c=[v(n.x,n.y,a.horizontal).x+c.x-n.data.width/2,v(n.x,n.y,a.horizontal).y+c.y-n.data.height/2];const h=(c[0]-r[0])/2,d=(c[1]-r[1])/2;return s=a.horizontal?a.isEdgeCurved?[[r[0]+.9*h,r[1]+.1*d],[r[0]+1.1*h,c[1]+.1*d]]:[[r[0]+h,r[1]],[r[0]+h,c[1]]]:a.isEdgeCurved?[[r[0]+.1*h,r[1]+.9*d],[c[0]-.1*h,r[1]+1.5*d]]:[[r[0],r[1]+d],[c[0],r[1]+d]],[r,...s,c]}(t,a.layout);return a.layout.lineGenerator(i)}))}let D,N;function A(t,a){const i=t.width/t.height;let n,e;t.width>=t.height?(n=200,e=n/i):(e=200,n=e*i);const o=d3.select("#minimap").attr("width",n+1).attr("height",e+1);console.log("minimap",n,e,t.width,t.height);let r=Math.min(n/t.width,e/t.height);return console.log("minimapScale",r),{svg:o,scale:r,width:n,height:e}}function C(t){console.log("createViewPort",t),console.log("               - minimap canvas",t.minimap.canvas),console.log("               - margin x",t.minimap.canvas.width-t.minimap.view.width),console.log("               - margin y",t.minimap.canvas.height-t.minimap.view.height),t.minimap.view.svg.selectAll(".viewport").remove();const a=t.minimap.view.svg.append("rect").attr("class","viewport").attr("x",-t.minimap.canvas.whiteSpaceX).attr("y",-t.minimap.canvas.whiteSpaceY).attr("width",t.main.canvas.width+2*t.minimap.canvas.whiteSpaceX).attr("height",t.main.canvas.height+2*t.minimap.canvas.whiteSpaceY);return t.minimap.view.viewport=a,a.call(d3.drag().on("start",(t=>{D=t.x-parseFloat(a.attr("x")),N=t.y-parseFloat(a.attr("y"))})).on("drag",(i=>{const n=i.x-D,e=i.y-N;a.attr("x",n).attr("y",e),S({x:n,y:e},t)}))),a}function T(t,a){let i,n,e,o;i=-a.x/a.k,n=-a.y/a.k,e=t.main.view.width/a.k/t.minimap.canvas.widthScale,o=t.main.view.height/a.k/t.minimap.canvas.heightScale,n-=t.minimap.canvas.whiteSpaceY/a.k,o+=t.minimap.canvas.whiteSpaceY/a.k*2,i-=t.minimap.canvas.whiteSpaceX/a.k,e+=t.minimap.canvas.whiteSpaceX/a.k*2,t.minimap.view.viewport.attr("x",i).attr("y",n).attr("width",e).attr("height",o)}function I(t){t.nodes.forEach(((t,a)=>{t.id=t.id||a,t.width=t.width||150,t.height=t.height||40,t.children=[],t.childrenIds=[],t.parents=[]})),t.edges.forEach((a=>{a.sourceNode=a.source||0,a.targetNode=a.target||0;const i=t.nodes.find((t=>t.id===a.sourceNode)),n=t.nodes.find((t=>t.id===a.targetNode));i&&n?(i.children.push(n),i.childrenIds.push(n.id),n.parents.push(i)):console.warn("Edge refers to non-existent node:",a)}))}function P(t){const a=new Map(t.nodes.map((t=>[t.id,{...t,parentIds:[]}])));return t.edges.forEach((t=>{const i=a.get(t.targetNode);i&&i.parentIds.push(t.sourceNode)})),Array.from(a.values())}async function j(t){const a=await d3.json(`data/${t}`);I(a),console.log(a);const i=P(a);return{dag:d3.graphStratify()(i)}}t.r(r),t.d(r,{convertToStratifyData:()=>P,fetchFileToDag:()=>j,initializeGraphData:()=>I});const F={};F.Zoom=a,F.Minimap=o,F.GraphData=r,F.DrawNetwork=e,F.Layout=n,F.Util=i,window.FD=F,console.log("Webpack Flow Dashboard loaded")})();