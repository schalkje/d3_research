(()=>{"use strict";var t={d:(a,i)=>{for(var n in i)t.o(i,n)&&!t.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:i[n]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};t.r(a),t.d(a,{computeBoundingBox:()=>m,getImmediateNeighbors:()=>l,initializeZoom:()=>d,zoomRandom:()=>c,zoomToNode:()=>h,zoomToNodeByName:()=>s});var i={};t.r(i),t.d(i,{changeDirection:()=>v,changePointDirection:()=>w,roundToTwoDecimals:()=>g});var n={};t.r(n),t.d(n,{computeAndDraw:()=>u,computeLayoutAndCanvas:()=>p,getComputedDimensions:()=>y});var e={};t.r(e),t.d(e,{draw:()=>x,drawMinimap:()=>b,setup:()=>f,updateMainView:()=>k});var o={};t.r(o),t.d(o,{createViewPort:()=>C,setup:()=>I,updateMinimapViewport:()=>N});var r={};function d(t,a,i){const n=d3.zoom().scaleExtent([1,40]).on("zoom",(function(a){t.main.canvas.svg.attr("transform",a.transform),i(t,a.transform)}));return t.zoom=n,t.main.canvas.svg.call(n),d3.select("#zoom-in").on("click",(function(){!function(t,a){t.selectAll(".boundingBox").remove(),t.transition().duration(750).call(a.scaleBy,1.2)}(t.main.canvas.svg,n)})),d3.select("#zoom-out").on("click",(function(){!function(t,a){t.selectAll(".boundingBox").remove(),t.transition().duration(750).call(a.scaleBy,.8)}(t.main.canvas.svg,n)})),d3.select("#zoom-reset").on("click",(function(){!function(t,a){t.svg.selectAll(".boundingBox").remove(),t.svg.transition().duration(750).call(a.transform,d3.zoomIdentity,d3.zoomTransform(t.svg.node()).invert([t.width/2,t.height/2]))}(t.main.canvas,n)})),d3.select("#zoom-random").on("click",(function(){c(t,a)})),d3.select("#zoom-node").on("click",(function(){s("EM_Stater",t,a)})),n}function s(t,a,i){console.log("zoomToNodeByName",t);for(const n of i.nodes())if(n.data.label===t)return h(n,a,i)}function c(t,a){const i=[];for(const t of a.nodes())i.push(t);const n=i[Math.floor(Math.random()*i.length)];return console.log("random node=",n.data.label,n),h(n,t,a)}function h(t,a,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const e=m(l(t,i),a.layout.horizontal),{scale:o,translate:r}=function(t,a){let i,n=a.main.canvas.height,e=a.main.canvas.width;a.main.canvas.width/a.main.canvas.height>a.main.view.width/a.main.view.height?n=a.main.canvas.width*(a.main.view.height/a.main.view.width):e=a.main.canvas.height*(a.main.view.width/a.main.view.height),a.layout.horizontal,i=Math.min(e/t.width,n/t.height),console.log("scale",i);const o=t.width/t.height>e/n,r=.5*(t.width*(n/e)-t.height),d=.5*(t.height*(e/n)-t.width);let s=-t.x*i,c=-t.y*i;return a.minimap.canvas.isHorizontalCanvas?c-=a.minimap.canvas.whiteSpaceY:s-=a.minimap.canvas.whiteSpaceX,o?c+=r*i:s+=d*i,{scale:i,translate:{x:s,y:c}}}(e,a);return n&&(console.log("boundingBox",e,o),a.main.canvas.svg.selectAll(".boundingBox").remove(),a.main.canvas.svg.append("rect").attr("class","boundingBox").attr("stroke-width",2*o).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height)),a.main.boundingbox={boundingBox:e,x:e.x,y:e.y,width:e.width,height:e.height,scale:o},console.log("scale",o),console.log("translate",r),a.main.canvas.svg.transition().duration(750).call(a.zoom.transform,d3.zoomIdentity.translate(r.x,r.y).scale(o)),a.main.boundingbox}function l(t,a){const i=[t];for(const n of a.nodes())(t.data.parentIds.includes(n.data.id)||t.data.childrenIds.includes(n.data.id))&&i.push(n);return i}function m(t,a){let[i,n,e,o]=[1/0,1/0,-1/0,-1/0];const r=(t,a,r,d)=>{i=Math.min(i,t-r/2),n=Math.min(n,a-d/2),e=Math.max(e,t+r/2),o=Math.max(o,a+d/2)};return t.forEach((t=>{const{x:i,y:n,data:{width:e,height:o}}=t;a?r(n,i,e,o):r(i,n,e,o)})),{x:i-2,y:n-2,width:e-i+4,height:o-n+4}}function g(t){return Math.round(100*t)/100}function v(t,a){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?{x:t,y:a}:{x:a,y:t}}function w(t,a){return a?t.map((t=>[t[1],t[0]])):t}function u(t,a,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n=function(t){return{horizontal:void 0===t.horizontal||t.horizontal,lineGenerator:void 0!==t.lineGenerator?t.lineGenerator:(t.isEdgeCurved,isEdgeCurved?d3.line().curve(d3.curveBasis):d3.line()),isEdgeCurved:void 0!==t.isEdgeCurved&&t.isEdgeCurved}}(n),console.log("computeAndDraw",a,i,t);let e={main:{view:a,boundingbox:{scale:1}},minimap:{view:i,viewport:{}},layout:n};return p(e,t),d(e,t,N),x(e,t),function(t,a){t.svg.selectAll("g").remove();const i=a.main.canvas.width/a.main.canvas.height>a.minimap.view.width/a.minimap.view.height,n=i?.5*(a.main.canvas.width*(a.minimap.view.height/a.minimap.view.width)-a.main.canvas.height):0,e=i?0:.5*(a.main.canvas.height*(a.minimap.view.width/a.minimap.view.height)-a.main.canvas.width),o=a.main.view.width/a.main.canvas.width,r=a.main.view.height/a.main.canvas.height;a.minimap.canvas={svg:t.svg.insert("g",":first-child"),width:a.main.canvas.width,height:a.main.canvas.height,whiteSpaceX:e,whiteSpaceY:n,isHorizontalCanvas:i,widthScale:o,heightScale:r}}(i,e),b(e,t),C(e),e}function p(t,a){t.main.view.svg.selectAll("*").remove();const i=t.main.view.svg.append("g"),n=v(8,100,t.layout.horizontal).x,e=v(50,8,t.layout.horizontal).x,o=d3.sugiyama().layering(d3.layeringLongestPath()).decross(d3.decrossTwoLayer()).coord(d3.coordQuad()).nodeSize((a=>function(a){let{data:i}=a;return[v(i.width+n,i.height+e,t.layout.horizontal).x,v(i.width+n,i.height+e,t.layout.horizontal).y]}(a))),{width:r,height:d}=o(a),s=v(r,d,t.layout.horizontal).x,c=v(r,d,t.layout.horizontal).y;return t.main.view.svg.attr("viewBox",[0,0,s,c]),t.minimap.view.svg.attr("viewBox",[0,0,s,c]),t.main.canvas={svg:i,width:s,height:c},t.main.canvas}function y(t){const a=t.node().getBoundingClientRect();return{width:a.width,height:a.height}}function f(t){const a=d3.select(`${t}`),{width:i,height:n}=y(a);return{svg:a,width:i,height:n,onDragUpdate:k}}function x(t,a){t.main.canvas.svg.selectAll("*").remove(),S(t.main.canvas),A(t.main.canvas,t,a),M(t.main.canvas,t,a,z)}function z(t,a,i,n){console.log("onClickFunction",a.data.label,a),h(a,i,n)}function b(t,a){const i=t.minimap.canvas;i.svg.selectAll("*").remove(),S(i),A(i,t,a),M(i,t,a,z,!1,!0)}function k(t,a){const i=d3.zoomTransform(a.main.canvas.svg.node()).k,n=-t.x*i,e=-t.y*i;a.main.canvas.svg.call(a.zoom.transform,d3.zoomIdentity.translate(n,e).scale(i))}function S(t){t.svg.append("g").append("rect").attr("class",(t=>"drawing_boundary")).attr("x",(t=>0)).attr("y",(t=>0)).attr("width",(a=>t.width)).attr("height",(a=>t.height))}function M(t,a,i,n){let e=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=t.svg.append("g").selectAll(".nodecontainer").data(i.nodes()).enter().append("g").attr("class",(t=>"nodecontainer")).attr("transform",(t=>`translate(${v(t.x,t.y,a.layout.horizontal).x-t.data.width/2},${v(t.x,t.y,a.layout.horizontal).y-t.data.height/2})`));r.append("rect").attr("class",(t=>`node s${t.data.state}`)).attr("width",(t=>t.data.width)).attr("height",(t=>t.data.height)).attr("rx",5).attr("ry",5).on("click",(function(t,e){n(t,e,a,i)})),o||r.append("text").attr("class","label").attr("x",(t=>t.data.width/2)).attr("y",(t=>t.data.height/2+5)).text((t=>t.data.label)),e&&r.each((function(t){const a=B(t.data.width,t.data.height);Object.values(a).forEach((t=>{d3.select(this).append("circle").attr("class","connection-point").attr("cx",t.x).attr("cy",t.y).attr("r",3)}))}))}function B(t,a){return{top:{x:t/2,y:0},bottom:{x:t/2,y:a},left:{x:0,y:a/2},right:{x:t,y:a/2}}}function A(t,a,i){t.svg.append("defs").append("marker").attr("id","arrowhead").attr("class","marker").attr("viewBox","-0 -5 10 10").attr("refX",v(10,10,a.layout.horizontal).x).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("svg:path").attr("d","M 0,-5 L 10 ,0 L 0,5"),t.svg.append("g").selectAll(".edge").data(i.links()).enter().append("path").attr("class","edge").attr("d",(t=>{const i=function(t,a){const i=t.source,n=t.target,e=B(i.data.width,i.data.height),o=B(n.data.width,n.data.height);let r,d,s;a.horizontal?(r=e.right,d=o.left):(r=e.bottom,d=o.top),r=[v(i.x,i.y,a.horizontal).x+r.x-i.data.width/2,v(i.x,i.y,a.horizontal).y+r.y-i.data.height/2],d=[v(n.x,n.y,a.horizontal).x+d.x-n.data.width/2,v(n.x,n.y,a.horizontal).y+d.y-n.data.height/2];const c=(d[0]-r[0])/2,h=(d[1]-r[1])/2;return s=a.horizontal?a.isEdgeCurved?[[r[0]+.9*c,r[1]+.1*h],[r[0]+1.1*c,d[1]+.1*h]]:[[r[0]+c,r[1]],[r[0]+c,d[1]]]:a.isEdgeCurved?[[r[0]+.1*c,r[1]+.9*h],[d[0]-.1*c,r[1]+1.5*h]]:[[r[0],r[1]+h],[d[0],r[1]+h]],[r,...s,d]}(t,a.layout);return a.layout.lineGenerator(i)}))}let E,D;function I(t,a){const i=t.width/t.height;let n,e;t.width>=t.height?(n=200,e=n/i):(e=200,n=e*i);const o=d3.select("#minimap").attr("width",n+1).attr("height",e+1);console.log("minimap",n,e,t.width,t.height);let r=Math.min(n/t.width,e/t.height);return console.log("minimapScale",r),{svg:o,scale:r,width:n,height:e}}function C(t){console.log("createViewPort",t),console.log("               - minimap canvas",t.minimap.canvas),console.log("               - margin x",t.minimap.canvas.width-t.minimap.view.width),console.log("               - margin y",t.minimap.canvas.height-t.minimap.view.height),console.log("               - boundingbox",t.main.boundingbox),t.minimap.view.svg.selectAll(".viewport").remove();const a=t.minimap.view.svg.append("rect").attr("class","viewport").attr("stroke-width",t.minimap.canvas.width/t.minimap.view.width*2).attr("x",-t.minimap.canvas.whiteSpaceX).attr("y",-t.minimap.canvas.whiteSpaceY).attr("width",t.main.canvas.width+2*t.minimap.canvas.whiteSpaceX).attr("height",t.main.canvas.height+2*t.minimap.canvas.whiteSpaceY);return t.minimap.view.viewport=a,a.call(d3.drag().on("start",(i=>{console.log("drag start",i.x,a.attr("x"),i.y,a.attr("y")),console.log("          ",i),E=i.x-parseFloat(a.attr("x")),D=i.y-parseFloat(a.attr("y")),console.log("          ",E,D),t.minimap.viewport.dragInitialX=E,t.minimap.viewport.dragInitialY=D})).on("drag",(i=>{console.log("drag",i.x,i.y,E,D,t.minimap.viewport.dragInitialX,t.minimap.viewport.dragInitialY);const n=i.x-E,e=i.y-D;console.log("     newX, newY",n,e),a.attr("x",n).attr("y",e),k({x:n,y:e},t)}))),a}function N(t,a){let i,n,e,o;i=-a.x/a.k,n=-a.y/a.k,e=t.main.view.width/a.k/t.minimap.canvas.widthScale,o=t.main.view.height/a.k/t.minimap.canvas.heightScale,n-=t.minimap.canvas.whiteSpaceY/a.k,o+=t.minimap.canvas.whiteSpaceY/a.k*2,i-=t.minimap.canvas.whiteSpaceX/a.k,e+=t.minimap.canvas.whiteSpaceX/a.k*2,console.log("updateMinimapViewport",i,n,e,o,t,t.minimap.canvas.width/t.minimap.view.width),t.minimap.view.viewport.attr("x",i).attr("y",n).attr("width",e).attr("height",o).attr("stroke-width",t.minimap.canvas.width/t.minimap.view.width*2)}function T(t){t.nodes.forEach(((t,a)=>{t.id=t.id||a,t.width=t.width||150,t.height=t.height||40,t.children=[],t.childrenIds=[],t.parents=[]})),t.edges.forEach((a=>{a.sourceNode=a.source||0,a.targetNode=a.target||0;const i=t.nodes.find((t=>t.id===a.sourceNode)),n=t.nodes.find((t=>t.id===a.targetNode));i&&n?(i.children.push(n),i.childrenIds.push(n.id),n.parents.push(i)):console.warn("Edge refers to non-existent node:",a)}))}function X(t){const a=new Map(t.nodes.map((t=>[t.id,{...t,parentIds:[]}])));return t.edges.forEach((t=>{const i=a.get(t.targetNode);i&&i.parentIds.push(t.sourceNode)})),Array.from(a.values())}async function Y(t){const a=await d3.json(`data/${t}`);T(a),console.log(a);const i=X(a);return{dag:d3.graphStratify()(i)}}t.r(r),t.d(r,{convertToStratifyData:()=>X,fetchFileToDag:()=>Y,initializeGraphData:()=>T});const P={};P.Zoom=a,P.Minimap=o,P.GraphData=r,P.DrawNetwork=e,P.Layout=n,P.Util=i,window.FD=P,console.log("Webpack Flow Dashboard loaded")})();