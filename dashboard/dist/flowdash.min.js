/*! For license information please see flowdash.min.js.LICENSE.txt */
var flowdash;(()=>{"use strict";var t={d:(e,i)=>{for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Dashboard:()=>tt,computeBoundingBox:()=>it,createAndInitDashboard:()=>at,default:()=>ht,fetchDashboardFile:()=>K,getImmediateNeighbors:()=>et,hideLoading:()=>J,loadDashboardFromFile:()=>st,setDashboardProperty:()=>nt,showLoading:()=>X});var i={};t.r(i),t.d(i,{fetchDashboardFile:()=>K});var a={};t.r(a),t.d(a,{Dashboard:()=>tt,computeBoundingBox:()=>it,createAndInitDashboard:()=>at,getImmediateNeighbors:()=>et,hideLoading:()=>J,loadDashboardFromFile:()=>st,setDashboardProperty:()=>nt,showLoading:()=>X});const s=new Map;function n(t,e){s.set(t.toLowerCase(),e)}function o(t,e,i,a=null){const n=t.type.toLowerCase(),h=s.get(n);return h?["group","lane","columns","adapter","foundation","mart","edge-demo"].includes(n)?new h(t,e,o,i,a):new h(t,e,i,a):(console.error(`Unknown node type "${t.type}"`),console.error("Available node types:",Array.from(s.keys())),null)}const h=Object.freeze({TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"});function r(t,e,i,a){return{top:{side:h.TOP,x:t,y:e-a/2},bottom:{side:h.BOTTOM,x:t,y:e+a/2},left:{side:h.LEFT,x:t-i/2,y:e},right:{side:h.RIGHT,x:t+i/2,y:e}}}function d(t){return[t.x,t.y]}function l(t){if(!t||!t.parentNode||!t.parentNode.zoneManager)return{x:0,y:0};const e=t.parentNode.zoneManager.innerContainerZone;if(!e||!e.coordinateSystem)return{x:0,y:0};const i=e.coordinateSystem.transform.match(/translate\(([^,]+),\s*([^)]+)\)/);return i?{x:parseFloat(i[1]),y:parseFloat(i[2])}:{x:0,y:0}}class c{static setupNodeEvents(t,e){const i=t.element;if(e.onClick&&i.on("click",(i=>{i.stopPropagation(),e.onClick(i,t)})),e.onDblClick&&i.on("dblclick",(i=>{i.stopPropagation(),e.onDblClick(i,t)})),e.onDrag){const t=d3.drag().on("start",e.onDrag.start).on("drag",e.onDrag.drag).on("end",e.onDrag.end);i.call(t)}}static setupDefaultNodeEvents(t){const e=t.element;e.on("click",(e=>{e.stopPropagation(),t.handleClicked(e)})),e.on("dblclick",(e=>{e.stopPropagation(),t.handleDblClicked(e)}))}static setupDragEvents(t){const e=d3.drag().on("start",(e=>t.drag_started(e,t))).on("drag",(e=>t.dragged(e,t))).on("end",(e=>t.drag_ended(e,t)));t.element.call(e)}static propagateEvent(t,e,i){t[`on${e}`]?t[`on${e}`](i,t):t.parentNode&&this.propagateEvent(t.parentNode,e,i)}static handleNodeClick(t,e){t.onClick?t.onClick(t):t.parentNode?t.parentNode.handleClicked(e,t):console.warn(`No onClicked handler, node ${t.id} clicked!`)}static handleNodeDblClick(t,e){t.onDblClick?t.onDblClick(t):t.parentNode?t.parentNode.handleDblClicked(e,t):console.warn(`No onDblClicked handler, node ${t.id} double-clicked!`)}}class m{static calculateContainerStatus(t,e){if(!e.cascadeOnStatusChange||0===t.length)return x.UNKNOWN;const i=t.filter((t=>!t.isContainer)).map((t=>t.status));return this.determineAggregateStatus(i)}static determineAggregateStatus(t){if(0===t.length)return x.UNKNOWN;const e=[x.ERROR,x.WARNING,x.DELAYED,x.UNKNOWN,x.UPDATING,x.UPDATED,x.SKIPPED,x.READY];for(const i of e)if(t.includes(i))return i;return x.UNKNOWN}static shouldCollapseOnStatus(t,e){return!!e.toggleCollapseOnStatusChange&&[x.READY,x.DISABLED,x.UPDATED,x.SKIPPED].includes(t)}static getStatusPriority(t){return[x.ERROR,x.WARNING,x.DELAYED,x.UNKNOWN,x.UPDATING,x.UPDATED,x.SKIPPED,x.READY].indexOf(t)}static isErrorStatus(t){return[x.ERROR,x.WARNING,x.DELAYED].includes(t)}static isProcessStatus(t){return[x.READY,x.UPDATING,x.UPDATED,x.SKIPPED].includes(t)}}const g={selector:{incomming:1,outgoing:1},showBoundingBox:!0,zoomToRoot:!0,toggleCollapseOnStatusChange:!1,cascadeOnStatusChange:!0,showCenterMark:!1,showConnectionPoints:!1,showInnerZoneRect:!1,containerMargin:{top:8,right:8,bottom:8,left:8},nodeSpacing:{horizontal:20,vertical:10},minimap:{enabled:!0,mode:"always",position:"bottom-right",size:"m",opacity:1,collapsed:!1,pinned:!1,collapsedIcon:{position:"bottom-right"},hover:{showDelayMs:120,hideDelayMs:300,zoomFitThreshold:1},touch:{autoHideAfterMs:2500},scaleIndicator:{visible:!0,type:"percent",decimals:0},icons:{zoomIn:"plus",zoomOut:"minus",resetView:"target",mode:"eye",collapse:"triangle-down",expand:"minimap"},persistence:{persistCollapsedState:!0,storageKey:"flowdash:minimap:collapsed"},theme:{}}};class p{static mergeWithDefaults(t){return this.deepMerge(g,t)}static deepMerge(t,e){const i={...t};for(const a in e)e[a]&&"object"==typeof e[a]&&!Array.isArray(e[a])?i[a]=this.deepMerge(t[a]||{},e[a]):i[a]=e[a];return i}static validateSettings(t){const e=[];return t.selector&&(t.selector.incomming<0||t.selector.outgoing<0)&&e.push("Selector values must be non-negative"),t.containerMargin&&["top","right","bottom","left"].forEach((i=>{t.containerMargin[i]<0&&e.push(`Container margin ${i} must be non-negative`)})),t.nodeSpacing&&(t.nodeSpacing.horizontal<0||t.nodeSpacing.vertical<0)&&e.push("Node spacing values must be non-negative"),e}static getDefaultContainerMargin(){return{...g.containerMargin}}static getDefaultNodeSpacing(){return{...g.nodeSpacing}}}class u{constructor(t,e){this.node=t,this.name=e,this.manager=null,this.element=null,this.initialized=!1,this.size={width:0,height:0},this.position={x:0,y:0},this.visible=!0}init(){this.initialized||(this.createElement(),this.setupStyling(),this.setupInteractions(),this.initialized=!0)}createElement(){this.element=this.node.element.append("g").attr("class",`zone-${this.name}`)}setupStyling(){}setupInteractions(){}update(){this.initialized&&(this.updatePosition(),this.updateSize(),this.updateStyling())}updatePosition(){this.element&&this.element.attr("transform",`translate(${this.position.x}, ${this.position.y})`)}updateSize(){}updateStyling(){}resize(t,e){const i=Number.isFinite(t)&&t>=0?t:0,a=Number.isFinite(e)&&e>=0?e:0;this.size.width=i,this.size.height=a,this.update()}setPosition(t,e){this.position.x=t,this.position.y=e,this.updatePosition()}getSize(){return{...this.size}}getPosition(){return{...this.position}}getCoordinateSystem(){return{origin:{x:this.position.x,y:this.position.y},size:this.getSize(),transform:`translate(${this.position.x}, ${this.position.y})`}}handleEvent(t,e){}setVisible(t){this.visible=t,this.element&&this.element.style("display",t?"block":"none")}isVisible(){return this.visible}getBounds(){return{left:this.position.x,top:this.position.y,right:this.position.x+this.size.width,bottom:this.position.y+this.size.height,width:this.size.width,height:this.size.height}}containsPoint(t,e){const i=this.getBounds();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom}destroy(){this.element&&(this.element.remove(),this.element=null),this.initialized=!1}}class f extends u{constructor(t){super(t,"container"),this.shape=null,this.border=null}createElement(){super.createElement(),this.shape=this.element.append("rect").attr("class","container-shape").attr("x",0).attr("y",0),this.border=this.element.append("rect").attr("class","container-border").attr("x",0).attr("y",0)}setupStyling(){this.node.settings.containerFill&&this.shape.attr("fill",this.node.settings.containerFill),this.node.settings.containerStroke&&this.shape.attr("stroke",this.node.settings.containerStroke),this.node.settings.containerStrokeWidth&&this.shape.attr("stroke-width",this.node.settings.containerStrokeWidth),this.node.settings.selectionBorderWidth&&this.border.attr("stroke-width",this.node.settings.selectionBorderWidth)}setupInteractions(){this.updateSelectionState(),this.updateStatusState()}updateSize(){if(!this.shape||!this.border)return;const t=this.size.width,e=this.size.height;this.shape.attr("width",t).attr("height",e).attr("x",-t/2).attr("y",-e/2),this.border.attr("width",t+4).attr("height",e+4).attr("x",-t/2-2).attr("y",-e/2-2)}updateStyling(){this.updateSelectionState(),this.updateStatusState()}updateSelectionState(){this.border&&(this.node.selected?(this.border.classed("selected",!0),this.node.settings.selectionColor&&this.border.attr("stroke",this.node.settings.selectionColor),this.node.settings.selectionBorderWidth&&this.border.attr("stroke-width",this.node.settings.selectionBorderWidth)):(this.border.classed("selected",!1),this.border.attr("stroke",null),this.border.attr("stroke-width",null)))}updateStatusState(){if(!this.shape)return;const t=this.node.status,e=this.node.settings.statusColors||{};e[t]&&(e[t].border&&this.shape.attr("stroke",e[t].border),e[t].fill&&this.shape.attr("fill",e[t].fill))}handleEvent(t,e){switch(t){case"click":this.handleClick(e);break;case"dblclick":this.handleDblClick(e);break;case"mouseenter":this.handleMouseEnter(e);break;case"mouseleave":this.handleMouseLeave(e)}}handleClick(t){this.node.handleClicked&&this.node.handleClicked(t,this.node)}handleDblClick(t){this.node.handleDblClicked&&this.node.handleDblClicked(t,this.node)}handleMouseEnter(t){this.shape.classed("hover",!0)}handleMouseLeave(t){this.shape.classed("hover",!1)}getCollisionBounds(){return this.getBounds()}isCollidingWith(t){const e=this.getCollisionBounds(),i=t.getCollisionBounds();return!(e.right<i.left||e.left>i.right||e.bottom<i.top||e.top>i.bottom)}}class y extends u{constructor(t){super(t,"header"),this.textElement=null,this.background=null,this.statusIndicator=null,this.zoomButton=null,this.minHeight=10,this.padding=4,this._cachedMinWidth=null,this._lastTextContent=null,this._updateBatchTimer=null,this._pendingMinWidthUpdate=!1,this._callCount=0,this._lastCallTime=0,this._performanceWarningThreshold=10}createElement(){super.createElement(),this.background=this.element.append("rect").attr("class","header-background"),this.textElement=this.element.append("text").attr("class","header-text").attr("x",this.padding).attr("y",0).attr("dy","0.35em"),this.statusIndicator=this.element.append("circle").attr("class","status-indicator").attr("r",3),this.node.isContainer&&this.createZoomButton()}createZoomButton(){this.zoomButton=this.element.append("g").attr("class","zoom-button"),this.zoomButton.append("circle").attr("class","zoom-button-bg").attr("r",8),this.zoomButton.append("text").attr("class","zoom-icon").attr("dy","0.35em").text("−")}setupStyling(){this.node.settings.headerFill&&this.background.attr("fill",this.node.settings.headerFill),this.node.settings.headerStroke&&this.background.attr("stroke",this.node.settings.headerStroke),this.node.settings.headerStrokeWidth&&this.background.attr("stroke-width",this.node.settings.headerStrokeWidth),this.node.settings.fontFamily&&this.textElement.attr("font-family",this.node.settings.fontFamily),this.node.settings.fontSize&&this.textElement.attr("font-size",this.node.settings.fontSize),this.node.settings.fontWeight&&this.textElement.attr("font-weight",this.node.settings.fontWeight),this.node.settings.textColor&&this.textElement.attr("fill",this.node.settings.textColor),this.updateStatusIndicator()}setupInteractions(){this.zoomButton&&this.zoomButton.on("click",(t=>this.handleZoomClick(t))).on("mouseenter",(t=>this.handleZoomMouseEnter(t))).on("mouseleave",(t=>this.handleZoomMouseLeave(t))),this.textElement.on("click",(t=>this.handleTextClick(t))).on("mouseenter",(t=>this.handleTextMouseEnter(t))).on("mouseleave",(t=>this.handleTextMouseLeave(t)))}updateSize(){if(!this.background||!this.textElement)return;const t=this.size.width,e=this.calculateTextHeight();this.background.attr("width",t).attr("height",e).attr("x",-t/2).attr("y",0),this.updateText(),this.updateStatusIndicatorPosition(),this.updateZoomButtonPosition()}getHeaderTextConfig(){const t=this.node?.settings||{},e=t.headerText||{},i="truncate";let a=t.headerTextMode??e.mode??i;return a="string"==typeof a?a.toLowerCase():i,"full"!==a&&"truncate"!==a&&(a=i),{mode:a,minWidth:Number.isFinite(t.headerTextMinWidth)?t.headerTextMinWidth:Number.isFinite(e.minWidth)?e.minWidth:50,maxWidth:Number.isFinite(t.headerTextMaxWidth)?t.headerTextMaxWidth:Number.isFinite(e.maxWidth)?e.maxWidth:300}}getMinimumWidth(){this._callCount++;const t=Date.now();t-this._lastCallTime>100&&(this._callCount>this._performanceWarningThreshold&&console.warn(`HeaderZone ${this.node?.data?.id}: getMinimumWidth called ${this._callCount} times in 100ms. Consider using getMinimumWidthThrottled() for rapid updates.`),this._callCount=1,this._lastCallTime=t);const e=this.node?.data?.label||this.node?.data?.name||"",i=this.node?.isContainer||!1,a=`${e}|${i}`;if(this._cachedMinWidth&&this._cachedMinWidth.key===a)return this._cachedMinWidth.value;let s=0;try{if(this.textElement&&"function"==typeof this.textElement.node){try{s=this.textElement.node().getComputedTextLength()}catch{const t=this.textElement.node().cloneNode(!0);t.textContent=e,t.style.position="absolute",t.style.left="-99999px",t.style.top="-99999px",t.style.visibility="hidden",document.body.appendChild(t),s=t.getBoundingClientRect().width,document.body.removeChild(t)}s||(s=8*e.length)}else s=8*e.length}catch{s=8*e.length}const n=i?16:0,o=(this.padding||0)+s+8+6+(n>0?4:0)+n+(this.padding||0),{mode:h,minWidth:r,maxWidth:d}=this.getHeaderTextConfig(),l=Number.isFinite(r)?r:50,c=Number.isFinite(d)?d:300;let m=o;m=Math.max(m,l),"truncate"===h&&(m=Math.min(m,c));const g=Math.ceil(m);return this._cachedMinWidth={key:a,value:g,timestamp:Date.now()},g}clearMinWidthCache(){this._cachedMinWidth=null}recalculateMinWidth(){return this._cachedMinWidth=null,this.getMinimumWidth()}getMinimumWidthThrottled(){return this._cachedMinWidth&&this._cachedMinWidth.key===this._getCurrentCacheKey()?this._cachedMinWidth.value:(this._pendingMinWidthUpdate||(this._pendingMinWidthUpdate=!0,this._updateBatchTimer&&clearTimeout(this._updateBatchTimer),this._updateBatchTimer=setTimeout((()=>{this._pendingMinWidthUpdate=!1,this._updateBatchTimer=null,this.getMinimumWidth()}),16)),this._cachedMinWidth?this._cachedMinWidth.value:this._getFallbackMinWidth())}_getFallbackMinWidth(){const t=8*(this.node?.data?.label||this.node?.data?.name||"").length,e=this.padding||0,i=this.padding||0,a=this.node?.isContainer?16:0,s=a>0?4:0;return Math.ceil(e+t+8+6+s+a+i)}_getCurrentCacheKey(){return`${this.node?.data?.label||this.node?.data?.name||""}|${this.node?.isContainer||!1}`}getReservedRightWidth(){const t=this.padding||0,e=this.node?.isContainer?16:0;return 14+(e>0?4:0)+e+t}calculateTextHeight(){if(!this.textElement)return this.minHeight;const t=this.node.data.label||this.node.data.name||"";if(!t)return this.minHeight;try{const e=this.textElement.node().cloneNode(!0);e.textContent=t,document.body.appendChild(e);const i=e.getBoundingClientRect().height;return document.body.removeChild(e),Math.max(i,this.minHeight)}catch(t){return console.warn("Text height measurement failed, using minimum height fallback:",t),this.minHeight}}updateText(){if(!this.textElement)return;const t=this.node.data.label||this.node.data.name||"";this._lastTextContent!==t&&(this.clearMinWidthCache(),this._lastTextContent=t);const e=this.getReservedRightWidth();let i=Math.max(0,this.size.width-this.padding-e);const{mode:a,maxWidth:s}=this.getHeaderTextConfig();if("full"===a){t.length>0?this.textElement.text(t):this.textElement.text(""),this.textElement.select("title").remove(),this.textElement.style("cursor","default");const e=this.calculateTextHeight();return void this.textElement.attr("x",-this.size.width/2+this.padding).attr("y",e/2)}if("truncate"===a&&Number.isFinite(s)){const t=Math.max(0,s-this.padding-e);i=Math.min(i,t)}if(t.length>0)if(this.textElement.text(t),this.textElement.node().getComputedTextLength()>i){let e=t;const a=t=>t.replace(/\s+$/,"");for(;e.length>0&&this.textElement.text(a(e)+"...").node().getComputedTextLength()>i;)e=e.slice(0,-1);const s=a(e)+"...";this.textElement.text(s);const n=this.textElement.select("title");n.empty()?this.textElement.append("title").text(t):n.text(t),this.textElement.style("cursor","help")}else this.textElement.select("title").remove(),this.textElement.style("cursor","default");else this.textElement.text(""),this.textElement.select("title").remove(),this.textElement.style("cursor","default");const n=this.calculateTextHeight();this.textElement.attr("x",-this.size.width/2+this.padding).attr("y",n/2)}updateStatusIndicator(){if(!this.statusIndicator)return;const t=this.node.status,e=this.node.settings.statusColors||{};this.statusIndicator.classed("unknown ready updating updated error warning",!1),e[t]&&e[t].indicator?this.statusIndicator.attr("fill",e[t].indicator):this.statusIndicator.classed(t.toLowerCase(),!0)}updateStatusIndicatorPosition(){if(!this.statusIndicator)return;const t=this.calculateTextHeight();this.statusIndicator.attr("cx",this.size.width/2-6-this.padding).attr("cy",t/2)}updateZoomButtonPosition(){if(!this.zoomButton)return;const t=this.calculateTextHeight();this.zoomButton.attr("transform",`translate(${this.size.width/2-16-this.padding}, ${t/2})`),this.updateZoomButtonState()}updateZoomButtonState(){if(!this.zoomButton)return;const t=this.zoomButton.select(".zoom-icon");this.node.collapsed?t.text("+"):t.text("−")}updateStyling(){this.updateStatusIndicator(),this.updateZoomButtonState()}handleZoomClick(t){t.stopPropagation(),this.node.isContainer&&(this.node.collapsed=!this.node.collapsed)}handleZoomMouseEnter(t){this.zoomButton.select(".zoom-button-bg").classed("hover",!0)}handleZoomMouseLeave(t){this.zoomButton.select(".zoom-button-bg").classed("hover",!1)}handleTextClick(t){this.node.handleClicked&&this.node.handleClicked(t,this.node)}handleTextMouseEnter(t){this.textElement.classed("hover",!0),this.node.settings.textHoverColor&&this.textElement.attr("fill",this.node.settings.textHoverColor)}handleTextMouseLeave(t){this.textElement.classed("hover",!1),this.node.settings.textColor?this.textElement.attr("fill",this.node.settings.textColor):this.textElement.attr("fill",null)}getHeaderHeight(){return this.calculateTextHeight()}updatePosition(){if(this.element){const t=-this.node.data.height/2;this.element.attr("transform",`translate(0, ${t})`)}}resize(t,e){this.size.width=t,this.size.height=this.calculateTextHeight(),this.update()}destroy(){this._updateBatchTimer&&(clearTimeout(this._updateBatchTimer),this._updateBatchTimer=null),this._cachedMinWidth=null,this._pendingMinWidthUpdate=!1,super.destroy()}}class w extends u{constructor(t){super(t,"margin"),this.margins={top:8,right:8,bottom:8,left:8},this.visualElements=[]}init(){super.init(),this.loadMargins()}loadMargins(){const t=this.node?.settings?.containerMargin||{};this.margins={top:t.top??8,right:t.right??8,bottom:t.bottom??8,left:t.left??8}}createElement(){this.element=null}setupStyling(){}setupInteractions(){}update(){this.initialized&&this.updateSize()}updateSize(){}getMargins(){return{...this.margins}}setMargins(t){this.margins={...this.margins,...t},this.validateMargins()}validateMargins(){const t=[];this.margins.top<0&&t.push("Top margin must be non-negative"),this.margins.right<0&&t.push("Right margin must be non-negative"),this.margins.bottom<0&&t.push("Bottom margin must be non-negative"),this.margins.left<0&&t.push("Left margin must be non-negative"),t.length>0&&console.warn("Margin validation errors:",t)}getSize(){return{width:this.margins.left+this.margins.right,height:this.margins.top+this.margins.bottom,left:this.margins.left,right:this.margins.right,top:this.margins.top,bottom:this.margins.bottom}}getContentArea(t,e){return{x:this.margins.left,y:this.margins.top,width:t-this.margins.left-this.margins.right,height:e-this.margins.top-this.margins.bottom}}getInnerContainerPosition(t){return{x:this.margins.left,y:t+this.margins.top}}getTransformOffset(){return{x:this.margins.left-this.margins.right,y:this.margins.top-this.margins.bottom}}calculateContainerSize(t,e,i=0){return{width:t+this.margins.left+this.margins.right,height:i+this.margins.top+e+this.margins.bottom}}applyMarginsToPosition(t,e,i=0){return{x:t+this.margins.left,y:e+i+this.margins.top}}removeMarginsFromPosition(t,e,i=0){return{x:t-this.margins.left,y:e-i-this.margins.top}}isWithinMargins(t,e,i,a,s=0){return t>=this.margins.left&&t<=i-this.margins.right&&e>=s+this.margins.top&&e<=a-this.margins.bottom}getPositionConstraints(t,e,i=0){return{minX:this.margins.left,maxX:t-this.margins.right,minY:i+this.margins.top,maxY:e-this.margins.bottom}}calculateSpacing(t,e,i,a=!0){if(t<=1)return 0;const s=t*e,n=(t-1)*i,o=a?this.margins.left+this.margins.right:this.margins.top+this.margins.bottom;return Math.max(0,o-s-n)}getCoordinateSystem(t,e,i=0){const a=this.getContentArea(t,e),s=this.getTransformOffset();return{origin:{x:a.x,y:i+a.y},size:{width:a.width,height:a.height},transform:`translate(${s.x}, ${s.y})`,bounds:{left:this.margins.left,right:t-this.margins.right,top:i+this.margins.top,bottom:e-this.margins.bottom}}}updateMargins(){this.loadMargins(),this.validateMargins()}getMarginSummary(){return{margins:this.getMargins(),size:this.getSize(),validation:this.validateMargins()}}}class z extends u{constructor(t){super(t,"innerContainer"),this.childContainer=null,this.childNodes=[],this.layoutAlgorithm=null,this.coordinateSystem={origin:{x:0,y:0},size:{width:0,height:0},transform:"translate(0, 0)"}}createElement(){super.createElement(),this.node?.settings?.showInnerZoneRect?this.borderElement=this.element.append("rect").attr("class","zone-innerContainer").attr("x",0).attr("y",0).attr("width",0).attr("height",0):this.borderElement=null}setupStyling(){}setupInteractions(){}updateSize(){this.updateCoordinateSystem();const t=!!this.node?.settings?.showInnerZoneRect;t&&!this.borderElement&&this.element?this.borderElement=this.element.append("rect").attr("class","zone-innerContainer").attr("x",0).attr("y",0).attr("width",0).attr("height",0):!t&&this.borderElement&&(this.borderElement.remove(),this.borderElement=null);const e=this.calculateChildContentSize();if(this.borderElement){const t=Math.max(e.width,this.coordinateSystem.size.width),i=Math.max(e.height,1),a=-t/2,s=-i/2;this.borderElement.attr("width",t).attr("height",i).attr("x",a).attr("y",s)}this.element.attr("transform",this.coordinateSystem.transform)}updateCoordinateSystem(){const t=this.getHeaderHeight(),e=this.manager.getZone("margin");if(e){const i=e.getMargins(),a=Math.max(this.size.width,this.node.data.width||0),s=Math.max(this.size.height,this.node.data.height||0),n=-this.node.data.height/2,o=Math.max(0,a-i.left-i.right),h=Math.max(0,s-t-i.top-i.bottom),r=0,d=n+t+i.top+h/2;this.coordinateSystem={origin:{x:0,y:0},size:{width:o,height:h},transform:`translate(${r}, ${d})`}}else{const e=8,i=Math.max(this.size.width,this.node.data.width||0),a=Math.max(this.size.height,this.node.data.height||0),s=Math.max(0,i-2*e),n=Math.max(0,a-t-2*e),o=0,h=-this.node.data.height/2+t+e+n/2;this.coordinateSystem={origin:{x:0,y:0},size:{width:s,height:n},transform:`translate(${o}, ${h})`}}}getHeaderHeight(){const t=this.manager.getZone("header");return t?t.getHeaderHeight():0}getSize(){return this.node.collapsed?{width:this.size.width,height:0}:super.getSize()}getCoordinateSystem(){return{...this.coordinateSystem}}addChild(t){this.childNodes.includes(t)||(this.childNodes.push(t),t.element&&this.updateChildPositions())}removeChild(t){const e=this.childNodes.indexOf(t);e>-1&&(this.childNodes.splice(e,1),this.updateChildPositions())}getChildren(){return[...this.childNodes]}forceUpdateChildPositions(){setTimeout((()=>{this.updateChildPositions()}),0)}updateChildPositions(){const t=this.childNodes.filter((t=>t.element));0!==t.length&&(this.layoutAlgorithm?this.layoutAlgorithm(t,this.coordinateSystem):this.applyDefaultLayout())}applyDefaultLayout(){const t=this.childNodes.filter((t=>t.element));if(0===t.length)return;let e=0;const i=this.node.nodeSpacing?.vertical||10;t.forEach(((t,a)=>{const s=(this.coordinateSystem.size.width-t.data.width)/2,n=e;t.move(s,n),e+=t.data.height+i}))}setLayoutAlgorithm(t){this.layoutAlgorithm=t,this.updateChildPositions()}getLayoutAlgorithm(){return this.layoutAlgorithm}calculateChildContentSize(){const t=this.childNodes.filter((t=>t.element));if(0===t.length)return{width:0,height:0};this.node.nodeSpacing;let e=1/0,i=1/0,a=-1/0,s=-1/0;return t.forEach((t=>{const n=t.x||0,o=t.y||0,h=t.data.width,r=t.data.height,d=n-h/2,l=n+h/2,c=o-r/2,m=o+r/2;e=Math.min(e,d),i=Math.min(i,c),a=Math.max(a,l),s=Math.max(s,m)})),{width:a-e,height:s-i}}layoutVerticalStack(){const t=this.childNodes.filter((t=>t.element));if(0===t.length)return;const e=this.node.nodeSpacing?.vertical||10;let i=0;t.forEach((t=>{const a=(this.coordinateSystem.size.width-t.data.width)/2,s=i;t.move(a,s),i+=t.data.height+e}))}layoutHorizontalRow(){const t=this.childNodes.filter((t=>t.element));if(0===t.length)return;const e=this.node.nodeSpacing?.horizontal||20;let i=0;t.forEach((t=>{const a=i,s=(this.coordinateSystem.size.height-t.data.height)/2;t.move(a,s),i+=t.data.width+e}))}layoutBoundingBox(){const t=this.childNodes.filter((t=>t.element));if(0===t.length)return;const e=this.calculateChildContentSize(),i=this.coordinateSystem.size.width/2,a=this.coordinateSystem.size.height/2;t.forEach((t=>{const s=i-e.width/2+t.x,n=a-e.height/2+t.y;t.move(s,n)}))}getChildContainer(){return this.element}isWithinBounds(t,e){return t>=this.coordinateSystem.origin.x&&t<=this.coordinateSystem.origin.x+this.coordinateSystem.size.width&&e>=this.coordinateSystem.origin.y&&e<=this.coordinateSystem.origin.y+this.coordinateSystem.size.height}getBounds(){return{left:this.coordinateSystem.origin.x,top:this.coordinateSystem.origin.y,right:this.coordinateSystem.origin.x+this.coordinateSystem.size.width,bottom:this.coordinateSystem.origin.y+this.coordinateSystem.size.height,width:this.coordinateSystem.size.width,height:this.coordinateSystem.size.height}}updateChildVisibility(t){this.childNodes.forEach((e=>{e.visible=t,(e.isContainer&&t&&!e.collapsed||e.isContainer&&!t)&&e.propagateVisibility(t)}))}cleanupChildren(){this.childNodes.forEach((t=>{t.destroy&&t.destroy()})),this.childNodes=[]}getChildById(t){return this.childNodes.find((e=>e.id===t))}getChildrenByDatasetId(t){return this.childNodes.filter((e=>e.data.datasetId===t))}}class b{constructor(t){this.node=t,this.zones=new Map,this.zoneOrder=["container","header","margin","innerContainer"],this.initialized=!1}init(){this.initialized||(this.createZone("container",new f(this.node)),this.createZone("header",new y(this.node)),this.createZone("margin",new w(this.node)),this.node.collapsed||this.createZone("innerContainer",new z(this.node)),this.zones.forEach((t=>t.init())),this.initialized=!0)}createZone(t,e){this.zones.set(t,e),e.manager=this}getZone(t){return this.zones.get(t)}getAllZones(){return Array.from(this.zones.values())}update(){this.zones.forEach((t=>t.update()))}resize(t,e){this._lastResize&&this._lastResize.width===t&&this._lastResize.height===e||(this._lastResize={width:t,height:e},this.zones.forEach((i=>i.resize(t,e))))}get containerZone(){return this.getZone("container")}get headerZone(){return this.getZone("header")}get marginZone(){return this.getZone("margin")}get innerContainerZone(){return this.getZone("innerContainer")}calculateTotalSize(){const t=this.headerZone.getSize(),e=this.marginZone.getMargins(),i=this.innerContainerZone?this.innerContainerZone.getSize():{width:0,height:0};if(this.node.collapsed){const a=this.node.minimumSize?.height||0,s=Math.max(t.height,a);return{width:Math.max(t.width,i.width)+e.left+e.right,height:s}}const a=Math.max(t.width,i.width)+e.left+e.right,s=t.height+e.top+i.height+e.bottom,n=t.height+e.top+e.bottom,o=this.node.minimumSize?.height||0;return{width:a,height:Math.max(s,n,o)}}getChildCoordinateSystem(){return this.innerContainerZone?this.innerContainerZone.getCoordinateSystem():{origin:{x:0,y:0},size:{width:0,height:0},transform:"translate(0, 0)"}}handleEvent(t,e,i=null){if(i){const a=this.getZone(i);a&&a.handleEvent(t,e)}else this.zones.forEach((i=>i.handleEvent(t,e)))}destroy(){this.zones.forEach((t=>t.destroy())),this.zones.clear(),this.initialized=!1}updateZoneVisibility(){this.node.collapsed?(this.innerContainerZone&&this.innerContainerZone.setVisible(!1),this.marginZone&&this.marginZone.setVisible(!1)):(this.innerContainerZone&&this.innerContainerZone.setVisible(!0),this.marginZone&&this.marginZone.setVisible(!0))}ensureInnerContainerZone(){if(!this.innerContainerZone){this.createZone("innerContainer",new z(this.node));const t=this.innerContainerZone;t.init(),t.resize(this.node.data.width,this.node.data.height),t.update()}return this.innerContainerZone}}const x=Object.freeze({UNDETERMINED:"Undetermined",UNKNOWN:"Unknown",DISABLED:"Disabled",READY:"Ready",UPDATING:"Updating",UPDATED:"Updated",SKIPPED:"Skipped",DELAYED:"Delayed",WARNING:"Warning",ERROR:"Error"});class C{constructor(t,e,i,a=null){this.isContainer=!1,this.data=t,this.parentElement=e,this.parentNode=a,this.settings=p.mergeWithDefaults(i),this.computeConnectionPoints=r,this.onDisplayChange=null,this.onClick=null,this.onDblClick=null,this._selected=!1,this._status=t.state??x.UNKNOWN,this._visible=t.visible??!0,this._collapsed=t.collapsed??!1,this.suspenseDisplayChange=!1,this.id=t.id,this.edges={incoming:[],outgoing:[]},this.element=null,this.simulation=null,this.zoneManager=null,this.x??=0,this.y??=0,this.data.width??=60,this.data.height??=60}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.element&&(t?this.element.style("display",null):this.element.style("display","none")))}get collapsed(){return this._collapsed}set collapsed(t){t!==this._collapsed&&(this._collapsed=t,this.element.classed("collapsed",this.collapsed),this.element.classed("expanded",!this.collapsed))}get status(){return this._status}set status(t){this._status=t,this.element&&this.element.attr("status",t),m.shouldCollapseOnStatus(t,this.settings)&&(this.collapsed=!0),this.settings.cascadeOnStatusChange&&this.cascadeStatusChange()}get selected(){return this._selected}set selected(t){this._selected=t,this.element.classed("selected",this._selected)}handleDisplayChange(){this.suspenseDisplayChange||(this.onDisplayChange?this.onDisplayChange():this.parentNode&&"function"==typeof this.parentNode.handleDisplayChange&&this.parentNode.handleDisplayChange())}move(t,e){this.x=t,this.y=e,this.element&&(this.element.attr("transform",`translate(${this.x}, ${this.y})`),this.suspenseDisplayChange||this.handleDisplayChange())}init(t=null){if(t&&(this.parentElement=t),this.element=this.parentElement.append("g").attr("class",this.data.type).attr("id",this.id).attr("status",this.status),this.element.node().__node=this,this.isContainer&&(this.zoneManager=new b(this),this.zoneManager.init(),this.zoneManager&&this.zoneManager.resize(this.data.width,this.data.height)),c.setupDefaultNodeEvents(this),this.element.classed("collapsed",this.collapsed),this.element.classed("expanded",!this.collapsed),this.settings.showCenterMark&&this.element.append("circle").attr("class","centermark").attr("r",3).attr("cx",0).attr("cy",0),this.settings.showConnectionPoints){this.connectionPointsGroup=this.element.append("g").attr("class","connection-points");const t=this.computeConnectionPoints(0,0,this.data.width,this.data.height);Object.values(t).forEach((t=>{this.connectionPointsGroup.append("circle").attr("class",`connection-point side-${t.side}`).attr("cx",t.x).attr("cy",t.y).attr("r",2)}));try{this.settings.isDebug&&this.element?.node()?.getBBox?.()}catch{}}this.handleDisplayChange()}update(){if(this.isContainer&&this.zoneManager&&this.zoneManager.update(),this.settings.showConnectionPoints){let t=this.data.width,e=this.data.height,i=null;if(!this.isContainer)try{i=this.element?.node()?.getBBox(),i&&i.width>0&&i.height>0&&(t=i.width,e=i.height)}catch{}this.settings.isDebug;const a=this.computeConnectionPoints(0,0,t,e);Object.values(a).forEach((t=>{(this.connectionPointsGroup||this.element).select(`.connection-point.side-${t.side}`).attr("cx",t.x).attr("cy",t.y)}));try{this.settings.isDebug}catch{}}}handleClicked(t,e=this){c.handleNodeClick(this,t)}handleDblClicked(t,e=this){c.handleNodeDblClick(this,t)}resize(t,e=!1){(e||this.data.width!==t.width||this.data.height!==t.height)&&(this.data.width=t.width,this.data.height=t.height,this.isContainer&&this.zoneManager&&this.zoneManager.resize(t.width,t.height),this.update(),this.handleDisplayChange())}getNode(t){return this.id==t?this:null}getNodesByDatasetId(t){return this.data.datasetId==t?[this]:[]}getAllNodes(t=!1,e=!1){return t&&!this.selected?[]:[this]}getAllEdges(t=!1,e=[]){this.edges.incoming.forEach((i=>{t&&!i.selected||-1===e.indexOf(i)&&e.push(i)})),this.edges.outgoing.forEach((i=>{t&&!i.selected||-1===e.indexOf(i)&&e.push(i)}))}isDescendantOf(t){let e=this.parentNode;for(;e;){if(e===t)return!0;e=e.parentNode}return!1}getNeighbors(t={incomming:1,outgoing:1}){const e={nodes:[],edges:[]};return t.incomming>0&&this.edges.incoming.forEach((i=>{e.edges.push(i),t.incomming>1?e.nodes.push(...i.source.getNeighbors({incomming:t.incomming-1,outgoing:0})):e.nodes.push(i.source)})),e.nodes.push(this),t.outgoing>0&&this.edges.outgoing.forEach((i=>{e.edges.push(i),t.outgoing>1?e.nodes.push(...i.target.getNeighbors({incomming:0,outgoing:t.outgoing-1})):e.nodes.push(i.target)})),e}getParents(){if(!this.parentNode)return[];if("function"==typeof this.parentNode.getParents){const t=this.parentNode.getParents();return Array.isArray(t)?[this.parentNode,...t]:[this.parentNode]}return[this.parentNode]}cascadeUpdate(){this.parentNode&&(this.parentNode.update(),this.parentNode.cascadeUpdate())}cascadeStatusChange(){this.parentNode&&"function"==typeof this.parentNode.determineStatusBasedOnChildren&&this.parentNode.determineStatusBasedOnChildren()}cascadeRestartSimulation(){this.simulation&&this.simulation.simulation.alphaTarget(.8).restart(),this.parentNode&&this.parentNode.cascadeRestartSimulation()}cascadeStopSimulation(){this.simulation&&this.simulation.simulation.alphaTarget(0),this.parentNode&&this.parentNode.cascadeStopSimulation()}drag_started(t,e){e.cascadeRestartSimulation(),t.fx=t.x,t.fy=t.y,e.element.classed("grabbing",!0)}dragged(t,e){t.fx=t.x,t.fy=t.y,e.move(t.fx,t.fy)}drag_ended(t,e){e.element.classed("grabbing",!1),e.cascadeStopSimulation()}getEffectiveWidth(){return this.collapsed?this.minimumSize?.width||20:this.data.width}getEffectiveHeight(){return this.collapsed?this.minimumSize?.height||20:this.data.height}}function M(t){const e=d3.select("body").append("svg").attr("class","temp-svg"),i=e.append("text").attr("x",-9999).attr("y",-9999).text(t).node().getBBox().width;return e.remove(),i}function v(t){return t.node().getBBox()}function S(t,e){if(!t||"function"!=typeof t.node||!t.node())return{x:0,y:0,width:0,height:0};const i=t.node().getBBox?.()||{x:0,y:0,width:0,height:0};if(!e||"function"!=typeof e.node||!e.node())return{x:i.x,y:i.y,width:i.width,height:i.height};const a=t.node().getCTM?.(),s=e.node().getCTM?.();if(!a||!s)return{x:i.x,y:i.y,width:i.width,height:i.height};const n=s.inverse().multiply(a);return{x:n.e+i.x*n.a+i.y*n.c,y:n.f+i.x*n.b+i.y*n.d,width:i.width,height:i.height}}class N{static calculateBoundingBox(t,e=0){if(0===t.length)return{x:0,y:0,width:0,height:0};let[i,a,s,n]=[1/0,1/0,-1/0,-1/0];return t.forEach((t=>{const e=t.data.width/2,o=t.data.height/2;i=Math.min(i,t.x-e),a=Math.min(a,t.y-o),s=Math.max(s,t.x+e),n=Math.max(n,t.y+o)})),{x:i-e,y:a-e,width:s-i+2*e,height:n-a+2*e}}static calculateContainerSize(t,e,i){const a=this.calculateBoundingBox(t);return{width:a.width+e.left+e.right,height:a.height+e.top+e.bottom}}static adjustPositionForContainer(t,e){return{x:t.x+e.x,y:t.y+e.y}}static calculateMinimumSize(t,e={width:100,height:100}){if(0===t.length)return e;const i=this.calculateBoundingBox(t);return{width:Math.max(i.width,e.width),height:Math.max(i.height,e.height)}}static calculateExpandedSize(t,e,i){const a=this.calculateBoundingBox(t);return{width:a.width+e.left+e.right,height:a.height+e.top+e.bottom}}static getNodeCenter(t){return{x:t.x,y:t.y}}static getNodeBounds(t){const e=t.data.width/2,i=t.data.height/2;return{left:t.x-e,right:t.x+e,top:t.y-i,bottom:t.y+i}}static isNodeOverlapping(t,e,i=0){const a=this.getNodeBounds(t),s=this.getNodeBounds(e);return!(a.right+i<s.left||a.left>s.right+i||a.bottom+i<s.top||a.top>s.bottom+i)}}class T extends C{constructor(t,e,i,a,s=null){t.width??=0,t.height??=0,t.expandedSize??={width:t.width,height:t.height},"string"==typeof t.layout&&(t.layout={type:t.layout}),t.layout??={},t.layout.minimumSize??={width:0,height:0},t.layout.minimumSize.width??=0,t.layout.minimumSize.height??=0,t.layout.minimumSize.useRootRatio??=!1,super(t,e,a,s),this.data.type??="container",this.isContainer=!0,this.createNode=i,this.simulation=null,this.edgesContainer??=null,this.containerMargin={...p.getDefaultContainerMargin(),...this.settings?.containerMargin||{}},this.nodeSpacing={...p.getDefaultNodeSpacing(),...this.settings?.nodeSpacing||{}},this.childNodes=[],this.zoneManager=null,this.childEdges=[]}get nestedCorrection_y(){try{const t=this.zoneManager?.innerContainerZone,e=t?.coordinateSystem?.transform;if(e&&"string"==typeof e){const t=e.match(/translate\(([^,]+),\s*([^)]+)\)/);if(t)return parseFloat(t[2])}}catch{}return this.y-this.data.height/2+this.containerMargin.top}get nestedCorrection_x(){try{const t=this.zoneManager?.innerContainerZone,e=t?.coordinateSystem?.transform;if(e&&"string"==typeof e){const t=e.match(/translate\(([^,]+),\s*([^)]+)\)/);if(t)return parseFloat(t[1])}}catch{}return this.x}get collapsed(){return super.collapsed}set collapsed(t){t!==this._collapsed&&(super.collapsed=t,this.collapsed?(this.collapse(),this.handleDisplayChange(this,!1)):this.expand(),this.cascadeUpdate())}propagateVisibility(t){this.childNodes.forEach((e=>{e.visible=t,e instanceof T&&!e.collapsed&&e.propagateVisibility(t)}))}get visible(){return this._visible}set visible(t){t!==this._visible&&(super.visible=t)}get status(){return super.status}set status(t){super.status=t}determineStatusBasedOnChildren(){if(0===this.childNodes.length)return;if(!this.settings.cascadeOnStatusChange)return;const t=m.calculateContainerStatus(this.childNodes,this.settings);this.status=t}handleDisplayChange(t=this,e=!0){this.suspenseDisplayChange||(this.onDisplayChange?this.onDisplayChange():e&&this.parentNode&&"function"==typeof this.parentNode.handleDisplayChange&&this.parentNode.handleDisplayChange())}resize(t,e=!1){t.width=Math.max(t.width,this.minimumSize.width),t.height=Math.max(t.height,this.minimumSize.height),super.resize(t,e)}resizeContainer(t,e=!1){t.width+=this.containerMargin.left+this.containerMargin.right,t.height+=this.containerMargin.top+this.containerMargin.bottom,this.resize(t,e)}expand(){if(this.parentNode&&this.parentNode.collapsed)this.parentNode.collapsed=!1;else{if(this.zoneManager){const t=this.zoneManager.ensureInnerContainerZone?this.zoneManager.ensureInnerContainerZone():this.zoneManager.innerContainerZone;if(t.element&&t.initialized||(t.init(),this.zoneManager?this.zoneManager.resize(this.data.width,this.data.height):t.resize(this.data.width,this.data.height),t.update()),this.zoneManager.updateZoneVisibility(),!t.layoutAlgorithm)if("function"==typeof this.layoutLane)this.layoutLane();else if("function"==typeof this.layoutColumns)this.layoutColumns();else if("function"==typeof this.updateChildren&&!this._updating){this._updating=!0;try{this.updateChildren()}finally{this._updating=!1}}if("function"==typeof this.updateChildren&&!this._updating){this._updating=!0;try{this.updateChildren()}finally{this._updating=!1}}if(this.zoneManager.update(),this.attachChildrenToDOM(),t.layoutAlgorithm&&t.updateChildPositions(),t.update(),t.updateChildVisibility(!0),!this.collapsed){const e=this.zoneManager?.headerZone,i=e?e.getHeaderHeight():20,a=this.zoneManager?.marginZone?this.zoneManager.marginZone.getMargins():{top:8,right:8,bottom:8,left:8},s=t.calculateChildContentSize(),n=s.width+a.left+a.right,o=e&&"function"==typeof e.getMinimumWidthThrottled?e.getMinimumWidthThrottled():e&&"function"==typeof e.getMinimumWidth?e.getMinimumWidth():e&&e.getSize?.().width||0,h=2,r=Math.max(this.data.width,this.minimumSize.width,n,o+h),d=Math.max(this.minimumSize.height,i+a.top+s.height+a.bottom);if(this.resize({width:r,height:d},!0),this.zoneManager&&!this.zoneManager._resizing){this.zoneManager._resizing=!0;try{this.zoneManager.resize(r,d)}finally{this.zoneManager._resizing=!1}}this.zoneManager.update(),t.updateChildPositions(),t.update()}}this.edgesContainer&&this.edgesContainer.style("display",null),this.ghostContainer&&this.ghostContainer.style("display",null);const t={width:this.data.width,height:this.data.height};if((this.data.height>t.height+5||this.data.width>t.width+5)&&(this.data.expandedSize={width:this.data.width,height:this.data.height}),this.parentNode&&!this.parentNode._updating){this.parentNode._updating=!0;try{this.parentNode.updateChildren()}finally{this.parentNode._updating=!1}}this.initEdges()}}collapse(){if(this.suspenseDisplayChange=!0,(this.data.height>this.minimumSize.height+5||this.data.width>this.minimumSize.width+5)&&(this.data.expandedSize={height:this.data.height,width:this.data.width}),this.zoneManager){this.detachChildrenFromDOM(),this.edgesContainer&&(this.edgesContainer.remove(),this.edgesContainer=null),this.ghostContainer&&(this.ghostContainer.remove(),this.ghostContainer=null);const t=this.zoneManager.innerContainerZone;t&&"function"==typeof t.destroy&&t.destroy(),this.zoneManager.updateZoneVisibility()}else this.cleanContainer();this.edgesContainer&&this.edgesContainer.style("display","none"),this.ghostContainer&&this.ghostContainer.style("display","none"),this.update();let t=0,e=this.minimumSize.height;this.zoneManager?.headerZone&&(t="function"==typeof this.zoneManager.headerZone.getMinimumWidthThrottled?this.zoneManager.headerZone.getMinimumWidthThrottled():"function"==typeof this.zoneManager.headerZone.getMinimumWidth?this.zoneManager.headerZone.getMinimumWidth():this.zoneManager.headerZone.getSize().width||0,e=this.zoneManager.headerZone.getHeaderHeight?.()??this.zoneManager.headerZone.getSize().height??e);const i=Math.max(t,this.minimumSize.width),a=Math.max(e,this.minimumSize.height);if(this.resize({width:i,height:a},!0),this.zoneManager)try{this.zoneManager.resize(i,a)}catch{}this.parentNode&&this.parentNode.update(),this.suspenseDisplayChange=!1}getNode(t){if(this.id==t)return this;for(const e of this.childNodes){const i=e.getNode(t);if(i)return i}return null}getNodesByDatasetId(t){var e=[];if(this.data.datasetId==t&&e.push(this),this.childNodes)for(const i of this.childNodes)e.push(...i.getNodesByDatasetId(t));return e}positionContainer(){if(!this.zoneManager){var t=v(this.element),e=v(this.element).y-t.y+this.containerMargin.top;this.element.attr("transform",`translate(0, ${e})`)}}initEdges(t=!1){this.collapsed||(this.childEdges.length>0&&(this.settings.showGhostlines&&(this.ghostContainer?this.ghostContainer.selectAll("*").remove():this.ghostContainer=this.element.append("g").attr("class",(t=>"ghostlines"))),null==this.edgesContainer?this.edgesContainer=this.element.append("g").attr("class",(t=>"edges")):this.edgesContainer.selectAll("*").remove(),this.childEdges.forEach((t=>t.init()))),t&&this.childNodes.forEach((e=>{e instanceof T&&e.initEdges(t)})))}updateEdges(){this.visible&&(this.collapsed||this.childEdges.length>0&&this.childEdges.forEach((t=>t.update())))}getAllNodes(t=!1,e=!1){const i=[];return t&&!this.selected||e||i.push(this),this.childNodes&&this.childNodes.forEach((a=>{i.push(...a.getAllNodes(t,e))})),i}getAllEdges(t=!1,e=[]){super.getAllEdges(t,e),this.childNodes&&this.childNodes.forEach((i=>{i.getAllEdges(t,e)}))}init(t=null){t&&(this.parentElement=t),super.init(t);let e=8*(this.data.label||"").length+36,i=20;if(this.zoneManager?.headerZone){const t=this.zoneManager.headerZone;if("function"==typeof t.getMinimumWidthThrottled)try{e=t.getMinimumWidthThrottled()}catch{}else if("function"==typeof t.getMinimumWidth)try{e=t.getMinimumWidth()}catch{}else{const i=t.getSize?.();i?.width&&(e=i.width)}i=t.getHeaderHeight?.()??i}const a={width:e,height:i};this.minimumSize=N.calculateMinimumSize([],a),this.data.layout.minimumSize.width>this.minimumSize.width&&(this.minimumSize.width=this.data.layout.minimumSize.width),this.data.layout.minimumSize.height>this.minimumSize.height&&(this.minimumSize.height=this.data.layout.minimumSize.height),this.data.layout.minimumSize.useRootRatio&&this.applyMinimumSize(),(this.data.width<this.minimumSize.width||this.data.height<this.minimumSize.height)&&this.resize({width:Math.max(this.minimumSize.width,this.data.width),height:Math.max(this.minimumSize.height,this.data.height)},!0),this.data.children&&this.data.children.length>0&&this.initChildren(),this.collapsed?this.collapse():this.expand(),this.element.attr("transform",`translate(${this.x}, ${this.y})`),this._didPostInitMeasure||(this._didPostInitMeasure=!0,setTimeout((()=>{try{const t=this.zoneManager?.headerZone;if(!t)return;const e="function"==typeof t.getMinimumWidthThrottled?t.getMinimumWidthThrottled():"function"==typeof t.getMinimumWidth?t.getMinimumWidth():t.getSize?.().width||0,i=Math.max(this.data.width||0,this.minimumSize?.width||0,e||0);if(i>(this.data.width||0)){const t={width:i,height:this.data.height};this.resize(t,!0),this.zoneManager&&this.zoneManager.resize(t.width,t.height),this.update()}}catch{}}),0))}initChildren(){if(this.data.children&&0!==this.data.children.length){if(0==this.data.children.length){const t=this.data.width-this.containerMargin.left-this.containerMargin.right,e=this.data.height-this.containerMargin.top-this.containerMargin.bottom;this.element.append("rect").attr("class",`${this.data.type} placeholder`).attr("width",t).attr("height",e).attr("x",-t/2).attr("y",-e/2)}else{const e=this.zoneManager?.innerContainerZone?.getChildContainer()||this.element;for(const i of this.data.children){var t=this.getNode(i.id);null==t&&(t=this.createNode(i,e,this.settings,this),this.childNodes.push(t),this.zoneManager?.innerContainerZone?this.zoneManager.innerContainerZone.addChild(t):console.warn("Zone system not available for child:",i.id)),t.init(e)}this.zoneManager?.innerContainerZone&&this.zoneManager.innerContainerZone.forceUpdateChildPositions()}if(!this._updating){this._updating=!0;try{this.updateChildren()}finally{this._updating=!1}}}}update(){if(super.update(),!this._updating){this._updating=!0;try{this.updateChildren()}finally{this._updating=!1}}this.collapsed||this.updateEdges()}updateChildren(){this.zoneManager||this.element.attr("transform",`translate(\n            ${this.containerMargin.left-this.containerMargin.right}, \n            ${this.containerMargin.top-this.containerMargin.bottom}\n          )`)}cleanContainer(t=!0){this.element.selectAll("*").remove(),this.edgesContainer=null;for(const e of this.childNodes)e instanceof T&&e.cleanContainer(t)}detachChildrenFromDOM(){this.childNodes&&0!==this.childNodes.length&&this.childNodes.forEach((t=>{try{t.visible=!1,t.element&&(t.element.remove(),t.element=null),t.zoneManager&&"function"==typeof t.zoneManager.destroy&&(t.zoneManager.destroy(),t.zoneManager=null)}catch(e){console.warn("Failed detaching child from DOM:",t?.id,e)}}))}attachChildrenToDOM(){if(!this.childNodes||0===this.childNodes.length)return;const t=this.zoneManager?.ensureInnerContainerZone?this.zoneManager.ensureInnerContainerZone():this.zoneManager?.innerContainerZone,e=t?.getChildContainer()||this.element;this.childNodes.forEach((i=>{try{if(i.element||i.init(e),t&&t.addChild(i),i.visible=!0,i.isContainer){if("function"==typeof i.propagateVisibility&&i.propagateVisibility(!0),i.zoneManager?.innerContainerZone&&(!i.zoneManager.innerContainerZone.element||!i.zoneManager.innerContainerZone.initialized)&&!i.collapsed){if(i.zoneManager.innerContainerZone.init(),i.zoneManager&&!i.zoneManager._resizing){i.zoneManager._resizing=!0;try{i.zoneManager.resize(i.data.width,i.data.height)}finally{i.zoneManager._resizing=!1}}i.zoneManager.innerContainerZone.update()}if(i.zoneManager&&i.zoneManager.update(),!i.collapsed&&"function"==typeof i.updateChildren&&!i._updating){i._updating=!0;try{i.updateChildren()}finally{i._updating=!1}}!i.collapsed&&i.zoneManager?.innerContainerZone&&i.zoneManager.innerContainerZone.updateChildPositions()}}catch(t){console.warn("Failed attaching child to DOM:",i?.id,t)}})),t&&t.forceUpdateChildPositions(),this.zoneManager&&this.zoneManager.update(),setTimeout((()=>{try{this.childNodes.forEach((t=>{if(t.isContainer){if(t.zoneManager&&t.zoneManager.update(),!t.collapsed&&"function"==typeof t.updateChildren&&!t._updating){t._updating=!0;try{t.updateChildren()}finally{t._updating=!1}}!t.collapsed&&t.zoneManager?.innerContainerZone&&t.zoneManager.innerContainerZone.updateChildPositions()}})),t&&t.updateChildPositions(),this.zoneManager&&this.zoneManager.update()}catch(t){console.warn("Deferred layout after reattach failed for",this.id,t)}}),0)}applyMinimumSize(){if(this.minimumSize.width<this.data.layout.minimumSize.width&&(this.minimumSize.width=this.data.layout.minimumSize.width),this.minimumSize.height<this.data.layout.minimumSize.height&&(this.minimumSize.height=this.data.layout.minimumSize.height),!this.data.layout.minimumSize.useRootRatio)return;const t=this.settings&&this.settings.divRatio&&this.settings.divRatio>0?this.settings.divRatio:16/9,e=this.data.height||this.minimumSize.height||1;this.minimumSize.width/e>t?this.minimumSize.height=this.minimumSize.width/t:this.minimumSize.width=this.minimumSize.height*t}}class E extends C{constructor(t,e,i,a=null){t.height||(t.height=20);const s=t.layout?.layoutMode||"default";if("auto-size"===s){const e=M(t.label);t.width=Math.max(e+20,60)}else if("fixed-size"===s)t.width||(t.width=150);else{t.width||(t.width=150);const e=M(t.label),i=Math.max(t.width,e+20);t.width=i}super(t,e,i,a)}init(t=null){t&&(this.parentElement=t),super.init(t),this.draw(),this.update()}draw(){if(this.shape=this.element.append("rect").attr("class",`${this.data.type} shape`).attr("width",this.data.width).attr("height",this.data.height).attr("status",this.status).attr("x",-this.data.width/2).attr("y",-this.data.height/2),this.label=this.element.append("text").attr("class",`${this.data.type} label`).attr("x",0).attr("y",0).text(this.data.label),this.applyCustomStyling(),this.truncateTextIfNeeded(),this.settings.showConnectionPoints){(this.connectionPointsGroup||this.element).selectAll("circle.connection-point").remove();const t=this.data.width,e=this.data.height;try{this.settings.isDebug&&this.element?.node()?.getBBox?.()}catch{}const i=this.computeConnectionPoints(0,0,t,e);Object.values(i).forEach((t=>{(this.connectionPointsGroup||this.element).append("circle").attr("class",`connection-point side-${t.side}`).attr("cx",t.x).attr("cy",t.y).attr("r",2)}))}}applyCustomStyling(){this.settings.containerFill&&this.shape.attr("fill",this.settings.containerFill),this.settings.containerStroke&&this.shape.attr("stroke",this.settings.containerStroke),this.settings.containerStrokeWidth&&this.shape.attr("stroke-width",this.settings.containerStrokeWidth),this.settings.fontFamily&&this.label.attr("font-family",this.settings.fontFamily),this.settings.fontSize&&this.label.attr("font-size",this.settings.fontSize),this.settings.fontWeight&&this.label.attr("font-weight",this.settings.fontWeight),this.settings.textColor&&this.label.attr("fill",this.settings.textColor)}truncateTextIfNeeded(){if(!this.label)return;const t=this.data.width-20,e=this.data.label;if(this.data.layout,this.parentNode&&"adapter"===this.parentNode.data.type&&"role"===this.parentNode.data.layout?.displayMode)return this.label.text(e),void this.removeTooltip();if(M(e)<=t)return this.label.text(e),void this.removeTooltip();let i=e;for(;i.length>0;){const a=i.replace(/\s+$/,"")+"...";if(M(a)<=t)return this.label.text(a),void this.addTooltip(e);i=i.slice(0,-1)}this.label.text("..."),this.addTooltip(e)}redrawText(t,e){void 0!==t&&(this.data.label=t),void 0!==e&&(this.data.width=e);const i=this.data.layout?.layoutMode||"default";if(this.parentNode&&"adapter"===this.parentNode.data.type&&"role"===this.parentNode.data.layout?.displayMode)this.element.select("rect").attr("width",this.data.width).attr("x",-this.data.width/2),this.label.text(this.data.label),this.removeTooltip();else if("auto-size"===i&&void 0!==t){const e=M(t),i=Math.max(e+20,60);this.data.width=i,this.element.select("rect").attr("width",this.data.width).attr("x",-this.data.width/2),this.label.text(t),this.removeTooltip()}else if("fixed-size"===i)this.element.select("rect").attr("width",this.data.width).attr("x",-this.data.width/2),this.truncateTextIfNeeded();else{if(void 0!==t){const e=M(t);this.data.width=Math.max(this.data.width,e+20)}this.element.select("rect").attr("width",this.data.width).attr("x",-this.data.width/2),this.truncateTextIfNeeded()}}get status(){return super.status}set status(t){super.status=t,this.shape&&this.shape.attr("status",t);const e=this.settings.statusColors||{};e[t]&&(e[t].border&&this.shape.attr("stroke",e[t].border),e[t].fill&&this.shape.attr("fill",e[t].fill))}update(){if(super.update(),this.settings.showConnectionPoints){const t=this.element.select("rect");if(!t.empty()){const e=parseFloat(t.attr("width"))||this.data.width,i=parseFloat(t.attr("height"))||this.data.height;try{this.settings.isDebug&&this.element?.node()?.getBBox?.()}catch{}const a=this.computeConnectionPoints(0,0,e,i);Object.values(a).forEach((t=>{(this.connectionPointsGroup||this.element).select(`.connection-point.side-${t.side}`).attr("cx",t.x).attr("cy",t.y)}));try{this.settings.isDebug}catch{}}}this.label&&this.data.label!==this.label.text()&&this.handleTextUpdate()}handleTextUpdate(){const t=this.data.layout?.layoutMode||"default";if(this.parentNode&&"adapter"===this.parentNode.data.type&&"role"===this.parentNode.data.layout?.displayMode)this.label.text(this.data.label),this.removeTooltip();else if("auto-size"===t){const t=M(this.data.label),e=Math.max(t+20,60);e!==this.data.width?(this.data.width=e,this.element.select("rect").attr("width",this.data.width).attr("x",-this.data.width/2),this.label.text(this.data.label)):this.label.text(this.data.label)}else this.truncateTextIfNeeded()}resize(t,e=!1){void 0!==t.width&&(this.data.width=t.width),void 0!==t.height&&(this.data.height=t.height),super.resize(t,e),this.element.select("rect").attr("width",this.data.width).attr("height",this.data.height).attr("x",-this.data.width/2).attr("y",-this.data.height/2),this.element.select("text").attr("x",0).attr("y",0);const i=this.data.layout?.layoutMode||"default";if(this.parentNode&&"adapter"===this.parentNode.data.type&&"role"===this.parentNode.data.layout?.displayMode?(this.label.text(this.data.label),this.removeTooltip()):"auto-size"!==i&&this.truncateTextIfNeeded(),this.settings.showConnectionPoints){const t=this.element.select("rect");if(!t.empty()){const e=parseFloat(t.attr("width"))||this.data.width,i=parseFloat(t.attr("height"))||this.data.height;try{this.settings.isDebug&&this.element?.node()?.getBBox?.()}catch{}const a=this.computeConnectionPoints(0,0,e,i);Object.values(a).forEach((t=>{(this.connectionPointsGroup||this.element).select(`.connection-point.side-${t.side}`).attr("cx",t.x).attr("cy",t.y)}));try{this.settings.isDebug}catch{}}}}addTooltip(t){this.label&&t&&(this.removeTooltip(),this.tooltipElement=this.label.append("title").text(t),this.label.style("cursor","help"))}removeTooltip(){this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null),this.label&&this.label.style("cursor","default")}}const k=Object.freeze({READY:"ready",ACTIVE:"active",ERROR:"error",WARNING:"warning",UNKNOWN:"unknown",DISABLED:"disabled"});class R{constructor(t,e,i){this.data=t,this.parents=e,this.settings=i,this._status=k.UNKNOWN,this._selected=!1,this.onClick=null,this.onDblClick=null,this.element=null,this.ghostElement=null,this.data.active??=!0,this.data.type??="unknown",this.settings||(this.settings={}),this.settings.showGhostlines??=!1,this.settings.showEdges??=!0,this.settings.curved??=!1,this.settings.curveMargin??=this.settings.curved?.1:0,this.id??=`${this.source.id}--${this.data.type}--${this.target.id}`}get label(){return`${this.source.data.label} --${this.data.type}--\x3e ${this.target.data.label}`}get parent(){return this.parents&&this.parents.container?this.parents.container:(console.error("No parent or container for edge:",this.id),null)}get sourceIndex(){for(let t=this.parents.source.length-1;t>0;t--)if(this.parents.source[t].collapsed)return t;return 0}get source(){return this.parents.source[this.sourceIndex]}get targetIndex(){for(let t=this.parents.target.length-1;t>0;t--)if(this.parents.target[t].collapsed)return t;return 0}get target(){return this.parents.target[this.targetIndex]}get status(){return this._status}set status(t){this._status=t,this.element.attr("status",t)}get selected(){return this._selected}set selected(t){this._selected=t,this.element?this.element.classed("selected",this._selected):console.warn("No element to select.")}get x1(){if(!this.source)return null;let t=0;for(let e=this.sourceIndex+2;e<this.parents.source.length;e++)t+=this.parents.source[e].nestedCorrection_x;let e=0;for(let t=this.sourceIndex+1;t<this.parents.source.length;t++){const i=this.parents.source[t];"number"==typeof i.x&&(e+=i.x)}const i=l(this.source);return this.settings,this.source.x+t+i.x+e}get y1(){if(!this.source)return null;let t=0;for(let e=this.sourceIndex+2;e<this.parents.source.length;e++)t+=this.parents.source[e].nestedCorrection_y;let e=0;for(let t=this.sourceIndex+1;t<this.parents.source.length;t++){const i=this.parents.source[t];"number"==typeof i.y&&(e+=i.y)}const i=l(this.source);return this.settings,this.source.y+t+i.y+e}get x2(){if(!this.target)return null;let t=0;for(let e=this.targetIndex+2;e<this.parents.target.length;e++)t+=this.parents.target[e].nestedCorrection_x;let e=0;for(let t=this.targetIndex+1;t<this.parents.target.length;t++){const i=this.parents.target[t];"number"==typeof i.x&&(e+=i.x)}const i=l(this.target);return this.settings,this.target.x+t+i.x+e}get y2(){if(!this.target)return null;let t=0;for(let e=this.targetIndex+2;e<this.parents.target.length;e++)t+=this.parents.target[e].nestedCorrection_y;let e=0;for(let t=this.targetIndex+1;t<this.parents.target.length;t++){const i=this.parents.target[t];"number"==typeof i.y&&(e+=i.y)}const i=l(this.target);return this.settings,this.target.y+t+i.y+e}get sourcePoint(){return[this.x1,this.y1]}get targetPoint(){return[this.x2,this.y2]}init(t=null){t&&(this.parentElement=t),this.settings.showGhostlines&&(this.ghostElement=this.parent.ghostContainer.append("g").attr("class","edge ghostline"),this.ghostElement.append("path").attr("class","path")),this.settings.showEdges&&(this.element=this.parent.edgesContainer.append("g").attr("class",`edge ${this.data.type}`).attr("id",this.id).on("click",(t=>{t&&t.stopPropagation(),this.handleClicked(t)})).on("dblclick",(t=>{t&&t.stopPropagation(),this.handleDblClicked(t)})),this.element.append("path").attr("class","path")),this.update()}update(){if(this.settings.showGhostlines){const e=[[(t=this).x1,t.y1],[t.x2,t.y2]],i=this.ghostlineGenerator();this.ghostElement.select(".path").attr("d",i(e))}var t;if(this.settings.showEdges){const t=function(t){const e=t.source,i=t.target,a=e.computeConnectionPoints(t.x1,t.y1,e.data.width,e.data.height),s=i.computeConnectionPoints(t.x2,t.y2,i.data.width,i.data.height);let n,o,r=Number.MAX_VALUE;Object.values(a).forEach((t=>{Object.values(s).forEach((e=>{if(n||(n=t),o||(o=e),t.side==h.BOTTOM&&t.y>e.y||e.side==h.TOP&&t.y>e.y||t.side==h.TOP&&t.y<e.y||e.side==h.BOTTOM&&t.y<e.y)return;if(t.side==h.LEFT&&t.x<e.x||t.side==h.RIGHT&&t.x>e.x||e.side==h.RIGHT&&t.x<e.x||e.side==h.LEFT&&t.x>e.x)return;const i=Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2);i<r&&(r=i,n=t,o=e)}))}));let l=[];const c=(o.x-n.x)/2;var m=(o.y-n.y)/2;const g=t.settings.curveMargin||0;return n.side==h.LEFT&&o.side==h.RIGHT||n.side==h.RIGHT&&o.side==h.LEFT?l=[[n.x+c*(1-g),n.y+m*g],[n.x+c*(1+g),o.y-m*g]]:n.side==h.BOTTOM&&o.side==h.TOP||n.side==h.TOP&&o.side==h.BOTTOM?l=Math.abs(m)<20&&t.settings.curved?[[n.x+c*g,o.y],[o.x,n.y]]:[[n.x+c*g,n.y+m*(1-g)],[o.x-c*g,n.y+m*(1+g)]]:n.side!=h.BOTTOM&&n.side!=h.TOP||o.side!=h.LEFT&&o.side!=h.RIGHT?n.side==h.TOP&&o.side==h.TOP?l=[[n.x+c*g,o.y-m*g]]:n.side!=h.LEFT&&n.side!=h.RIGHT||o.side!=h.TOP&&o.side!=h.BOTTOM?console.error("    ERROR: Unsupported edge connection:",n.side,o.side):l=[[o.x-c*g,n.y+m*g]]:l=[[n.x+c*g,o.y-m*g]],[d(n),...l,d(o)]}(this),e=this.lineGenerator();this.element.select(".path").attr("d",e(t))}}ghostlineGenerator(t){return d3.line()}lineGenerator(t){return this.settings.curved?d3.line().curve(d3.curveBasis):d3.line()}handleClicked(t,e=this){this.selected=!this.selected,this.onClick?this.onClick(e):console.warn(`No onClicked handler, node ${e.id} clicked!`)}handleDblClicked(t,e=this){this.onDblClick?this.onDblClick(e):console.warn(`No onDblClick handler, node ${e.id} clicked!`)}}function _(t,e,i,a){if(!e||!i)return void console.error("createInternalEdge: Source or Target node is missing",{edgeData:t,source:e,target:i});if(e===i)return void console.error("createInternalEdge - Source and Target are the same node",e);const s=function(t,e){const i=[t,...t.getParents()],a=[e,...e.getParents()];let s=null;const n=new Set(a);for(let t=0;t<i.length;t++)if(n.has(i[t])){s=i[t];break}return{source:i.slice(0,i.indexOf(s)),target:a.slice(0,a.indexOf(s)),container:s}}(e,i),n=s.container;if(!n)return void console.error("createInternalEdge: No common parent container found for edge",{source:e.data.label,target:i.data.label,sourceParents:s.source?.map((t=>t.data?.label||t.id))||[],targetParents:s.target?.map((t=>t.data?.label||t.id))||[]});if(!n.childEdges)return void console.error("createInternalEdge: Parent container does not have childEdges array",{parent:n,parentType:n.constructor?.name,parentId:n.id});if(e.edges.outgoing.find((t=>t.target===i)))return;const o=new R(t,s,a);e.edges.outgoing.push(o),i.edges.incoming.push(o),n.childEdges.push(o)}const I=Object.freeze({FULL:"full",ROLE:"role"}),L=Object.freeze({MANUAL:"manual",FULL:"full",ARCHIVE_ONLY:"archive-only",STAGING_ARCHIVE:"staging-archive",STAGING_TRANSFORM:"staging-transform"});class A extends T{static getRequiredChildrenForMode(t){switch(t){case L.FULL:return["staging","archive","transform"];case L.STAGING_ARCHIVE:return["staging","archive"];case L.STAGING_TRANSFORM:return["staging","transform"];case L.ARCHIVE_ONLY:return["archive"];default:return["staging","archive","transform"]}}constructor(t,e,i,a,s=null){try{super(t=A.initializeNodeDataStatic(t),e,i,a,s),this.stagingNode=null,this.transformNode=null,this.archiveNode=null,this.nodeSpacing={horizontal:this.settings?.nodeSpacing?.horizontal??20,vertical:this.settings?.nodeSpacing?.vertical??10}}catch(t){throw console.error("AdapterNode constructor failed:",t),t}}static initializeNodeDataStatic(t){t.width||(t.width=334),t.height||(t.height=74),t.layout||(t.layout={}),t.layout.displayMode||(t.layout.displayMode=I.FULL),t.layout.displayMode===I.ROLE&&(t.width=176),t.layout.mode||(t.layout.mode=L.FULL),t.layout.mode!==L.STAGING_ARCHIVE&&t.layout.mode!==L.STAGING_TRANSFORM||(t.layout.arrangement=4,t.height=44),t.layout.mode===L.ARCHIVE_ONLY&&(t.layout.arrangement=5,t.height=44,t.layout.displayMode===I.ROLE?t.width=96:t.width=166);const e=[1,2,3,4,5];if(void 0===t.layout.arrangement||null===t.layout.arrangement)t.layout.arrangement=1;else{const i=t.layout.arrangement;"number"==typeof i&&Number.isInteger(i)&&e.includes(i)||(console.error(`AdapterNode: invalid layout.arrangement value: "${i}". Expected number in [1..5]. Defaulting to 1.`),t.layout.arrangement=1)}if(t.children||(t.children=[]),t.children.length>0){const e=["staging","archive","transform"];t.children.forEach((i=>{let a=(i.role||"").toLowerCase();if(!a){const t=(i.label||"").toLowerCase(),s=(i.category||"").toLowerCase();e.includes(s)?a=s:t.includes("staging")||t.includes("stg")?a="staging":t.includes("archive")||t.includes("arc")?a="archive":(t.includes("transform")||t.includes("trf")||t.includes("trn")||t.includes("tfm"))&&(a="transform")}a&&e.includes(a)?(i.role=a,i.category=a,t.layout.displayMode===I.ROLE&&(i.label=a,i.width=80,i.height||(i.height=44))):console.error("AdapterNode child missing or invalid role",{parentId:t.id,parentLabel:t.label,childId:i.id,childLabel:i.label,role:i.role})}))}const i=A.getRequiredChildrenForMode(t.layout.mode),a=t.layout.displayMode===I.ROLE;return t.children.length>0&&i.forEach((e=>{if(!t.children.some((t=>(t.role||"").toLowerCase()===e||(t.category||"").toLowerCase()===e))){const i={id:`${e}_${t.id}`,label:a?e:`${e.charAt(0).toUpperCase()+e.slice(1)} ${t.label}`,role:e,category:e,type:"Node",width:a?80:150,height:44};t.children.push(i)}})),0===t.children.length&&A.getRequiredChildrenForMode(t.layout.mode).forEach((e=>{const i={id:`${e}_${t.id}`,label:a?e:`${e.charAt(0).toUpperCase()+e.slice(1)} ${t.label}`,role:e,category:e,type:"Node",width:a?80:150,height:44};t.children.push(i)})),t}initializeNodeData(t){return A.initializeNodeDataStatic(t)}get nestedCorrection_y(){return super.nestedCorrection_y}initChildren(){this.suspenseDisplayChange=!0,this.data.children&&0!==this.data.children.length||(this.data.children=[]),super.initChildren(),this.archiveNode=this.childNodes.find((t=>"archive"===t.data.role)),this.stagingNode=this.childNodes.find((t=>"staging"===t.data.role)),this.transformNode=this.childNodes.find((t=>"transform"===t.data.role)),this.standardizeChildDimensions(),this.createInternalEdges(),this.initEdges(),this.data.layout.displayMode===I.ROLE&&[this.stagingNode,this.archiveNode,this.transformNode].forEach((t=>{if(!t)return;t.data.width=80;const e=t.data.role||t.data.category||t.data.label;"function"==typeof t.redrawText?t.redrawText(e,t.data.width):t.data.label=e})),this.collapsed||(this.zoneManager?.innerContainerZone?this.zoneManager.innerContainerZone.forceUpdateChildPositions():console.warn("AdapterNode - zone system not available for positioning"),this.updateChildren(),this.resize(this.data.expandedSize,!0),this.update()),this.suspenseDisplayChange=!1,this.handleDisplayChange()}standardizeChildDimensions(){const t=this.data.layout.displayMode===I.ROLE?80:150;[this.stagingNode,this.archiveNode,this.transformNode].forEach((e=>{e&&(e.data.width,e.data.height,e.data.width=t,e.data.height=44,"function"==typeof e.resize&&e.resize({width:t,height:44}))}))}createInternalEdges(){this.data.layout.mode!==L.STAGING_TRANSFORM&&this.data.layout.mode!==L.FULL||_({source:this.stagingNode,target:this.transformNode,isActive:!0,type:"SSIS",state:"Ready"},this.stagingNode,this.transformNode,this.settings),this.data.layout.mode!==L.STAGING_ARCHIVE&&this.data.layout.mode!==L.FULL||_({source:this.stagingNode,target:this.archiveNode,isActive:!0,type:"SSIS",state:"Ready"},this.stagingNode,this.archiveNode,this.settings)}initializeChildNode(t,e){let i=this.childNodes.find((e=>null!=e.data.category&&e.data.category.toLowerCase()===t.toLowerCase()));if(i||(i=this.childNodes.find((i=>i.data.role===t||e.some((t=>i.data.label&&i.data.label.toLowerCase().includes(t)))))),i)this.data.layout.displayMode===I.ROLE&&(i.data.role=t,i.data.width=80,i.redrawText&&i.redrawText(i.data.role,i.data.width));else{let e=this.data.children.find((e=>e.category===t||e.role===t));!e&&this.shouldCreateChildNode(t)&&(e={id:`${t}_${this.data.id}`,label:`${t.charAt(0).toUpperCase()+t.slice(1)} ${this.data.label}`,role:t,category:t,type:"Node",width:this.data.layout.displayMode===I.ROLE?80:150,height:44},this.data.children.push(e)),e&&(i=this.initChildNode(e,null))}return i}shouldCreateChildNode(t){const e=this.data.layout.mode;return"archive"===t&&(e===L.ARCHIVE_ONLY||e===L.STAGING_ARCHIVE||e===L.FULL)||"staging"===t&&(e===L.STAGING_ARCHIVE||e===L.STAGING_TRANSFORM||e===L.FULL)||"transform"===t&&(e===L.STAGING_TRANSFORM||e===L.FULL)}initChildNode(t,e){if(t){const i=this.zoneManager?.innerContainerZone?.getChildContainer();if(!i)return console.error("Zone system not available for adapter node:",this.id),null;if(null==e){const a=JSON.parse(JSON.stringify(t));this.data.layout.displayMode===I.ROLE&&(a.label=a.role,a.width=80),e=new E(a,i,this.settings,this),this.childNodes.push(e),this.zoneManager.innerContainerZone.addChild(e),e.init(i)}else e.init(i)}return e}updateChildren(){if(this.collapsed){const t=this.zoneManager?.headerZone,e=t?t.getHeaderHeight():10,i=t&&"function"==typeof t.getMinimumWidthThrottled?t.getMinimumWidthThrottled():t&&"function"==typeof t.getMinimumWidth?t.getMinimumWidth():t?t.getSize?.().width||0:this.data.width,a=Math.max(this.minimumSize.width,i),s=Math.max(this.minimumSize.height,e);if(this.resize({width:a,height:s}),this.zoneManager)try{this.zoneManager.resize(a,s)}catch{}return}if(this.zoneManager?.innerContainerZone||this.zoneManager&&"function"==typeof this.zoneManager.ensureInnerContainerZone&&this.zoneManager.ensureInnerContainerZone(),!this.zoneManager?.innerContainerZone)return;const t=this.zoneManager.innerContainerZone;switch(this.data.layout.arrangement){case 1:t.setLayoutAlgorithm(((t,e)=>{this.layoutAlgorithm1_full_archive(t,e)}));break;case 2:t.setLayoutAlgorithm(((t,e)=>{this.layoutAlgorithm2_full_transform(t,e)}));break;case 3:t.setLayoutAlgorithm(((t,e)=>{this.layoutAlgorithm3_full_staging(t,e)}));break;case 4:t.setLayoutAlgorithm(((t,e)=>{this.layoutAlgorithm4_line(t,e)}));break;case 5:t.setLayoutAlgorithm(((t,e)=>{this.layoutAlgorithm5(t,e)}))}t.updateChildPositions()}layoutAlgorithm1_full_archive(t,e){const i=t.find((t=>"staging"===t.data.role)),a=t.find((t=>"archive"===t.data.role)),s=t.find((t=>"transform"===t.data.role));if(i&&a&&s){const t=44,e=this.data.layout.displayMode===I.ROLE?80:150;i.resize({width:e,height:t}),s.resize({width:e,height:t});const n=this.nodeSpacing.horizontal,o=s.data.width+n+1/3*i.data.width;a.resize({width:o,height:t});const h=this.nodeSpacing.vertical,r=i.data.height+h+a.data.height,d=Math.max(i.data.width,a.data.width,i.data.width+n+s.data.width),l=0,c=-r/2+a.data.height/2,m=r/2-i.data.height/2,g=m,p=l-d/2+i.data.width/2,u=p-i.data.width/2+2/3*i.data.width+a.data.width/2,f=p+i.data.width/2+n+s.data.width/2,y=p+i.data.width/2,w=u+a.data.width/2;Math.abs(w-y),i.move(p,m),a.move(u,c),s.move(f,g),this.resizeArrangementContainer(i,a,s)}}resizeArrangementContainer(t,e,i){if(!this.zoneManager||this._isResizing)return;const a=this.zoneManager.marginZone,s=this.zoneManager.headerZone,n=s?s.getHeaderHeight():10,o=s&&"function"==typeof s.getMinimumWidthThrottled?s.getMinimumWidthThrottled():s&&"function"==typeof s.getMinimumWidth?s.getMinimumWidth():s&&s.getSize?.().width||0;if(a){const s=a.getMargins();let h=1/0,r=1/0,d=-1/0,l=-1/0;[t,e,i].forEach((t=>{const e=t.x-t.data.width/2,i=t.x+t.data.width/2,a=t.y-t.data.height/2,s=t.y+t.data.height/2;h=Math.min(h,e),r=Math.min(r,a),d=Math.max(d,i),l=Math.max(l,s)}));const c=d-h,m=l-r,g=Math.max(s.bottom,8),p={...s,bottom:g},u={width:Math.max(this.minimumSize.width,o,c+p.left+p.right),height:n+p.top+m+p.bottom};this._isResizing=!0,this.resize(u),this._isResizing=!1;const f=this.zoneManager.innerContainerZone;if(f){let a=1/0,s=1/0,n=-1/0,o=-1/0;[t,e,i].forEach((t=>{const e=t.x-t.data.width/2,i=t.x+t.data.width/2,h=t.y-t.data.height/2,r=t.y+t.data.height/2;a=Math.min(a,e),s=Math.min(s,h),n=Math.max(n,i),o=Math.max(o,r)}));const h=10,r={width:n-a+2*h,height:o-s+2*h};f.resize(r.width,r.height),f.updateCoordinateSystem()}}}layoutAlgorithm2_full_transform(t,e){const i=t.find((t=>"staging"===t.data.role)),a=t.find((t=>"archive"===t.data.role)),s=t.find((t=>"transform"===t.data.role));if(i&&s&&a){const t=this.nodeSpacing.horizontal,e=this.nodeSpacing.vertical,n=-(i.data.width+t+s.data.width)/2+i.data.width/2,o=n+i.data.width/2+t+s.data.width/2,h=n,r=a.data.height+e+i.data.height,d=-r/2+a.data.height/2,l=r/2-i.data.height/2,c=l;a.move(h,d),i.move(n,l),s.move(o,c),this.resizeArrangementContainer(i,a,s)}}layoutAlgorithm3_full_staging(t,e){const i=t.find((t=>"staging"===t.data.role)),a=t.find((t=>"archive"===t.data.role)),s=t.find((t=>"transform"===t.data.role));if(i&&s&&a){a.resize({width:150,height:44}),s.resize({width:150,height:44});const t=this.nodeSpacing.vertical,e=this.nodeSpacing.horizontal,n=a.data.height+t+s.data.height;i.resize({width:i.data.width,height:n});const o=Math.max(a.data.width,s.data.width),h=-(i.data.width+e+o)/2+i.data.width/2,r=h+i.data.width/2+e+o/2,d=0,l=-n/2+a.data.height/2,c=n/2-s.data.height/2;i.move(h,d),a.move(r,l),s.move(r,c),this.resizeArrangementContainer(i,a,s)}}layoutAlgorithm4_line(t,e){const i=t.find((t=>"staging"===t.data.role)),a=t.find((t=>"archive"===t.data.role)),s=t.find((t=>"transform"===t.data.role));let n=a;if(this.data.layout.mode===L.STAGING_TRANSFORM&&(n=s),i&&n){const t=0,e=-(i.data.width+this.nodeSpacing.horizontal+n.data.width)/2+i.data.width/2,a=e+i.data.width/2+this.nodeSpacing.horizontal+n.data.width/2;i.move(e,t),n.move(a,t),this.resizeTwoNodeContainer(i,n)}}layoutAlgorithm5(t,e){const i=t.find((t=>"archive"===t.data.role));if(i){const t=0,e=0;i.move(t,e),this.resizeArchiveOnlyContainer(i)}}resizeTwoNodeContainer(t,e){if(!this.zoneManager||this._isResizing)return;const i=this.zoneManager.marginZone,a=this.zoneManager.headerZone,s=a?a.getHeaderHeight():10,n=a&&"function"==typeof a.getMinimumWidthThrottled?a.getMinimumWidthThrottled():a&&"function"==typeof a.getMinimumWidth?a.getMinimumWidth():a&&a.getSize?.().width||0;if(i){const a=i.getMargins(),o=t.data.width+this.nodeSpacing.horizontal+e.data.width,h=Math.max(t.data.height,e.data.height),r={width:Math.max(this.minimumSize.width,n,o+a.left+a.right),height:s+a.top+h+a.bottom};if(r.width!==this.data.width||r.height!==this.data.height){this._isResizing=!0;try{this.resize(r),this.zoneManager&&this.zoneManager.zones.forEach((t=>{t.updateCoordinateSystem&&t.updateCoordinateSystem()})),this.handleDisplayChange()}finally{this._isResizing=!1}}}}resizeArchiveOnlyContainer(t){if(!this.zoneManager||this._isResizing)return;const e=this.zoneManager.marginZone,i=this.zoneManager.headerZone,a=i?i.getHeaderHeight():10,s=i&&"function"==typeof i.getMinimumWidthThrottled?i.getMinimumWidthThrottled():i&&"function"==typeof i.getMinimumWidth?i.getMinimumWidth():i&&i.getSize?.().width||0;if(e){const i=e.getMargins(),n=t.data.width,o=t.data.height,h={width:Math.max(this.minimumSize.width,s,n+i.left+i.right),height:a+i.top+o+i.bottom};if(h.width!==this.data.width||h.height!==this.data.height){this._isResizing=!0;try{this.resize(h),this.zoneManager&&this.zoneManager.zones.forEach((t=>{t.updateCoordinateSystem&&t.updateCoordinateSystem()})),this.handleDisplayChange()}finally{this._isResizing=!1}}}}calculateAndResizeForArrangement3(t,e,i){if(!this._isResizing){let a=1/0,s=1/0,n=-1/0,o=-1/0;[t,e,i].forEach((t=>{const e=t.data.width/2,i=t.data.height/2;a=Math.min(a,t.x-e),s=Math.min(s,t.y-i),n=Math.max(n,t.x+e),o=Math.max(o,t.y+i)})),this.containerMargin.top;const h=n-a,r=o-s,d=this.zoneManager?.headerZone,l=d?d.getHeaderHeight():20,c=d&&"function"==typeof d.getMinimumWidthThrottled?d.getMinimumWidthThrottled():d&&"function"==typeof d.getMinimumWidth?d.getMinimumWidth():d&&d.getSize?.().width||0,m=this.zoneManager?.marginZone,g=m?m.getMargins():{top:8,bottom:8,left:8,right:8},p={width:Math.max(this.data.width,this.minimumSize.width,c,h+g.left+g.right),height:Math.max(this.data.height,l+g.top+r+g.bottom)};if(p.width!==this.data.width||p.height!==this.data.height){this._isResizing=!0;try{this.resize(p),this.zoneManager&&this.zoneManager.zones.forEach((t=>{t.updateCoordinateSystem&&t.updateCoordinateSystem()}))}finally{this._isResizing=!1}}}}resizeToFitChildren(){if(!this.zoneManager?.innerContainerZone)return;const t=this.zoneManager.innerContainerZone.getChildren();if(0===t.length)return;let e=1/0,i=1/0,a=-1/0,s=-1/0;t.forEach((t=>{const n=t.data.width/2,o=t.data.height/2;e=Math.min(e,t.x-n),i=Math.min(i,t.y-o),a=Math.max(a,t.x+n),s=Math.max(s,t.y+o)}));const n=this.containerMargin.top;e-=n,i-=n,a+=n,s+=n;const o=a-e,h=s-i,r=this.zoneManager?.headerZone,d=r?r.getHeaderHeight():20,l=r&&"function"==typeof r.getMinimumWidthThrottled?r.getMinimumWidthThrottled():r&&"function"==typeof r.getMinimumWidth?r.getMinimumWidth():r&&r.getSize?.().width||0,c=this.zoneManager?.marginZone,m=c?c.getMargins():{top:8,bottom:8,left:8,right:8},g={width:Math.max(this.data.width,this.minimumSize.width,l,o+m.left+m.right),height:Math.max(this.data.height,d+m.top+h+m.bottom)};if(g.width!==this.data.width||g.height!==this.data.height){this._isResizing=!0;try{this.resize(g),this.zoneManager&&this.zoneManager.resize(g.width,g.height)}finally{this._isResizing=!1}}}}class D{constructor(t){this.containerNode=t,this.simulation=null,this.tickCounter=0,this.resizeFrequency=10,this.links=[]}init(){return new Promise((t=>{this.tickCounter=0,this.containerNode.childNodes.forEach((t=>{t.x=t.x,t.y=t.data.y,t.width=t.data.width,t.height=t.data.height})),this.simulation=d3.forceSimulation(this.containerNode.childNodes).force("center",d3.forceCenter(0,0)).force("link",d3.forceLink(this.links).id((t=>t.id)).distance((t=>100))).force("collision",function(){let t;function e(){const e=t.length,i=d3.quadtree().x((t=>t.x)).y((t=>t.y)).addAll(t);for(let a=0;a<e;++a){const e=t[a],s=e.x-e.width/2,n=e.x+e.width/2,o=e.y-e.height/2,h=e.y+e.height/2;i.visit((function(t,i,r,d,l){if(!t.data||t.data.index<=a)return!1;const c=t.data;let m=e.x-c.x||Math.random()-.5,g=e.y-c.y||Math.random()-.5;const p=(e.width+c.width)/2+4,u=(e.height+c.height)/2+14,f=Math.abs(m),y=Math.abs(g);if(f<p&&y<u){const t=p-f,i=u-y;if(t<i){m=m||Math.random()-.5;const i=t/f*.5;e.x+=m*i,c.x-=m*i}else{g=g||Math.random()-.5;const t=i/y*.5;e.y+=g*t,c.y-=g*t}}return i>n||d<s||r>h||l<o}))}}return e.initialize=function(e){t=e;for(let e=0;e<t.length;++e)t[e].index=e},e}()),this.resizeBoundingContainer(),this.simulation.on("tick",(()=>this.tick(t))).on("end",(()=>this.end(t)))}))}tick(t){this.containerNode.childNodes.forEach((t=>{t.element.attr("transform",`translate(${t.x}, ${t.y})`)})),this.tickCounter++,this.resizeBoundingContainer()}resizeBoundingContainer(){if(this.containerNode.container){const t=v(this.containerNode.container);this.containerNode.resizeContainer(t),this.containerNode.positionContainer()}}end(t){t(),this.resizeBoundingContainer()}stop(t){this.simulation&&(this.simulation.stop(),this.resizeBoundingContainer(),t())}}const B=80,Z=Object.freeze({FULL:"full",ROLE:"role"}),W=Object.freeze({HORIZONTAL:"horizontal",HORIZONTAL_LINE:"horizontal_line",VERTICAL:"vertical",ROTATE_90:"rotate90",ROTATE_270:"rotate270"}),O=Object.freeze({MANUAL:"manual",AUTO:"auto"});class H extends T{static initializeNodeDataStatic(t){t.width||(t.width=334),t.height||(t.height=44),t.layout&&"object"==typeof t.layout||(t.layout={});const e=[Z.FULL,Z.ROLE],i=[W.HORIZONTAL,W.HORIZONTAL_LINE,W.VERTICAL,W.ROTATE_90,W.ROTATE_270],a=[O.MANUAL,O.AUTO];let s=t.layout.displayMode??Z.ROLE;s="string"==typeof s?s.toLowerCase():Z.ROLE,e.includes(s)||(s=Z.ROLE),t.layout.displayMode=s;let n=t.layout.orientation??W.HORIZONTAL;n="string"==typeof n?n.toLowerCase():W.HORIZONTAL,i.includes(n)||(n=W.HORIZONTAL),t.layout.orientation=n;let o=t.layout.mode??O.AUTO;if(o="string"==typeof o?o.toLowerCase():O.AUTO,a.includes(o)||(o=O.AUTO),t.layout.mode=o,t.layout.displayMode===Z.ROLE&&(t.width=196,t.height=44),t.children||(t.children=[]),t.children.length>0){const e=["raw","base"];t.children.forEach((i=>{let a=(i.role||"").toLowerCase();if(!a){const t=(i.category||"").toLowerCase();e.includes(t)?a=t:(i.label||"").toLowerCase().includes("raw")?a="raw":(i.label||"").toLowerCase().includes("base")&&(a="base")}a&&e.includes(a)?(i.role=a,i.category=a,t.layout.displayMode===Z.ROLE&&(i.label=a,i.width=B,i.height||(i.height=20))):console.error("FoundationNode child missing or invalid role",{parentId:t.id,parentLabel:t.label,childId:i.id,childLabel:i.label,role:i.role})}))}const h=t.layout.mode===O.AUTO,r=e=>{let i=t.children.find((t=>t.role===e||t.category===e));if(!i&&h){const a=t.layout.displayMode===Z.ROLE;i={id:`${e}_${t.id}`,label:a?e:`${e.charAt(0).toUpperCase()+e.slice(1)} ${t.label}`,role:e,category:e,type:"node",width:a?B:150,height:20},t.children.push(i)}};return r("raw"),r("base"),t}constructor(t,e,i,a,s=null){super(t=H.initializeNodeDataStatic(t),e,i,a,s),this.rawNode=null,this.baseNode=null,this.nodeSpacing={horizontal:this.settings?.nodeSpacing?.horizontal??20,vertical:this.settings?.nodeSpacing?.vertical??10},this._cachedHeaderMinWidth=void 0}get nestedCorrection_y(){return this.y}initChildren(){this.suspenseDisplayChange=!0,super.initChildren(),this.data.children&&0!==this.data.children.length||(this.data.children=[]),this.rawNode=this.initializeChildNode("raw",["raw"]),this.baseNode=this.initializeChildNode("base",["base"]),this.standardizeChildDimensions(),_({source:this.rawNode.data.id,target:this.baseNode.data.id,isActive:!0,type:"SSIS",state:"Ready"},this.rawNode,this.baseNode,this.settings),this.initEdges();const t=this.zoneManager?.headerZone,e=t&&"function"==typeof t.getMinimumWidthThrottled?t.getMinimumWidthThrottled():t&&"function"==typeof t.getMinimumWidth?t.getMinimumWidth():t&&t.getSize?.().width||0;this.data.expandedSize={width:Math.max(e+2,this.rawNode.data.width+this.nodeSpacing.horizontal+this.baseNode.data.width+this.containerMargin.left+this.containerMargin.right),height:this.containerMargin.top+this.containerMargin.bottom+18},this.resize(this.data.expandedSize,!0),this.update(),this.cascadeUpdate(),this.suspenseDisplayChange=!1,this.handleDisplayChange()}standardizeChildDimensions(){const t=this.data.layout.displayMode===Z.ROLE,e=t?B:150;[this.rawNode,this.baseNode].forEach((i=>{if(i&&(i.data.width=e,i.data.height=20,"function"==typeof i.resize&&i.resize({width:e,height:20}),t&&"function"==typeof i.redrawText)){const t=i.data.role||i.data.label;i.redrawText(t,e)}}))}initializeChildNode(t,e){let i=this.childNodes.find((e=>null!=e.data.category&&e.data.category.toLowerCase()===t.toLowerCase()));if(i||(i=this.childNodes.find((t=>e.some((e=>t.data.label.toLowerCase().includes(e.toLowerCase()+".")))))),i||(i=this.childNodes.find((t=>e.some((e=>t.data.label.toLowerCase().includes(e.toLowerCase())))))),i)this.data.layout.displayMode==Z.ROLE&&(i.data.role=t,i.data.width=B,i.redrawText(i.data.role,i.data.width));else{let e=this.data.children.find((e=>e.category===t));!e&&this.shouldCreateChildNode(t)&&(e={id:`${t}_${this.data.id}`,label:`${t.charAt(0).toUpperCase()+t.slice(1)} ${this.data.label}`,role:t,type:"Node"},this.data.children.push(e)),i=this.initChildNode(e,i)}return i}shouldCreateChildNode(t){return this.data.layout.mode===O.AUTO}initChildNode(t,e){if(!t)return null;let i=this.zoneManager?.innerContainerZone?.getChildContainer();if(!i&&this.zoneManager?.ensureInnerContainerZone&&(i=this.zoneManager.ensureInnerContainerZone()?.getChildContainer()),i=i||this.element,null==e){const a=JSON.parse(JSON.stringify(t));this.data.layout.displayMode===Z.ROLE&&(a.label=a.role,a.width=B),e=new E(a,i,this.settings,this),this.childNodes.push(e),this.zoneManager?.innerContainerZone&&this.zoneManager.innerContainerZone.addChild(e),e.init(i)}else e.init(i);return e}updateChildren(){if(this.collapsed){const t=this.zoneManager?.headerZone,e=t?t.getHeaderHeight():10;let i;void 0!==this._cachedHeaderMinWidth?i=this._cachedHeaderMinWidth:t&&"function"==typeof t.getMinimumWidthThrottled?(i=t.getMinimumWidthThrottled(),this._cachedHeaderMinWidth=i):t&&"function"==typeof t.getMinimumWidth?(i=t.getMinimumWidth(),this._cachedHeaderMinWidth=i):i=t?t.getSize().width:this.data.width;const a=Math.max(this.minimumSize.width,i),s=Math.max(this.minimumSize.height,e);this.resize({width:a,height:s})}else if(!this.zoneManager?.innerContainerZone&&this.zoneManager?.ensureInnerContainerZone&&this.zoneManager.ensureInnerContainerZone(),this.zoneManager?.innerContainerZone)switch(this.data.layout.displayMode){case Z.FULL:this.updateFullZone();break;case Z.ROLE:this.updateRoleZone();break;default:console.warn(`Unknown displayMode "${this.data.layout.displayMode}" using ${Z.FULL}`),this.updateFullZone()}}updateFull(){const t=this.containerMargin.left-this.containerMargin.right,e=this.containerMargin.top-this.containerMargin.bottom;if(this.rawNode){const i=-this.data.width/2+this.rawNode.data.width/2+this.containerMargin.left-t,a=-this.data.height/2+this.rawNode.data.height/2+this.containerMargin.top-e;this.rawNode.move(i,a)}if(this.baseNode){const i=-this.data.width/2+this.baseNode.data.width/2+this.containerMargin.left+this.rawNode.data.width+this.nodeSpacing.horizontal-t,a=-this.data.height/2+this.baseNode.data.height/2+this.containerMargin.top-e;this.baseNode.move(i,a)}}updateRole(){const t=this.containerMargin.left-this.containerMargin.right,e=this.containerMargin.top-this.containerMargin.bottom;if(this.rawNode){const i=-this.data.width/2+this.rawNode.data.width/2+this.containerMargin.left-t,a=-this.data.height/2+this.rawNode.data.height/2+this.containerMargin.top-e;this.rawNode.move(i,a)}if(this.baseNode){const i=-this.data.width/2+this.baseNode.data.width/2+this.containerMargin.left+this.rawNode.data.width+this.nodeSpacing.horizontal-t,a=-this.data.height/2+this.baseNode.data.height/2+this.containerMargin.top-e;this.baseNode.move(i,a)}}updateFullZone(){const t=this.zoneManager.innerContainerZone;t.setLayoutAlgorithm(((t,e)=>{const i=t.find((t=>"raw"===t.data.role)),a=t.find((t=>"base"===t.data.role));if(i&&a)switch((this.data.layout?.orientation||"horizontal").toLowerCase()){case"vertical":case"rotate90":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+i.data.height/2,s=t/2-a.data.height/2;i.move(0,e),a.move(0,s),this.resizeTwoNodeContainer(i,a,"vertical");break}case"rotate270":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+a.data.height/2,s=t/2-i.data.height/2;i.move(0,s),a.move(0,e),this.resizeTwoNodeContainer(i,a,"vertical");break}default:{const t=i.data.width+this.nodeSpacing.horizontal+a.data.width,e=-t/2+i.data.width/2,s=t/2-a.data.width/2;i.move(e,0),a.move(s,0),this.resizeTwoNodeContainer(i,a,"horizontal");break}}})),t.updateChildPositions()}updateRoleZone(){const t=this.zoneManager.innerContainerZone;t.setLayoutAlgorithm(((t,e)=>{const i=t.find((t=>"raw"===t.data.role)),a=t.find((t=>"base"===t.data.role));if(i&&a){const t=(this.data.layout?.orientation||"horizontal").toLowerCase();if(i.data.width=B,a.data.width=B,i.data){const t=i.data.role||i.data.label;i.data.label=t,"function"==typeof i.redrawText&&i.redrawText(t,i.data.width)}if(a.data){const t=a.data.role||a.data.label;a.data.label=t,"function"==typeof a.redrawText&&a.redrawText(t,a.data.width)}switch(t){case"vertical":case"rotate90":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+i.data.height/2,s=t/2-a.data.height/2;i.move(0,e),a.move(0,s),this.resizeTwoNodeContainer(i,a,"vertical");break}case"rotate270":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+a.data.height/2,s=t/2-i.data.height/2;i.move(0,s),a.move(0,e),this.resizeTwoNodeContainer(i,a,"vertical");break}default:{const t=i.data.width+this.nodeSpacing.horizontal+a.data.width,e=-t/2+i.data.width/2,s=t/2-a.data.width/2;i.move(e,0),a.move(s,0),this.resizeTwoNodeContainer(i,a,"horizontal");break}}}})),t.updateChildPositions()}clearHeaderWidthCache(){this._cachedHeaderMinWidth=void 0}resize(t,e=!1){this.clearHeaderWidthCache(),super.resize(t,e)}resizeTwoNodeContainer(t,e,i="horizontal"){if(!this.zoneManager||this._isResizing)return;const a=this.zoneManager.marginZone,s=this.zoneManager.headerZone,n=s?s.getHeaderHeight():10;if(!a)return;const o=a.getMargins();let h,r;"vertical"===i?(h=Math.max(t.data.width,e.data.width),r=t.data.height+this.nodeSpacing.vertical+e.data.height):(h=t.data.width+this.nodeSpacing.horizontal+e.data.width,r=Math.max(t.data.height,e.data.height));let d=h+o.left+o.right;s&&!this._cachedHeaderMinWidth&&(this._cachedHeaderMinWidth=s.getMinimumWidthThrottled?s.getMinimumWidthThrottled():s.getMinimumWidth?s.getMinimumWidth():0),void 0!==this._cachedHeaderMinWidth&&(d=Math.max(d,this._cachedHeaderMinWidth));const l={width:d,height:n+o.top+r+o.bottom};if(l.width!==this.data.width||l.height!==this.data.height){this._isResizing=!0;try{if(this.resize(l),this.zoneManager&&!this.zoneManager._resizing){this.zoneManager._resizing=!0;try{this.zoneManager.resize(l.width,l.height)}finally{this.zoneManager._resizing=!1}}this.handleDisplayChange()}finally{this._isResizing=!1}}}}const P=120,F=Object.freeze({FULL:"full",ROLE:"role"}),$=Object.freeze({HORIZONTAL:"horizontal",HORIZONTAL_LINE:"horizontal_line",VERTICAL:"vertical",ROTATE_90:"rotate90",ROTATE_270:"rotate270"}),U=Object.freeze({MANUAL:"manual",AUTO:"auto"});class G extends T{static initializeNodeDataStatic(t){if(t.width||(t.width=334),t.height||(t.height=44),t.layout||(t.layout={}),t.layout.displayMode||(t.layout.displayMode=F.ROLE),t.layout.orientation||(t.layout.orientation=$.HORIZONTAL),t.layout.mode||(t.layout.mode=U.AUTO),t.layout.displayMode===F.ROLE){const e=20,i=16;t.width=240+e+i,t.height=60}if(t.children||(t.children=[]),t.children.length>0){const e=["load","report"];t.children.forEach((i=>{let a=(i.role||"").toLowerCase();if(!a){const t=(i.category||"").toLowerCase();e.includes(t)?a=t:(i.label||"").toLowerCase().includes("load")?a="load":((i.label||"").toLowerCase().includes("report")||(i.label||"").toLowerCase().includes("rprt"))&&(a="report")}a&&e.includes(a)?(i.role=a,i.category=a,t.layout.displayMode===F.ROLE&&(i.label=a,i.width=P,i.height||(i.height=44))):console.error("MartNode child missing or invalid role",{parentId:t.id,parentLabel:t.label,childId:i.id,childLabel:i.label,role:i.role})}))}const e=t.layout.mode===U.AUTO,i=i=>{let a=t.children.find((t=>t.role===i||t.category===i));if(!a&&e){const e=t.layout.displayMode===F.ROLE;a={id:`${i}_${t.id}`,label:e?i:`${i.charAt(0).toUpperCase()+i.slice(1)} ${t.label}`,role:i,category:i,type:"node",width:e?P:150,height:44},t.children.push(a)}};return i("load"),i("report"),t}constructor(t,e,i,a,s=null){super(t=G.initializeNodeDataStatic(t),e,i,a,s),this.loadNode=null,this.reportNode=null,this.nodeSpacing={horizontal:this.settings?.nodeSpacing?.horizontal??20,vertical:this.settings?.nodeSpacing?.vertical??10}}get nestedCorrection_y(){return this.y}initChildren(){this.suspenseDisplayChange=!0,super.initChildren(),this.data.children&&0!==this.data.children.length||(this.data.children=[]),this.loadNode=this.childNodes.find((t=>"load"===t?.data?.role))||this.initializeChildNode("load",["load"]),this.reportNode=this.childNodes.find((t=>"report"===t?.data?.role))||this.initializeChildNode("report",["report","rprt"]),_({source:this.loadNode.data.id,target:this.reportNode.data.id,isActive:!0,type:"SSIS",state:"Ready"},this.loadNode,this.reportNode,this.settings),this.initEdges(),this.data.expandedSize={width:this.loadNode.data.width+this.nodeSpacing.horizontal+this.reportNode.data.width+this.containerMargin.left+this.containerMargin.right,height:Math.max(this.loadNode.data.height,this.reportNode.data.height)+this.containerMargin.top+this.containerMargin.bottom},this.resize(this.data.expandedSize,!0),this.update(),this.cascadeUpdate(),this.suspenseDisplayChange=!1,this.handleDisplayChange()}initializeChildNode(t,e){let i=this.childNodes.find((e=>null!=e.data.category&&e.data.category.toLowerCase()===t.toLowerCase()));if(i||(i=this.childNodes.find((t=>e.some((e=>t.data.label.toLowerCase().includes(e.toLowerCase()+".")))))),i||(i=this.childNodes.find((t=>e.some((e=>t.data.label.toLowerCase().includes(e.toLowerCase())))))),i)this.data.layout.displayMode==F.ROLE&&(i.data.role=t,i.data.width=P,i.redrawText(i.data.role,i.data.width));else{let e=this.data.children.find((e=>e.category===t));!e&&this.shouldCreateChildNode(t)&&(e={id:`${t}_${this.data.id}`,label:`${t.charAt(0).toUpperCase()+t.slice(1)} ${this.data.label}`,role:t,type:"Node"},this.data.children.push(e)),i=this.initChildNode(e,i)}return i}shouldCreateChildNode(t){return this.data.layout.mode===U.AUTO}initChildNode(t,e){if(!t)return null;let i=this.zoneManager?.innerContainerZone?.getChildContainer();if(!i&&this.zoneManager?.ensureInnerContainerZone&&(i=this.zoneManager.ensureInnerContainerZone()?.getChildContainer()),i=i||this.element,null==e){const a=JSON.parse(JSON.stringify(t));this.data.layout.displayMode===F.ROLE&&(a.label=a.role,a.width=P),e=new E(a,i,this.settings,this),this.childNodes.push(e),this.zoneManager?.innerContainerZone&&this.zoneManager.innerContainerZone.addChild(e),e.init(i)}else this.data.layout.displayMode===F.ROLE&&(e.data.label=e.data.role||e.data.label,e.data.width=P,e.redrawText&&e.redrawText(e.data.label,e.data.width)),e.init(i);return e}updateChildren(){if(this.collapsed){const t=this.zoneManager?.headerZone,e=t?t.getHeaderHeight():10,i=t&&"function"==typeof t.getMinimumWidthThrottled?t.getMinimumWidthThrottled():t&&"function"==typeof t.getMinimumWidth?t.getMinimumWidth():t?t.getSize?.().width||0:this.data.width,a=Math.max(this.minimumSize.width,i),s=Math.max(this.minimumSize.height,e);return void this.resize({width:a,height:s})}let t=this.zoneManager?.innerContainerZone;if(!t&&this.zoneManager?.ensureInnerContainerZone&&(t=this.zoneManager.ensureInnerContainerZone()),t)switch(this.data.layout.displayMode){case F.FULL:this.updateFullZone();break;case F.ROLE:this.updateRoleZone();break;default:console.warn(`Unknown displayMode "${this.data.layout.displayMode}" using ${F.FULL}`),this.updateFullZone()}}updateFull(){const t=this.containerMargin.left-this.containerMargin.right,e=this.containerMargin.top-this.containerMargin.bottom;if(this.loadNode){const i=-this.data.width/2+this.loadNode.data.width/2+this.containerMargin.left-t,a=-this.data.height/2+this.loadNode.data.height/2+this.containerMargin.top-e;this.loadNode.move(i,a)}if(this.reportNode){const i=-this.data.width/2+this.reportNode.data.width/2+this.containerMargin.left+this.loadNode.data.width+this.nodeSpacing.horizontal-t,a=-this.data.height/2+this.reportNode.data.height/2+this.containerMargin.top-e;this.reportNode.move(i,a)}}updateRole(){const t=this.containerMargin.left-this.containerMargin.right,e=this.containerMargin.top-this.containerMargin.bottom;if(this.loadNode){const i=-this.data.width/2+this.loadNode.data.width/2+this.containerMargin.left-t,a=-this.data.height/2+this.loadNode.data.height/2+this.containerMargin.top-e;this.loadNode.move(i,a)}if(this.reportNode){const i=-this.data.width/2+this.reportNode.data.width/2+this.containerMargin.left+this.loadNode.data.width+this.nodeSpacing.horizontal-t,a=-this.data.height/2+this.reportNode.data.height/2+this.containerMargin.top-e;this.reportNode.move(i,a)}}updateFullZone(){const t=this.zoneManager.innerContainerZone;t.setLayoutAlgorithm(((t,e)=>{const i=t.find((t=>"load"===t.data.role)),a=t.find((t=>"report"===t.data.role));if(i&&a)switch((this.data.layout?.orientation||"horizontal").toLowerCase()){case"vertical":case"rotate90":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+i.data.height/2,s=t/2-a.data.height/2;i.move(0,e),a.move(0,s),this.resizeTwoNodeContainer(i,a,"vertical");break}case"rotate270":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+a.data.height/2,s=t/2-i.data.height/2;i.move(0,s),a.move(0,e),this.resizeTwoNodeContainer(i,a,"vertical");break}default:{const t=i.data.width+this.nodeSpacing.horizontal+a.data.width,e=-t/2+i.data.width/2,s=t/2-a.data.width/2;i.move(e,0),a.move(s,0),this.resizeTwoNodeContainer(i,a,"horizontal");break}}})),t.updateChildPositions()}updateRoleZone(){const t=this.zoneManager.innerContainerZone;t.setLayoutAlgorithm(((t,e)=>{const i=t.find((t=>"load"===t.data.role)),a=t.find((t=>"report"===t.data.role));if(i&&a){const t=(this.data.layout?.orientation||"horizontal").toLowerCase();switch(i.data.width=P,i.data.label=i.data.role||"load",i.redrawText&&i.redrawText(i.data.label,i.data.width),a.data.width=P,a.data.label=a.data.role||"report",a.redrawText&&a.redrawText(a.data.label,a.data.width),t){case"vertical":case"rotate90":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+i.data.height/2,s=t/2-a.data.height/2;i.move(0,e),a.move(0,s),this.resizeTwoNodeContainer(i,a,"vertical");break}case"rotate270":{const t=i.data.height+this.nodeSpacing.vertical+a.data.height,e=-t/2+a.data.height/2,s=t/2-i.data.height/2;i.move(0,s),a.move(0,e),this.resizeTwoNodeContainer(i,a,"vertical");break}default:{const t=i.data.width+this.nodeSpacing.horizontal+a.data.width,e=-t/2+i.data.width/2,s=t/2-a.data.width/2;i.move(e,0),a.move(s,0),this.resizeTwoNodeContainer(i,a,"horizontal");break}}}})),t.updateChildPositions()}resizeTwoNodeContainer(t,e,i="horizontal"){if(!this.zoneManager||this._isResizing)return;const a=this.zoneManager.marginZone,s=this.zoneManager.headerZone,n=s?s.getHeaderHeight():10;if(!a)return;const o=a.getMargins();let h,r;"vertical"===i?(h=Math.max(t.data.width,e.data.width),r=t.data.height+this.nodeSpacing.vertical+e.data.height):(h=t.data.width+this.nodeSpacing.horizontal+e.data.width,r=Math.max(t.data.height,e.data.height));const d={width:h+o.left+o.right,height:n+o.top+r+o.bottom};if(d.width!==this.data.width||d.height!==this.data.height){this._isResizing=!0;try{this.resize(d),this.zoneManager&&this.zoneManager.resize(d.width,d.height),this.handleDisplayChange()}finally{this._isResizing=!1}}}}const V=Object.freeze({GRID:"grid",HSHIFTED:"h-shifted",VSHIFTED:"v-shifted",VSHIFTED2:"v-shifted2",STAIR_UP:"stair-up",STAIR_DOWN:"stair-down"});function j(t,e,i,a=null){return o(t,e,i,a)}function K(t){return d3.json(`data/${t}`)}function Y(t){const e=document.querySelector("#graph-container");if(e)return e;try{const e=t&&t.node?t.node():null;if(e&&e.parentElement)return e.parentElement}catch{}return document.body}n("group",class extends T{constructor(t,e,i,a,s=null){super(t,e,i,a,s)}updateChildren(){super.updateChildren(),this.layoutGroup()}updateChildrenWithZoneSystem(){this.layoutGroup()}layoutGroup(){if(0===this.childNodes.length)return;const t=this.zoneManager?.innerContainerZone,e=this.zoneManager?.marginZone,i=this.zoneManager?.headerZone,a=this.childNodes.filter((t=>t.visible));if(0===a.length)return;let s=1/0,n=1/0,o=-1/0,h=-1/0;a.forEach((t=>{const e=t.getEffectiveWidth?t.getEffectiveWidth():t.data.width,i=t.getEffectiveHeight?t.getEffectiveHeight():t.data.height;s=Math.min(s,t.x-e/2),n=Math.min(n,t.y-i/2),o=Math.max(o,t.x+e/2),h=Math.max(h,t.y+i/2)}));const r=o-s,d=h-n,l=s+r/2,c=n+d/2;if(a.forEach((t=>{const e=t.x-l,i=t.y-c;t.move(e,i)})),t&&e&&i){const a=e.getMargins(),s=i.getHeaderHeight(),n={width:Math.max(this.minimumSize.width,r+a.left+a.right),height:Math.max(this.minimumSize.height,s+a.top+d+a.bottom)};this.resize(n),this.handleDisplayChange();const o=10;t.resize(r+2*o,d+2*o),t.updateCoordinateSystem()}else{const t={width:Math.max(this.minimumSize.width,r+this.containerMargin.left+this.containerMargin.right),height:Math.max(this.minimumSize.height,d+this.containerMargin.top+this.containerMargin.bottom)};this.resize(t),this.handleDisplayChange()}}runSimulation(){this.zoneManager?.innerContainerZone||(this.simulation=new D(this),this.simulation.init())}arrange(){this.updateChildren()}}),n("lane",class extends T{constructor(t,e,i,a,s=null){super(t,e,i,a,s),this._isResizing=!1}get nestedCorrection_y(){return super.nestedCorrection_y}get nestedCorrection_x(){return super.nestedCorrection_x}updateChildren(){this.layoutLane()}updateChildrenWithZoneSystem(){this.layoutLane()}layoutLane(){if(this.collapsed){const t=this.zoneManager?.headerZone,e=t?t.getHeaderHeight():20,i=t&&"function"==typeof t.getMinimumWidthThrottled?t.getMinimumWidthThrottled():t&&"function"==typeof t.getMinimumWidth?t.getMinimumWidth():50;if(!this._isResizing){const t={width:Math.max(this.minimumSize.width,i),height:Math.max(this.minimumSize.height,e)};this._isResizing=!0;try{this.resize(t),this.handleDisplayChange()}finally{this._isResizing=!1}}return}let t=this.zoneManager?.innerContainerZone;if(!t&&this.zoneManager?.ensureInnerContainerZone&&(t=this.zoneManager.ensureInnerContainerZone()),!t)return;t.setLayoutAlgorithm(((t,e)=>{if(0===t.length)return;const i=this.nodeSpacing?.vertical||10,a=t.filter((t=>t.visible));if(0===a.length)return;let s=-(a.reduce(((t,e)=>t+e.data.height),0)+i*(a.length-1))/2;a.forEach((t=>{const e=s+t.data.height/2;t.move(0,e),s+=t.data.height+i}))}));const e=this.childNodes.filter((t=>t.visible)),i=e.reduce(((t,e)=>t+(e.getEffectiveHeight?e.getEffectiveHeight():e.data.height)),0),a=e.length>1?(e.length-1)*this.nodeSpacing.vertical:0,s=e.length>0?Math.max(...e.map((t=>t.getEffectiveWidth?t.getEffectiveWidth():t.data.width))):0,n=this.zoneManager?.marginZone,o=this.zoneManager?.headerZone,h=o?o.getHeaderHeight():20,r=o&&"function"==typeof o.getMinimumWidthThrottled?o.getMinimumWidthThrottled():o&&"function"==typeof o.getMinimumWidth?o.getMinimumWidth():o&&o.getSize?.().width||0;if(n&&!this._isResizing){let t;if(this.collapsed)t={width:Math.max(this.minimumSize.width,r),height:Math.max(this.minimumSize.height,h)};else{const e=n.getMargins(),o=s,d=i+a;t={width:Math.max(this.minimumSize.width,r,o+e.left+e.right),height:h+e.top+d+e.bottom}}this._isResizing=!0;try{this.resize(t),this.handleDisplayChange()}finally{this._isResizing=!1}}t.updateChildPositions()}arrange(){this.updateChildren()}}),n("columns",class extends T{constructor(t,e,i,a,s=null){t.layout??={},t.layout.minimumColumnWidth??=0,t.layout.minimumSize??={height:10,useRootRatio:!1},super(t,e,i,a,s),this._isResizing=!1}get nestedCorrection_y(){return super.nestedCorrection_y}get nestedCorrection_x(){return super.nestedCorrection_x}updateChildren(){this.layoutColumns()}updateChildrenWithZoneSystem(){this.layoutColumns()}layoutColumns(){if(this.collapsed){const t=this.zoneManager?.headerZone,e=t?t.getHeaderHeight():20,i=t&&"function"==typeof t.getMinimumWidthThrottled?t.getMinimumWidthThrottled():t&&"function"==typeof t.getMinimumWidth?t.getMinimumWidth():t&&t.getSize?.().width||0;if(!this._isResizing){const t={width:Math.max(this.minimumSize.width,i),height:Math.max(this.minimumSize.height,e)};this._isResizing=!0;try{this.resize(t),this.handleDisplayChange()}finally{this._isResizing=!1}}return}let t=this.zoneManager?.innerContainerZone;if(!t&&this.zoneManager?.ensureInnerContainerZone&&(t=this.zoneManager.ensureInnerContainerZone()),!t)return;t.setLayoutAlgorithm(((t,e)=>{if(0===t.length)return;const i=this.nodeSpacing?.horizontal||20;let a=-e.size.width/2+0;t.filter((t=>t.visible)).forEach((t=>{const e=a+t.data.width/2;t.move(e,0),a+=t.data.width+i}))}));const e=this.childNodes.filter((t=>t.visible)),i=e.reduce(((t,e)=>t+(e.getEffectiveWidth?e.getEffectiveWidth():e.data.width)),0),a=e.length>1?(e.length-1)*this.nodeSpacing.horizontal:0,s=e.length>0?Math.max(...e.map((t=>t.getEffectiveHeight?t.getEffectiveHeight():t.data.height))):0,n=this.zoneManager?.marginZone,o=this.zoneManager?.headerZone,h=o?o.getHeaderHeight():20;if(n&&!this._isResizing){let t;if(this.collapsed){const e=o&&"function"==typeof o.getMinimumWidthThrottled?o.getMinimumWidthThrottled():o&&"function"==typeof o.getMinimumWidth?o.getMinimumWidth():o&&o.getSize?.().width||0;t={width:Math.max(this.minimumSize.width,e),height:Math.max(this.minimumSize.height,h)}}else{const e=n.getMargins(),r=i+a,d=Math.max(s,0),l=o&&"function"==typeof o.getMinimumWidthThrottled?o.getMinimumWidthThrottled():o&&"function"==typeof o.getMinimumWidth?o.getMinimumWidth():o&&o.getSize?.().width||0;t={width:Math.max(this.minimumSize.width,l,r+e.left+e.right),height:h+e.top+Math.max(d,0)+e.bottom}}this._isResizing=!0;try{this.resize(t),this.handleDisplayChange()}finally{this._isResizing=!1}}t.updateChildPositions()}arrange(){this.updateChildren()}}),n("adapter",A),n("foundation",H),n("mart",G),n("node",E),n("circle",class extends C{constructor(t,e,i,a=null){super(t,e,i,a),this.data.radius||(this.data.radius=Math.max(this.data.width,this.data.height)/2),this.resize({width:this.data.width,height:this.data.height})}init(t=null){t&&(this.parentElement=t),super.init(t),this.element.append("circle").attr("class",`${this.data.type} shape`).attr("r",this.data.radius).attr("status",this.status),this.element.append("text").attr("class",`${this.data.type} label`).attr("x",0).attr("y",0).text(this.data.label),this.collapsed?this.element.classed("collapsed",!0):this.element.classed("expanded",!0)}}),n("rect",E),n("edge-demo",class extends T{constructor(t,e,i,a,s=null){t.width||(t.width=334),t.height||(t.height=74),super(t,e,i,a,s),"string"==typeof this.data.layout&&(this.data.layout={type:this.data.layout}),this.layout=this.data.layout?.type||V.GRID,this.shiftRatio=this.data.shiftRatio||.6,this.shift2Ratio=this.data.shift2Ratio||.8,this.nodeSpacing=t.nodeSpacing||{horizontal:30,vertical:20}}init(t=null){this.ensureDemoChildren(),super.init(t);const e=this.getChildNode("center");e&&(this.data.children.map((t=>t.id)).filter((t=>"center"!==t)).forEach((t=>{const i=this.getChildNode(t);i&&_({source:e.data,target:i.data,isActive:!0,type:"SSIS",state:"Ready"},e,i,this.settings)})),this.initEdges())}ensureDemoChildren(){const t=["top","top-right","right","bottom-right","bottom","bottom-left","left","top-left"];let e=[];switch(this.layout){case V.HSHIFTED:e=["top-right","bottom-right","top-left","bottom-left"];break;case V.VSHIFTED:case V.VSHIFTED2:e=["top-left","top-right","bottom-left","bottom-right"];break;case V.STAIR_UP:e=["bottom-left","top-right"];break;case V.STAIR_DOWN:e=["top-left","bottom-right"];break;case V.GRID:default:e=t.slice()}const i=[{id:"center",label:"center",type:"rect"}];e.forEach((t=>i.push({id:t,label:t,type:"rect"}))),this.data.children=i}getChildNode(t){return this.childNodes&&this.childNodes.find((e=>e.id===t||e.data?.id===t))||null}moveChild(t,e,i){const a=this.getChildNode(t);a&&a.move(e,i)}updateChildren(){const t=this.zoneManager?.innerContainerZone;if(!t)return;const e=this;t.setLayoutAlgorithm(((t,i)=>{const a=new Map(t.map((t=>[t.id,t]))),s=a.get("center");if(!s)return;const n=s.data.width,o=s.data.height,h=e.nodeSpacing.horizontal,r=e.nodeSpacing.vertical,d=e.shiftRatio,l=e.shift2Ratio,c=(t,e,i)=>{const s=a.get(t);s&&s.move(e,i)};switch(c("center",0,0),e.layout){case V.HSHIFTED:c("top-right",n+h,-o*d),c("bottom-right",n+h,o*d),c("top-left",-n-h,-o*d),c("bottom-left",-n-h,o*d);break;case V.VSHIFTED:c("top-left",-n*d,-o-r),c("top-right",n*d,-o-r),c("bottom-left",-n*d,o+r),c("bottom-right",n*d,o+r);break;case V.VSHIFTED2:c("top-left",-n*l,-o-r),c("top-right",n*l,-o-r),c("bottom-left",-n*l,o+r),c("bottom-right",n*l,o+r);break;case V.STAIR_UP:c("bottom-left",-n*(1-d),o+r),c("top-right",n*(1-d),-o-r);break;case V.STAIR_DOWN:c("top-left",-n*(1-d),-o-r),c("bottom-right",n*(1-d),o+r);break;case V.GRID:default:c("top",0,-o-r),c("top-right",n+h,-o-r),c("right",n+h,0),c("bottom-right",n+h,o+r),c("bottom",0,o+r),c("bottom-left",-n-h,o+r),c("left",-n-h,0),c("top-left",-n-h,-o-r)}})),t.updateChildPositions()}gridLayout(){const t=this.getChildNode("center");if(!t)return;const e=t.data.width,i=t.data.height,a=this.nodeSpacing.horizontal,s=this.nodeSpacing.vertical;this.moveChild("center",0,0),this.moveChild("top",0,-i-s),this.moveChild("top-right",e+a,-i-s),this.moveChild("right",e+a,0),this.moveChild("bottom-right",e+a,i+s),this.moveChild("bottom",0,i+s),this.moveChild("bottom-left",-e-a,i+s),this.moveChild("left",-e-a,0),this.moveChild("top-left",-e-a,-i-s)}hshiftedLayout(){const t=this.getChildNode("center");if(!t)return;const e=t.data.width,i=t.data.height,a=this.nodeSpacing.horizontal,s=this.shiftRatio;this.moveChild("center",0,0),this.moveChild("top-right",e+a,-i*s),this.moveChild("bottom-right",e+a,i*s),this.moveChild("top-left",-e-a,-i*s),this.moveChild("bottom-left",-e-a,i*s)}vshiftedLayout(){const t=this.getChildNode("center");if(!t)return;const e=t.data.width,i=t.data.height,a=(this.nodeSpacing.horizontal,this.nodeSpacing.vertical),s=this.shiftRatio;this.moveChild("center",0,0),this.moveChild("top-left",-e*s,-i-a),this.moveChild("top-right",e*s,-i-a),this.moveChild("bottom-left",-e*s,i+a),this.moveChild("bottom-right",e*s,i+a)}vshifted2Layout(){const t=this.getChildNode("center");if(!t)return;const e=t.data.width,i=t.data.height,a=this.nodeSpacing.vertical,s=this.shift2Ratio;this.moveChild("center",0,0),this.moveChild("top-left",-e*s,-i-a),this.moveChild("top-right",e*s,-i-a),this.moveChild("bottom-left",-e*s,i+a),this.moveChild("bottom-right",e*s,i+a)}stairUpLayout(){const t=this.getChildNode("center");if(!t)return;const e=t.data.width,i=t.data.height,a=this.nodeSpacing.vertical,s=1-this.shiftRatio;this.moveChild("center",0,0),this.moveChild("bottom-left",-e*s,i+a),this.moveChild("top-right",e*s,-i-a)}stairDownLayout(){const t=this.getChildNode("center");if(!t)return;const e=t.data.width,i=t.data.height,a=this.nodeSpacing.vertical,s=1-this.shiftRatio;this.moveChild("center",0,0),this.moveChild("top-left",-e*s,-i-a),this.moveChild("bottom-right",e*s,i+a)}resizeToFitChildren(){const t=v(this.container);t.width+=this.containerMargin.left+this.containerMargin.right,t.height+=this.containerMargin.top+this.containerMargin.bottom,this.resize(t)}createChild(t,e,i,a){let s={id:`child_${e}`,label:`${e}`,category:"child",type:"rect"};this.data.children.push(s);let n=new E(s,this.container,this.settings,this);return n.render(),n.move(i+(this.containerMargin.left-this.containerMargin.right)/2,a+(this.containerMargin.top-this.containerMargin.bottom)/2),t&&_({source:t.data,target:s,isActive:!0,type:"SSIS",state:"Ready"},t,n,this.settings),n}layoutChildren(){}});const q={el:null,dotsEl:null,textEl:null,timer:null,baseText:"initializing",shownAt:0,MIN_VISIBLE_MS:350,ensure(t){const e=t||Y();if(!e)return null;try{const t="undefined"!=typeof window&&window.getComputedStyle?window.getComputedStyle(e):null;t&&"static"===t.position&&(e.style.position="relative")}catch{}let i=e.querySelector(".zoom-overlay-host")||e;if(this.el=i.querySelector("#flowdash-loading")||document.getElementById("flowdash-loading"),this.el){this.dotsEl=this.el.querySelector(".flowdash-loading__dots"),this.textEl=this.el.querySelector(".flowdash-loading__text");try{i&&this.el.parentElement!==i&&i.appendChild(this.el)}catch{}try{const t=this.el.style;if(t.inset="",t.top="",t.left="",t.right="",t.bottom="",t.transform="",t.background="",t.zIndex="",t.pointerEvents="none",!this.dotsEl){const t=document.createElement("span");t.className="flowdash-loading__dots",this.el.appendChild(t),this.dotsEl=t}if(!this.textEl){const t=document.createElement("span");t.className="flowdash-loading__text",t.textContent="initializing",this.el.insertBefore(t,this.el.firstChild),this.textEl=t}const e=this.dotsEl.style;e.position="",e.inset="",e.display="",e.placeItems="",e.zIndex="";const i=this.textEl.style;i.position="",i.zIndex="",i.fontSize="",i.color=""}catch{}}else{const t=document.createElement("div");t.id="flowdash-loading",t.className="flowdash-loading",t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.style.pointerEvents="none";const e=document.createElement("span");e.className="flowdash-loading__text",e.textContent="initializing";const a=document.createElement("span");a.className="flowdash-loading__dots",t.appendChild(e),t.appendChild(a),i.appendChild(t),this.el=t,this.dotsEl=a,this.textEl=e}return this.el},startDots(){this.stopDots();let t=0;this.timer=setInterval((()=>{this.dotsEl&&(t=(t+1)%4,this.dotsEl.textContent=0===t?"":Array.from({length:t}).map((()=>".")).join(" "))}),450)},stopDots(){this.timer&&(clearInterval(this.timer),this.timer=null),this.dotsEl&&(this.dotsEl.textContent="")},show(t){const e=this.ensure(t);e&&(this.shownAt=Date.now(),e.style.display="grid",this.baseText="initializing",this.textEl&&(this.textEl.textContent=this.baseText),this.startDots())},hide(){if(!this.el)return;const t=Date.now()-this.shownAt,e=Math.max(0,this.MIN_VISIBLE_MS-t);setTimeout((()=>{this.el&&(this.el.style.display="none",this.stopDots())}),e)}};function X(t=null){try{const e="string"==typeof t?document.querySelector(t):t;q.show(e||Y())}catch{}}function J(){try{q.hide()}catch{}}try{"undefined"!=typeof window&&(window.showLoading=function(t){try{X(t)}catch{}},window.hideLoading=function(){try{J()}catch{}})}catch{}class Q{constructor(t){this.dashboard=t,this.active=!1,this.svg=null,this.width=0,this.height=0,this.container=null,this.eye={x:0,y:0,width:0,height:0},this.scale=1,this.targetWidthPx=240,this.targetHeightPx=160,this.cockpit=null,this.overlay=null,this.chromeSvg=null,this.content=null,this.collapsedIcon=null,this.header=null,this.headerHeight=20,this.collapseButton=null,this.pinButton=null,this.pinBase=null,this.pinSlash=null,this.sizeButton=null,this.sizeLabel=null,this.footer=null,this.footerHeight=20,this.scaleText=null,this.controls=null,this.btnZoomIn=null,this.btnZoomOut=null,this.btnReset=null,this.headerHitRect=null,this.footerHitRect=null,this.drag=null,this.zoom=null,this.useDesaturateLayering=!1,this.grayGroup=null,this.colorGroup=null,this.state={showTimer:null,hideTimer:null,interacting:!1,wheelTimer:null}}getActiveThemeName(){try{const t="undefined"!=typeof document?document.documentElement:null,e="undefined"!=typeof document?document.body:null,i=t&&t.getAttribute("data-theme")||e&&e.getAttribute("data-theme")||"";return String(i||"").toLowerCase()}catch{return""}}getTargetWidth(t){if("object"==typeof t&&t&&"number"==typeof t.width)return t.width;switch(t){case"s":return 180;case"l":return 400;default:return 240}}resize(){if(!this.svg)return;const t=this.dashboard.data.settings.minimap;if(!t)return;const e=this.getTargetWidth(t.size),i=this.dashboard.main.aspectRatio||this.dashboard.main.divRatio||this.dashboard.main.width/this.dashboard.main.height||16/9,a=Math.max(60,Math.round(e/i));this.targetWidthPx=e,this.targetHeightPx=a;const s=this.dashboard.main.svg.node().getBoundingClientRect(),n=s.width&&this.dashboard.main.width?s.width/this.dashboard.main.width:1,o=e/n,h=a/n;this.width=o,this.height=h,this.svg.attr("width",o).attr("height",h);const r=this.dashboard.getContentBBox();this.width&&this.height||(this.width=this.width||this.targetWidthPx||240,this.height=this.height||this.targetHeightPx||160),this.scale=Math.min(this.width/r.width,this.height/r.height),this.updateViewboxAndMasks(r),this.update();const d=d3.zoomIdentity.translate(this.dashboard.main.transform.x,this.dashboard.main.transform.y).scale(this.dashboard.main.transform.k);this.updateViewport(d)}initializeEmbedded(){const t=this.dashboard.data.settings.minimap;if(!t||!1===t.enabled)return void(this.active=!1);const e="undefined"!=typeof window&&(window.innerWidth||0)<600;let i=this.dashboard.data.settings.minimap.mode||(e?"disabled":"hover");if("hidden"===i&&(i="disabled"),this.dashboard.data.settings.minimap.mode=i,"disabled"===i)return void(this.dashboard.data.settings.minimap.enabled=!1);if(t.persistence&&t.persistence.persistCollapsedState&&"undefined"!=typeof window)try{const e=window.localStorage.getItem(t.persistence.storageKey);null!==e&&(this.dashboard.data.settings.minimap.collapsed="true"===e)}catch{}"always"===i&&(this.dashboard.data.settings.minimap.enabled=!0,this.dashboard.data.settings.minimap.collapsed=!1,this.dashboard.data.settings.minimap.pinned=!0),"hover"===i&&void 0===this.dashboard.data.settings.minimap.collapsed&&(this.dashboard.data.settings.minimap.collapsed=!0);const a=this.dashboard.main.svg.node().parentElement;try{a.style.position="relative",a.style.overflow="hidden"}catch{}let s=d3.select(a).select(".zoom-overlay-host");s.empty()&&(s=d3.select(a).append("div").attr("class","zoom-overlay-host"));try{const t="undefined"!=typeof window&&window.getComputedStyle?window.getComputedStyle(a):null,e=t?parseFloat(t.paddingTop||"0"):0,i=t?parseFloat(t.paddingRight||"0"):0,n=t?parseFloat(t.paddingBottom||"0"):0,o=t?parseFloat(t.paddingLeft||"0"):0;s.style("position","absolute").style("top",`${e}px`).style("right",`${i}px`).style("bottom",`${n}px`).style("left",`${o}px`).style("pointer-events","none")}catch{}this.overlayHost=s;const n=s.append("div").attr("class","zoom-cockpit");this.cockpit=n,this.overlay=n;const o=n.append("svg").attr("class","minimap-chrome").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("height","100%").style("pointer-events","all");this.chromeSvg=o,this.content=o.append("g").attr("class","minimap-content"),this.active=!0,this.state={showTimer:null,hideTimer:null,interacting:!1,wheelTimer:null},this.collapsedIcon=this.content.append("g").attr("class","minimap-collapsed-icon").style("cursor","pointer").style("pointer-events","all"),this.collapsedIcon.append("rect").attr("class","collapsed-icon-bg").attr("width",20).attr("height",14).attr("rx",2).attr("ry",2),this.collapsedIcon.append("rect").attr("class","collapsed-icon-mini").attr("x",4).attr("y",3).attr("width",12).attr("height",8),this.collapsedIcon.on("click",(()=>{this.setCollapsed(!1,!0)})),this.header=this.content.append("g").attr("class","minimap-header"),this.headerHeight=20,this.collapseButton=this.header.append("g").attr("class","minimap-collapse-button").style("cursor","pointer"),this.collapseButton.append("rect").attr("class","collapse-btn-bg").attr("width",16).attr("height",16).attr("rx",3).attr("ry",3),this.collapseButton.append("path").attr("class","collapse-btn-icon").attr("d","M2,6 L14,6 L8,12 Z"),this.collapseButton.on("click",(()=>{this.setCollapsed(!0,!0)})),this.pinButton=this.header.append("g").attr("class","minimap-pin-button").style("cursor","pointer").attr("role","button").attr("aria-label","Pin").attr("aria-pressed",String(!!t.pinned)),this.sizeButton=this.header.append("g").attr("class","minimap-size-button").style("cursor","pointer"),this.sizeButton.append("rect").attr("class","btn-bg").attr("width",20).attr("height",16).attr("rx",3).attr("ry",3),this.sizeLabel=this.sizeButton.append("text").attr("class","btn-label").attr("x",10).attr("y",10).attr("text-anchor","middle").style("dominant-baseline","middle").style("font-size","10px");const h=()=>{const t=this.dashboard.data.settings.minimap.size,e="object"==typeof t?t.label||"M":String(t||"m").toUpperCase();this.sizeLabel.text(e)};h(),this.sizeButton.on("click",(()=>{const t=this.dashboard.data.settings.minimap.sizeSwitcher&&this.dashboard.data.settings.minimap.sizeSwitcher.order||["s","m","l"],e=this.dashboard.data.settings.minimap.size,i=t.indexOf("object"==typeof e?e.token:e)>=0?t.indexOf("object"==typeof e?e.token:e):t.indexOf("m"),a=t[(i+1)%t.length];if(this.dashboard.data.settings.minimap.size=a,this.resize(),this.position(),h(),"function"==typeof this.dashboard.data.settings.minimap.onSizeChange)try{this.dashboard.data.settings.minimap.onSizeChange({size:a,width:this.targetWidthPx,height:this.targetHeightPx})}catch{}})),this.pinButton.selectAll("*").remove();const r=this.pinButton.append("g").attr("class","pin-icon");this.pinBase=r.append("path").attr("class","pin-base").attr("d","M8 2 C9.2 2 10 2.8 10 4 L10 6 L12.5 8 L9 8 L9 12 L7 12 L7 8 L3.5 8 L6 6 L6 4 C6 2.8 6.8 2 8 2 Z").attr("fill","var(--fd-border, rgba(0,0,0,0.85))"),this.pinSlash=r.append("path").attr("class","pin-slash").attr("d","M3 13 L13 3").attr("stroke","var(--fd-border, rgba(0,0,0,0.85))").attr("stroke-width",2).attr("stroke-linecap","round").style("display",t.pinned?"none":"block"),r.attr("transform",t.pinned?"rotate(0,8,8)":"rotate(-20,8,8)"),this.pinButton.append("title").text("Pin (toggle pinned / hover)"),this.pinButton.on("click",(()=>{t.pinned=!t.pinned,this.dashboard.data.settings.minimap.mode=t.pinned?"always":"hover",this.state.showTimer&&(clearTimeout(this.state.showTimer),this.state.showTimer=null),this.state.hideTimer&&(clearTimeout(this.state.hideTimer),this.state.hideTimer=null),this.state.interacting=!1,this.updatePinVisualState(),this.updateHoverBindings()})),this.svg=this.content.append("svg").attr("class","minimap-svg"),this.container=this.svg.append("g").attr("class","minimap"),this.resize(),this.initialize(),this.footer=this.content.append("g").attr("class","minimap-footer"),this.footerHeight=20,!1!==t.scaleIndicator?.visible&&(this.scaleText=this.footer.append("text").attr("class","minimap-scale").attr("text-anchor","end"));const d=(t,e,i)=>{const a=t.append("g").attr("class",`minimap-btn ${e}`).style("cursor","pointer");return a.append("rect").attr("class","btn-bg").attr("width",16).attr("height",16).attr("rx",3).attr("ry",3),a.on("click",(t=>{t.stopPropagation(),i()})),a};this.controls=this.footer.append("g").attr("class","minimap-controls"),this.btnZoomIn=d(this.controls,"zoom-in",(()=>this.dashboard.zoomIn())),this.btnZoomIn.append("rect").attr("class","icon plus-h").attr("x",3).attr("y",7).attr("width",10).attr("height",2),this.btnZoomIn.append("rect").attr("class","icon plus-v").attr("x",7).attr("y",3).attr("width",2).attr("height",10),this.btnZoomOut=d(this.controls,"zoom-out",(()=>this.dashboard.zoomOut())),this.btnZoomOut.append("rect").attr("class","icon minus").attr("x",3).attr("y",7).attr("width",10).attr("height",2),this.btnReset=d(this.controls,"reset",(()=>this.dashboard.zoomReset())),this.btnReset.append("circle").attr("class","icon target-outer").attr("cx",8).attr("cy",8).attr("r",5),this.btnReset.append("circle").attr("class","icon target-inner").attr("cx",8).attr("cy",8).attr("r",1.5),this.headerHitRect=this.header.append("rect").attr("class","minimap-header-hit").attr("fill","transparent"),this.footerHitRect=this.footer.append("rect").attr("class","minimap-footer-hit").attr("fill","transparent"),this.headerHitRect&&this.headerHitRect.lower(),this.footerHitRect&&this.footerHitRect.lower(),this.header&&this.header.raise(),this.footer&&this.footer.raise(),this.position(),this.updateHoverBindings(),this.setCollapsed(!0===t.collapsed),this.updateVisibilityByZoom(),this.updatePinVisualState()}setCollapsed(t,e=!1){const i=this.dashboard.data.settings.minimap;if(i.collapsed=!!t,this.svg&&this.svg.style("display",t?"none":"block"),this.scaleText&&this.scaleText.style("display",t?"none":"block"),this.footer&&this.footer.style("display",t?"none":"block"),this.collapsedIcon){const e="hidden"===i.mode||"disabled"===i.mode,a=t;this.collapsedIcon.style("display",a&&!e?"block":"none")}if(this.collapseButton){const e="hidden"===i.mode||"disabled"===i.mode;this.collapseButton.style("display",t||e?"none":"block")}if(this.pinButton){const e="hidden"===i.mode||"disabled"===i.mode;this.pinButton.style("display",t||e?"none":"block")}if(this.sizeButton){const e="hidden"===i.mode||"disabled"===i.mode;this.sizeButton.style("display",t||e?"none":"block")}if(this.header){const e="hidden"===i.mode||"disabled"===i.mode;this.header.style("display",t||e?"none":"block")}if(this.position(),this.updateHoverBindings(),e&&i.persistence&&i.persistence.persistCollapsedState&&"undefined"!=typeof window)try{window.localStorage.setItem(i.persistence.storageKey,String(i.collapsed))}catch{}}updatePinVisualState(){const t=this.dashboard.data.settings.minimap;if(this.pinButton&&(this.pinButton.classed("active",!!t.pinned),this.pinButton.attr("aria-pressed",String(!!t.pinned)),this.pinBase&&this.pinSlash)){this.pinSlash.style("display",t.pinned?"none":"block");const e=this.pinButton.select("g.pin-icon");e.empty()||e.attr("transform",t.pinned?"rotate(0,8,8)":"rotate(-20,8,8)")}}position(){if(!this.cockpit)return;const t=this.dashboard.data.settings.minimap,e={width:this.targetWidthPx||240,height:this.targetHeightPx||160},i=this.dashboard.main.svg.node().parentElement,a=(Math.max(0,i.clientWidth||0),Math.max(0,i.clientHeight||0),t.collapsedIcon&&t.collapsedIcon.position||t.position,this.headerHeight||20),s=this.footerHeight||20,n={width:e.width,height:e.height+a+s};try{const t=this.dashboard.main.svg.node().parentElement,e="undefined"!=typeof window&&window.getComputedStyle?window.getComputedStyle(t):null,i=e?parseFloat(e.paddingTop||"0"):0,a=e?parseFloat(e.paddingRight||"0"):0,s=e?parseFloat(e.paddingBottom||"0"):0,n=e?parseFloat(e.paddingLeft||"0"):0;this.overlayHost&&this.overlayHost.style("top",`${i}px`).style("right",`${a}px`).style("bottom",`${s}px`).style("left",`${n}px`)}catch{}const o=this.dashboard.main.svg.classed("flowdash-fullscreen");this.cockpit.style("width",`${n.width}px`).style("height",`${n.height}px`).style("display","block");const h=this.cockpit.node();if(h&&(h.style.setProperty("position",o?"fixed":"absolute","important"),h.style.setProperty("right","12px","important"),h.style.setProperty("bottom","12px","important"),h.style.setProperty("top","auto","important"),h.style.setProperty("left","auto","important"),h.style.setProperty("z-index","10000","important"),h.style.setProperty("pointer-events","none","important")),this.chromeSvg&&this.chromeSvg.attr("width",n.width).attr("height",n.height),this.header){this.header.attr("transform","translate(0,0)");const t=2;let i=e.width-4;this.collapseButton&&(i-=16,this.collapseButton.attr("transform",`translate(${i},${t})`)),this.pinButton&&(i-=20,this.pinButton.attr("transform",`translate(${i},${t})`)),this.sizeButton&&(i-=24,this.sizeButton.attr("transform",`translate(${i},${t})`)),this.headerHitRect&&this.headerHitRect.attr("x",0).attr("y",0).attr("width",e.width).attr("height",a)}if(this.svg.attr("x",0).attr("y",a).attr("width",e.width).attr("height",e.height),this.footer){const t=a+e.height;if(this.footer.attr("transform",`translate(0,${t})`),this.footerHitRect&&this.footerHitRect.attr("x",0).attr("y",0).attr("width",e.width).attr("height",s),this.controls){const t=6,i=16,a=6,n=6,o=Math.floor(s/2);this.controls.attr("transform",`translate(${n},${o-i/2})`),this.btnZoomIn.attr("transform","translate(0,0)"),this.btnZoomOut.attr("transform",`translate(${i+t},0)`),this.btnReset.attr("transform",`translate(${2*(i+t)},0)`),this.scaleText&&this.scaleText.attr("x",e.width-a).attr("y",o).style("text-anchor","end").style("dominant-baseline","middle")}}this.collapsedIcon.attr("transform",`translate(${n.width-20-2},${n.height-14-2})`),this.scaleText&&this.footer&&(this.scaleText.style("font-size","12px").style("dominant-baseline","middle").style("fill","var(--minimap-scale-fg, #333)"),this.updateScaleIndicator())}updateScaleIndicator(){const t=this.dashboard.data.settings.minimap;if(!this.scaleText||!this.active||!1===t.scaleIndicator?.visible)return;const e=this.dashboard.main.fitK||1,i=`${Math.round((this.dashboard.main.transform.k||1)/e*100)}%`;this.scaleText.text(i)}updateHoverBindings(){const t=this.dashboard.data.settings.minimap||{};if(this.collapsedIcon&&this.collapsedIcon.on("mouseenter",null).on("mouseleave",null).on("mouseover",null).on("mouseout",null).on("touchstart",null),this.cockpit&&this.cockpit.on("mouseenter",null).on("mouseleave",null).on("mouseover",null).on("mouseout",null).on("mousedown",null).on("mouseup",null).on("wheel",null),t&&("hover"===t.mode||"always"===t.mode&&!t.pinned)){const e=()=>{"hover"!==this.dashboard.data.settings.minimap.mode&&this.dashboard.data.settings.minimap.pinned||(this.state.hideTimer&&(clearTimeout(this.state.hideTimer),this.state.hideTimer=null),this.setCollapsed(!1))},i=()=>{this.dashboard.data.settings.minimap.pinned||"hover"!==this.dashboard.data.settings.minimap.mode||this.setCollapsed(!0)};this.collapsedIcon&&this.collapsedIcon.on("mouseenter",(()=>{this.state.isHover=!0,this.state.hideTimer&&clearTimeout(this.state.hideTimer),this.state.showTimer&&clearTimeout(this.state.showTimer),this.state.showTimer=setTimeout(e,t.hover?.showDelayMs??120)})).on("mouseleave",(()=>{this.state.isHover=!1,this.state.showTimer&&(clearTimeout(this.state.showTimer),this.state.showTimer=null),!0===this.dashboard.data.settings.minimap.collapsed&&(this.dashboard.data.settings.minimap.pinned||(this.state.hideTimer=setTimeout(i,t.hover?.hideDelayMs??300)))})).on("touchstart",(()=>{e(),setTimeout(i,t.touch?.autoHideAfterMs??2500)})),this.cockpit&&!t.collapsed&&this.cockpit.on("mouseenter",(()=>{this.state.isHover=!0,this.state.hideTimer&&clearTimeout(this.state.hideTimer),e()})).on("mouseleave",(e=>{this.state.isHover=!1,this.dashboard.data.settings.minimap.pinned||this.state.interacting||"hover"!==this.dashboard.data.settings.minimap.mode||(this.state.hideTimer=setTimeout(i,t.hover?.hideDelayMs??300))})).on("mousedown",(()=>{this.state.interacting=!0})).on("mouseup",(()=>{this.state.interacting=!1})).on("wheel",(()=>{this.state.interacting=!0,this.state.hideTimer&&clearTimeout(this.state.hideTimer),this.state.wheelTimer&&clearTimeout(this.state.wheelTimer),this.state.wheelTimer=setTimeout((()=>{this.state.interacting=!1,this.dashboard.data.settings.minimap.pinned||"hover"!==this.dashboard.data.settings.minimap.mode||i()}),250)}))}}initialize(){const t=this.dashboard,e=d3.drag().on("drag",(function(e){!function(t,e){const i=e.dx/t.minimap.scale,a=e.dy/t.minimap.scale,s=t.minimap.eye.x+i,n=t.minimap.eye.y+a;t.minimap.updateEye(s,n,t.minimap.eye.width,t.minimap.eye.height),t.main.transform.x=-s*t.main.transform.k-t.main.width/2,t.main.transform.y=-n*t.main.transform.k-t.main.height/2;const o=d3.zoomIdentity.translate(t.main.transform.x,t.main.transform.y).scale(t.main.transform.k);t.main.container.attr("transform",o),t.main.svg.call(t.main.zoom.transform,o)}(t,e)}));this.svg.call(e),this.drag=e;const i=d3.zoom().scaleExtent([.1,40]).on("zoom",(e=>t.zoomMinimap(e)));this.svg.call(i),this.zoom=i;const a=this.dashboard.getContentBBox();this.scale=Math.min(this.width/a.width,this.height/a.height),this.updateViewboxAndMasks(a),this.eye={x:-this.dashboard.main.width/2,y:-this.dashboard.main.height/2,width:this.dashboard.main.width,height:this.dashboard.main.height};const s=this.svg.append("defs"),n=this.getActiveThemeName();this.useDesaturateLayering="cyberpunk"===n,this.useDesaturateLayering&&(s.append("filter").attr("id","mm-desaturate").append("feColorMatrix").attr("type","saturate").attr("values",0),s.append("clipPath").attr("id","pupil-clip").append("rect").attr("id","pupil-clip-rect").attr("x",this.eye.x).attr("y",this.eye.y).attr("width",this.eye.width).attr("height",this.eye.height));const o=s.append("mask").attr("id","fade-mask");return o.append("rect").attr("id","eyeball").attr("x",-this.dashboard.main.width/2).attr("y",-this.dashboard.main.height/2).attr("width",this.dashboard.main.width).attr("height",this.dashboard.main.height).attr("class","minimap-eyeball"),o.append("rect").attr("id","pupil").attr("class","minimap-pupil").attr("x",this.eye.x).attr("y",this.eye.y).attr("width",this.eye.width).attr("height",this.eye.height),this.svg.insert("rect",":first-child").attr("class","background").attr("width",a.width).attr("height",a.height).attr("x",a.x).attr("y",a.y),this.useDesaturateLayering&&(this.grayGroup=this.svg.append("g").attr("class","minimap minimap-gray").attr("filter","url(#mm-desaturate)"),this.colorGroup=this.svg.append("g").attr("class","minimap minimap-color").attr("clip-path","url(#pupil-clip)")),this.svg.append("rect").attr("class","eye").attr("width",a.width).attr("height",a.height).attr("x",a.x).attr("y",a.y).attr("mask","url(#fade-mask)"),this.svg.append("rect").attr("class","iris").attr("x",this.eye.x).attr("y",this.eye.y).attr("width",this.eye.width).attr("height",this.eye.height),i}update(){requestAnimationFrame((()=>{if(this.svg&&"none"!==this.svg.style("display")){const t=this.dashboard.main.root.getAllNodes(!1);t.length>100?this.updateSimplified(t):this.updateFullClone()}}))}updateSimplified(t){const e=this.dashboard.getContentBBox();this.updateViewboxAndMasks(e),this.useDesaturateLayering?(this.grayGroup&&this.grayGroup.selectAll("*").remove(),this.colorGroup&&this.colorGroup.selectAll("*").remove()):d3.select(".minimap").selectAll("*").remove();const i=e=>{t.forEach((t=>{let i=null;try{i=S(t.element,this.dashboard.main.container)}catch{}if(!i||!isFinite(i.width)||!isFinite(i.height)){const e="number"==typeof t.x?t.x:0,a="number"==typeof t.y?t.y:0,s=t.data&&"number"==typeof t.data.width?t.data.width:"number"==typeof t.width?t.width:0,n=t.data&&"number"==typeof t.data.height?t.data.height:"number"==typeof t.height?t.height:0;i={x:e-s/2,y:a-n/2,width:s,height:n}}e.append("rect").attr("x",i.x).attr("y",i.y).attr("width",Math.max(0,i.width)).attr("height",Math.max(0,i.height)).attr("fill",t.isContainer?"#4a90e2":"#7ed321").attr("opacity",.7)}))};this.useDesaturateLayering?(i(this.grayGroup),i(this.colorGroup)):i(d3.select(".minimap"))}updateFullClone(){const t=this.dashboard.main.container.node();if(this.useDesaturateLayering){if(this.grayGroup&&this.grayGroup.selectAll("*").remove(),this.colorGroup&&this.colorGroup.selectAll("*").remove(),t){const e=t.cloneNode(!0),i=t.cloneNode(!0);this.grayGroup.node().appendChild(e),this.colorGroup.node().appendChild(i)}this.container=this.grayGroup}else{const e=t?t.cloneNode(!0):null,i=d3.select(".minimap");i.selectAll("*").remove(),e&&i.node().appendChild(e),this.container=d3.select(e),this.container&&this.container.attr("transform",null)}this.updateViewboxAndMasks(this.dashboard.getContentBBox())}updateEye(t,e,i,a){if(!this.active||!this.svg)return;this.eye.x=t,this.eye.y=e,this.eye.width=i,this.eye.height=a;const s=this.svg,n=s.select("#pupil"),o=s.select(".iris"),h=s.select("#pupil-clip-rect");n.empty()||n.attr("x",t).attr("y",e).attr("width",i).attr("height",a),o.empty()||o.attr("x",t).attr("y",e).attr("width",i).attr("height",a),h.empty()||h.attr("x",t).attr("y",e).attr("width",i).attr("height",a)}updateViewboxAndMasks(t){if(!this.svg)return;this.svg.attr("viewBox",`${t.x} ${t.y} ${t.width} ${t.height}`);const e=this.svg.select("rect.background");e.empty()||e.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height);const i=this.svg.select("rect.eye");i.empty()||i.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height);const a=this.svg.select("#eyeball");a.empty()||a.attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height)}updateVisibilityByZoom(){const t=this.dashboard.data.settings.minimap;if(!t)return;if("hover"!==t.mode&&("always"!==t.mode||t.pinned))return;if(t.pinned)return;const e=t.hover?.zoomFitThreshold??1,i=(this.dashboard.main.transform.k||1)<=e;t.collapsed?this.state?.interacting||this.state?.isHover?this.setCollapsed(!1):this.setCollapsed(!0):this.state?.interacting||this.state?.isHover?this.setCollapsed(!1):this.setCollapsed(i)}scheduleUpdate(t){this._updateTimeout&&clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout((()=>{requestAnimationFrame((()=>{this.updateViewport(t),this.updateScaleIndicator(),this.updateVisibilityByZoom()}))}),16)}updateViewport(t){const e=(t.x+this.dashboard.main.width/2)/-t.k,i=(t.y+this.dashboard.main.height/2)/-t.k,a=this.dashboard.main.width/t.k,s=this.dashboard.main.height/t.k;this.updateEye(e,i,a,s)}destroy(){try{this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),this.state?.showTimer&&(clearTimeout(this.state.showTimer),this.state.showTimer=null),this.state?.hideTimer&&(clearTimeout(this.state.hideTimer),this.state.hideTimer=null),this.state?.wheelTimer&&(clearTimeout(this.state.wheelTimer),this.state.wheelTimer=null)}catch{}try{this.svg&&(this.svg=null),this.cockpit&&this.cockpit.remove()}catch{}this.cockpit=null,this.overlay=null,this.chromeSvg=null,this.content=null,this.collapsedIcon=null,this.header=null,this.collapseButton=null,this.pinButton=null,this.pinBase=null,this.pinSlash=null,this.sizeButton=null,this.sizeLabel=null,this.footer=null,this.scaleText=null,this.controls=null,this.btnZoomIn=null,this.btnZoomOut=null,this.btnReset=null,this.headerHitRect=null,this.footerHitRect=null,this.container=null,this.drag=null,this.zoom=null,this.active=!1}}class tt{constructor(t){this._isInitialized=!1,this._data=null,Object.defineProperty(this,"data",{get:()=>this._data,set:t=>{this._isInitialized?this.setData(t):this._data=t||{}},configurable:!0}),this.data=t,this.data.settings=p.mergeWithDefaults(this.data.settings),this.main={svg:null,width:0,height:0,divRatio:0,aspectRatio:0,container:null,root:null,scale:1,zoomSpeed:.2,transform:{k:1,x:0,y:0},pixelToSvgRatio:1,fitK:1,fitTransform:null},this.minimap=new Q(this),this.selection={nodes:[],edges:[],boundingBox:{x:0,y:0,width:0,height:0}},this.isMainAndMinimapSyncing=!1,this._displayChangeScheduled=!1,this.hasPerformedInitialZoomToRoot=!1}getContentBBox(){if(!this.main?.root)return{x:-this.main.width/2,y:-this.main.height/2,width:this.main.width,height:this.main.height};const t=this.main.root.getAllNodes(!1);return t&&0!==t.length?it(this,t):{x:-this.main.width/2,y:-this.main.height/2,width:this.main.width,height:this.main.height}}computeFitForBoundingBox(t){const e=this.main.width||1,i=this.main.height||1,a=e/t.width,s=i/t.height,n=Math.min(a,s),o=-t.width*n/2-t.x*n,h=-t.height*n/2-t.y*n;return{k:n,x:o,y:h,transform:d3.zoomIdentity.translate(o,h).scale(n)}}recomputeBaselineFit(){if(!this.main?.root)return;const t=this.main.root.getAllNodes(!1);if(!t||0===t.length)return;const e=it(this,t),i=this.computeFitForBoundingBox(e);this.main.fitK=i.k||1,this.main.fitTransform=i.transform,this.minimap.updateScaleIndicator?.()}setData(t){this._initialLoading=!0;try{this.showLoading()}catch{}const e=t&&t.settings?t.settings:{};this._data=t||{},this._data.settings=p.mergeWithDefaults(e);try{const t=this.main&&this.main.divRatio?this.main.divRatio:16/9;this._data.settings.divRatio&&this._data.settings.divRatio>0||(this._data.settings.divRatio=t)}catch{}if(this.main?.svg&&this.main.svg.selectAll("*").remove(),this.main.container=this.createContainer(this.main,"dashboard"),this.main.root=this.createDashboard(this.data,this.main.container),this.main.root.onClick=t=>this.selectNode(t),this.main.root.onDblClick=t=>this.zoomToNode(t),this.main.root.onDisplayChange=()=>{this.onMainDisplayChange()},this.main.zoom?this.main.svg.call(this.main.zoom):this.main.zoom=this.initializeZoom(),this.minimap)try{this.minimap.destroy()}catch{}this.minimap=new Q(this),this.minimap.initializeEmbedded(),this.hasPerformedInitialZoomToRoot=!1,this.recomputeBaselineFit(),this.data.settings.zoomToRoot&&(this.zoomToRoot(),this.hasPerformedInitialZoomToRoot=!0),this.onMainDisplayChange()}initialize(t,e=null){this.mainDivSelector=t;try{"undefined"!=typeof window&&window.showFlowDashLoading?window.showFlowDashLoading():this.showLoading()}catch{}const i=this.initializeSvg(t);this.main.svg=i.svg,this.main.width=i.width,this.main.height=i.height,this.main.divRatio=this.main.width/this.main.height,this.main.aspectRatio=this.main.divRatio,this.main.pixelToSvgRatio=1,this.data.settings.divRatio??=this.main.divRatio,this.main.onDragUpdate=this.onDragUpdate,this._initialLoading=!0,this.main.container=this.createContainer(this.main,"dashboard"),this.main.root=this.createDashboard(this.data,this.main.container,(()=>{this.onMainDisplayChange()})),this.main.zoom=this.initializeZoom(),this.main.root.onClick=t=>this.selectNode(t),this.main.root.onDblClick=t=>this.zoomToNode(t),this.minimap.initializeEmbedded(),this.data.settings.zoomToRoot&&(this.zoomToRoot(),this.hasPerformedInitialZoomToRoot=!0),this.initializeFullscreenToggle(),"undefined"!=typeof window&&(this._onWindowResize=()=>{this.main.svg.classed("flowdash-fullscreen")||this.applyResizePreserveZoom()},window.addEventListener("resize",this._onWindowResize)),this._isInitialized=!0}initializeEmbeddedMinimap(){const t=this.data.settings.minimap;if(!t||!1===t.enabled)return void(this.minimap.active=!1);const e="undefined"!=typeof window&&(window.innerWidth||0)<600;let i=this.data.settings.minimap.mode||(e?"disabled":"hover");if("hidden"===i&&(i="disabled"),this.data.settings.minimap.mode=i,"disabled"===i)return void(this.data.settings.minimap.enabled=!1);if(t.persistence&&t.persistence.persistCollapsedState&&"undefined"!=typeof window)try{const e=window.localStorage.getItem(t.persistence.storageKey);null!==e&&(this.data.settings.minimap.collapsed="true"===e)}catch{}"always"===i&&(this.data.settings.minimap.enabled=!0,this.data.settings.minimap.collapsed=!1,this.data.settings.minimap.pinned=!0),"hover"===i&&void 0===this.data.settings.minimap.collapsed&&(this.data.settings.minimap.collapsed=!0);const a=this.main.svg.node().parentElement;try{a.style.position=a.style.position||"relative",a.style.overflow="hidden"}catch{}const s=d3.select(a).append("div").attr("class","zoom-cockpit");this.minimap.cockpit=s,this.minimap.overlay=s;const n=s.append("svg").attr("class","minimap-chrome").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("height","100%").style("pointer-events","all");this.minimap.chromeSvg=n,this.minimap.content=n.append("g").attr("class","minimap-content"),this.minimap.active=!0,this.minimap.state={showTimer:null,hideTimer:null,interacting:!1,wheelTimer:null},this.minimap.collapsedIcon=this.minimap.content.append("g").attr("class","minimap-collapsed-icon").style("cursor","pointer").style("pointer-events","all"),this.minimap.collapsedIcon.append("rect").attr("class","collapsed-icon-bg").attr("width",20).attr("height",14).attr("rx",2).attr("ry",2),this.minimap.collapsedIcon.append("rect").attr("class","collapsed-icon-mini").attr("x",4).attr("y",3).attr("width",12).attr("height",8),this.minimap.collapsedIcon.on("click",(()=>{this.setMinimapCollapsed(!1,!0)})),this.minimap.header=this.minimap.content.append("g").attr("class","minimap-header"),this.minimap.headerHeight=20,this.minimap.collapseButton=this.minimap.header.append("g").attr("class","minimap-collapse-button").style("cursor","pointer"),this.minimap.collapseButton.append("rect").attr("class","collapse-btn-bg").attr("width",16).attr("height",16).attr("rx",3).attr("ry",3),this.minimap.collapseButton.append("path").attr("class","collapse-btn-icon").attr("d","M2,6 L14,6 L8,12 Z"),this.minimap.collapseButton.on("click",(()=>{this.setMinimapCollapsed(!0,!0)})),this.minimap.pinButton=this.minimap.header.append("g").attr("class","minimap-pin-button").style("cursor","pointer").attr("role","button").attr("aria-label","Pin").attr("aria-pressed",String(!!t.pinned)),this.minimap.sizeButton=this.minimap.header.append("g").attr("class","minimap-size-button").style("cursor","pointer"),this.minimap.sizeButton.append("rect").attr("class","btn-bg").attr("width",20).attr("height",16).attr("rx",3).attr("ry",3),this.minimap.sizeLabel=this.minimap.sizeButton.append("text").attr("class","btn-label").attr("x",10).attr("y",10).attr("text-anchor","middle").style("dominant-baseline","middle").style("font-size","10px");const o=()=>{const t=this.data.settings.minimap.size,e="object"==typeof t?t.label||"M":String(t||"m").toUpperCase();this.minimap.sizeLabel.text(e)};o(),this.minimap.sizeButton.on("click",(()=>{const t=this.data.settings.minimap.sizeSwitcher&&this.data.settings.minimap.sizeSwitcher.order||["s","m","l"],e=this.data.settings.minimap.size,i=t.indexOf("object"==typeof e?e.token:e)>=0?t.indexOf("object"==typeof e?e.token:e):t.indexOf("m"),a=t[(i+1)%t.length];if(this.data.settings.minimap.size=a,this.resizeMinimap(),this.minimap.position(),o(),"function"==typeof this.data.settings.minimap.onSizeChange)try{this.data.settings.minimap.onSizeChange({size:a,width:this.minimap.targetWidthPx,height:this.minimap.targetHeightPx})}catch{}})),this.minimap.pinButton.selectAll("*").remove();const h=this.minimap.pinButton.append("g").attr("class","pin-icon");this.minimap.pinBase=h.append("path").attr("class","pin-base").attr("d","M8 2 C9.2 2 10 2.8 10 4 L10 6 L12.5 8 L9 8 L9 12 L7 12 L7 8 L3.5 8 L6 6 L6 4 C6 2.8 6.8 2 8 2 Z").attr("fill","var(--fd-border, rgba(0,0,0,0.85))"),this.minimap.pinSlash=h.append("path").attr("class","pin-slash").attr("d","M3 13 L13 3").attr("stroke","var(--fd-border, rgba(0,0,0,0.85))").attr("stroke-width",2).attr("stroke-linecap","round").style("display",t.pinned?"none":"block"),h.attr("transform",t.pinned?"rotate(0,8,8)":"rotate(-20,8,8)"),this.minimap.pinButton.append("title").text("Pin (toggle pinned / hover)"),this.minimap.pinButton.on("click",(()=>{t.pinned=!t.pinned,this.data.settings.minimap.mode=t.pinned?"always":"hover",this.minimap.state.showTimer&&(clearTimeout(this.minimap.state.showTimer),this.minimap.state.showTimer=null),this.minimap.state.hideTimer&&(clearTimeout(this.minimap.state.hideTimer),this.minimap.state.hideTimer=null),this.minimap.state.interacting=!1,this.updatePinVisualState(),this.minimap.updateHoverBindings()})),this.minimap.svg=this.minimap.content.append("svg").attr("class","minimap-svg"),this.minimap.container=this.minimap.svg.append("g").attr("class","minimap"),this.resizeMinimap(),this.initializeMinimap(),this.minimap.footer=this.minimap.content.append("g").attr("class","minimap-footer"),this.minimap.footerHeight=20,!1!==t.scaleIndicator?.visible&&(this.minimap.scaleText=this.minimap.footer.append("text").attr("class","minimap-scale").attr("text-anchor","end"));const r=(t,e,i)=>{const a=t.append("g").attr("class",`minimap-btn ${e}`).style("cursor","pointer");return a.append("rect").attr("class","btn-bg").attr("width",16).attr("height",16).attr("rx",3).attr("ry",3),a.on("click",(t=>{t.stopPropagation(),i()})),a};this.minimap.controls=this.minimap.footer.append("g").attr("class","minimap-controls"),this.minimap.btnZoomIn=r(this.minimap.controls,"zoom-in",(()=>this.zoomIn())),this.minimap.btnZoomIn.append("rect").attr("class","icon plus-h").attr("x",3).attr("y",7).attr("width",10).attr("height",2),this.minimap.btnZoomIn.append("rect").attr("class","icon plus-v").attr("x",7).attr("y",3).attr("width",2).attr("height",10),this.minimap.btnZoomOut=r(this.minimap.controls,"zoom-out",(()=>this.zoomOut())),this.minimap.btnZoomOut.append("rect").attr("class","icon minus").attr("x",3).attr("y",7).attr("width",10).attr("height",2),this.minimap.btnReset=r(this.minimap.controls,"reset",(()=>this.zoomReset())),this.minimap.btnReset.append("circle").attr("class","icon target-outer").attr("cx",8).attr("cy",8).attr("r",5),this.minimap.btnReset.append("circle").attr("class","icon target-inner").attr("cx",8).attr("cy",8).attr("r",1.5),this.minimap.headerHitRect=this.minimap.header.append("rect").attr("class","minimap-header-hit").attr("fill","transparent"),this.minimap.footerHitRect=this.minimap.footer.append("rect").attr("class","minimap-footer-hit").attr("fill","transparent"),this.minimap.headerHitRect&&this.minimap.headerHitRect.lower(),this.minimap.footerHitRect&&this.minimap.footerHitRect.lower(),this.minimap.header&&this.minimap.header.raise(),this.minimap.footer&&this.minimap.footer.raise(),this.positionEmbeddedMinimap(),this.minimap.updateHoverBindings(),this.minimap.setCollapsed(!0===t.collapsed),this.minimap.updateVisibilityByZoom(),this.minimap.updatePinVisualState()}initializeFullscreenToggle(){const t=this.main.svg.node().parentElement;let e=t.querySelector(".fullscreen-overlay");e||(e=document.createElement("div"),e.className="fullscreen-overlay",e.style.position="absolute",e.style.right="12px",e.style.top="12px",e.style.pointerEvents="auto",t.appendChild(e));let i=e.querySelector(".fullscreen-toggle");i||(i=document.createElement("button"),i.className="fullscreen-toggle",i.setAttribute("aria-label","Toggle fullscreen"),i.title="Maximize / Restore",e.appendChild(i));const a=()=>{const t=this.main.svg.classed("flowdash-fullscreen");i.textContent=t?"⤡":"⤢"},s=()=>{const t=this.main.svg.node().getBoundingClientRect(),e=this.main.width,i=this.main.height,a=this.main.transform.k,s=(this.main.transform.x+e/2)/-a+e/a/2,n=(this.main.transform.y+i/2)/-a+i/a/2,o=t.width,h=t.height;this.main.width=o,this.main.height=h,this.main.divRatio=o/h,this.main.svg.attr("viewBox",[-o/2,-h/2,o,h]);const r=a,d=s-o/r/2,l=n-h/r/2,c=d3.zoomIdentity.translate(-d*r-o/2,-l*r-h/2).scale(r);this.minimap.active&&this.minimap.resize(),this.main.transform={k:r,x:c.x,y:c.y},this.main.container.attr("transform",c),this.main.svg.call(this.main.zoom.transform,c),this.recomputeBaselineFit(),this.minimap.active&&(this.minimap.update(),this.minimap.updateViewport(c),this.minimap.position())},n=()=>{this.main.svg.classed("flowdash-fullscreen")&&s()};i.onclick=()=>{if(this.main.svg.classed("flowdash-fullscreen")){this.main.svg.classed("flowdash-fullscreen",!1).classed("fullscreen",!1),window.removeEventListener("resize",n);const t=this.main.svg.node().getBoundingClientRect();if(this.main.width=t.width,this.main.height=t.height,this.main.divRatio=this.main.width/this.main.height,this.main.svg.attr("viewBox",[-this.main.width/2,-this.main.height/2,this.main.width,this.main.height]),this.minimap.active){this.minimap.svg.attr("viewBox",[-this.main.width/2,-this.main.height/2,this.main.width,this.main.height]),this.minimap.update();const t=d3.zoomIdentity.translate(this.main.transform.x,this.main.transform.y).scale(this.main.transform.k);this.minimap.updateViewport(t),this.minimap.position()}i.classList.remove("fullscreen-active")}else this.main.svg.classed("flowdash-fullscreen",!0).classed("fullscreen",!0),window.addEventListener("resize",n),s(),i.classList.add("fullscreen-active");a()},a()}applyResizePreserveZoom(){const t=this.main.svg.node().getBoundingClientRect(),e=this.main.width||1,i=this.main.height||1,a=this.main.transform.k,s=this.main.transform.x,n=this.main.transform.y,o=t.width||e,h=t.height||i,r=o/e,d=h/i;this.main.width=o,this.main.height=h,this.main.divRatio=o/h,this.main.aspectRatio=this.main.divRatio,this.main.svg.attr("viewBox",[-o/2,-h/2,o,h]);const l=a,c=s*r,m=n*d,g=d3.zoomIdentity.translate(c,m).scale(l);this.minimap.active&&this.minimap.resize(),this.main.transform={k:l,x:c,y:m},this.main.container.attr("transform",g),this.main.svg.call(this.main.zoom.transform,g),this.recomputeBaselineFit(),this.minimap.active&&(this.minimap.update(),this.minimap.updateViewport(g),this.minimap.position(),this.minimap.updateScaleIndicator?.())}updateNodeStatus(t,e){const i=this.main.root.getNode(t);i?i.status=e:console.error("updateNodeStatus: Node not found:",t)}updateDatasetStatus(t,e){let i=!1;const a=this.main.root.getNodesByDatasetId(t);if(a&&a.length>0)for(const t of a)t.status=e,i=!0;return i}createContainer(t,e){return t.svg.selectAll("*").remove(),t.svg.append("g").attr("class",`${e}`)}initializeSvg(t){const e=d3.select(`${t}`);e.selectAll("*").remove();const{width:i,height:a}=e.node().getBoundingClientRect();return e.attr("viewBox",[-i/2,-a/2,i,a]),{svg:e,width:i,height:a,onDragUpdate:null}}createDashboard(t,e,i=null){var a,s,n,o;return function(t){const e=t.append("defs");e.append("marker").attr("id","arrowhead").attr("class","marker arrowhead").attr("viewBox","-0 -5 10 10").attr("refX",10).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("svg:path").attr("class","marker-arrow").attr("d","M 0,-5 L 10 ,0 L 0,5"),e.append("marker").attr("id","arrow").attr("class","marker arrow").attr("viewBox","-0 -5 10 10").attr("refX",10).attr("refY",0).attr("orient","auto-start-reverse").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("svg:path").attr("class","marker-arrowhead").attr("d","M 0,-5 L 10 ,0 L 0,5"),e.append("marker").attr("id","mid-arrow").attr("class","marker arrow").attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("svg:path").attr("class","marker-arrowhead").attr("d","M 0,-5 L 10 ,0 L 0,5"),e.append("marker").attr("class","marker circle").attr("viewBox","-7 -7 14 14").attr("refX",0).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("circle").attr("class","marker-circle").attr("cx",0).attr("cy",0).attr("r",5),e.append("marker").attr("id","circle").attr("class","marker circle").attr("viewBox","-5 -5 10 10").attr("refX",0).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("circle").attr("class","marker-diamond").attr("cx",0).attr("cy",0).attr("r",5),e.append("marker").attr("id","halfcircle").attr("class","marker circle").attr("viewBox","-0 -5 10 10").attr("refX",0).attr("refY",0).attr("orient","auto").attr("markerWidth",4).attr("markerHeight",4).attr("xoverflow","visible").append("circle").attr("class","marker-square").attr("cx",0).attr("cy",0).attr("r",5);const i=e.append("marker").attr("id","circlearrow").attr("class","marker circlearrow").attr("viewBox","0 -10 15 20").attr("refX",0).attr("refY",0).attr("orient","auto").attr("markerWidth",6).attr("markerHeight",6).attr("xoverflow","visible");i.append("circle").attr("class","marker-diamond").attr("cx",0).attr("cy",0).attr("r",7),i.append("svg:path").attr("class","marker-arrow").attr("d","M 0,-5 L 20 ,0 L 0,5")}(e),1==t.nodes.length?(a=j(t.nodes[0],e,t.settings))&&a.move(0,0):(a=function(t,e,i){return j({id:"root",label:"Automatic root",type:"lane",groupType:"dynamic",layout:{size:{width:1e3,height:1e3},display:"content"},children:t},e,i)}(t.nodes,e,t.settings),a&&a.isContainer&&a.move(0,0)),a?(i&&(a.onDisplayChange=i),a.init(),this.initializeChildrenStatusses(a),t.edges.length>0&&(s=a,n=t.edges,o=t.settings,n.forEach((t=>{!function(t,e,i){var a="string"==typeof e.source?e.source:e.source.id,s="string"==typeof e.target?e.target:e.target.id;const n=t.getNode(a);if(!n)return void console.error(`   Creating Edge - Source node ${a} not found`,e);const o=t.getNode(s);o?_(e,n,o,i):console.error(`   Creating Edge - Target node ${s} not found`)}(s,t,o)})),s.initEdges(!0)),this.data.settings.isDebug&&e.append("circle").attr("class","debug-center").attr("cx",0).attr("cy",0).attr("r",5).attr("fill","red").attr("stroke","darkred").attr("stroke-width",2),a):(console.error("Failed to create node - root is null"),null)}initializeChildrenStatusses(t){for(var e=t.getAllNodes(),i=e.length-1;i>=0;i--)!e[i].isContainer||null!=e[i].status&&""!=e[i].status&&"Unknown"!=e[i].status||e[i].determineStatusBasedOnChildren()}initializeZoom(){const t=this,e=d3.zoom().scaleExtent([.1,40]).wheelDelta((t=>-t.deltaY*(t.deltaMode?120:1)*.002)).on("zoom",(t=>this.zoomMain(t)));return this.main.svg.call(e),d3.select("#zoom-in").on("click",(()=>this.zoomIn(t))),d3.select("#zoom-out").on("click",(()=>this.zoomOut(t))),d3.select("#zoom-reset").on("click",(()=>this.zoomReset(t))),d3.select("#zoom-random").on("click",(()=>this.zoomRandom(t))),d3.select("#zoom-node").on("click",(()=>this.zoomToRoot(t))),e}onDragUpdate(){}onMainDisplayChange(){this._displayChangeScheduled||(this._displayChangeScheduled=!0,requestAnimationFrame((()=>{if(this.minimap.svg){if(this.isMainAndMinimapSyncing)return void(this._displayChangeScheduled=!1);this.isMainAndMinimapSyncing=!0,this.minimap.update(),this.isMainAndMinimapSyncing=!1}this.data.settings.zoomToRoot&&!this.hasPerformedInitialZoomToRoot&&(this.zoomToRoot(),this.hasPerformedInitialZoomToRoot=!0),this.minimap.position(),this._initialLoading&&(this._initialLoading=!1,this.hideLoading()),this._displayChangeScheduled=!1})))}zoomMain(t){if(this.isMainAndMinimapSyncing)return;this.isMainAndMinimapSyncing=!0,this.main.transform.k=t.transform.k,this.main.transform.x=t.transform.x,this.main.transform.y=t.transform.y;const e=d3.zoomIdentity.translate(this.main.transform.x,this.main.transform.y).scale(this.main.transform.k);this.main.container.attr("transform",e),this.minimap.active&&this.minimap.scheduleUpdate(t.transform),this.isMainAndMinimapSyncing=!1}zoomMinimap(t){this.isMainAndMinimapSyncing||(this.isMainAndMinimapSyncing=!0,this.main.transform.x=t.transform.x,this.main.transform.y=t.transform.y,this.main.transform.k=t.transform.k,this.main.container.attr("transform",t.transform),this.main.svg.call(this.main.zoom.transform,t.transform),this.minimap.scheduleUpdate(t.transform),this.isMainAndMinimapSyncing=!1)}zoomIn(){this.main.svg.transition().duration(750).call(this.main.zoom.scaleBy,1.2),this.main.scale=this.main.scale*(1+this.main.zoomSpeed)}zoomOut(){this.main.svg.transition().duration(750).call(this.main.zoom.scaleBy,.8),this.main.scale=this.main.scale*(1-this.main.zoomSpeed)}zoomToRoot(){if(!this.main.root)return;const t=this.main.root.getAllNodes(!1);if(!t||0===t.length)return;const e=it(this,t),i=this.computeFitForBoundingBox(e);this.main.fitK=i.k||1,this.main.fitTransform=i.transform,this.minimap.updateScaleIndicator?.(),this.zoomToBoundingBox(e)}zoomReset(){const t=this.main.fitTransform||d3.zoomIdentity;this.main.svg.transition().duration(750).call(this.main.zoom.transform,t),this.main.scale=1,this.minimap.active&&this.minimap.svg.transition().duration(750).call(this.minimap.zoom.transform,t),this.deselectAll()}zoomClicked(t,[e,i]){t.stopPropagation(),this.main.svg.transition().duration(750).call(this.main.zoom.transform,d3.zoomIdentity.translate(this.main.width/2,this.main.height/2).scale(40).translate(-e,-i),d3.pointer(t))}zoomToNodeById(t){const e=this.main.root.getNode(t);return e?this.zoomToNode(e):(console.error("zoomToNodeById: Node not found:",t),null)}setStatusToNodeById(t,e){const i=this.main.root.getNode(t);return i?i.status=e:console.error("setStatusToNodeById: Node not found:",t),null}zoomRandom(t){const e=t.main.root.getAllNodes(),i=e[Math.floor(Math.random()*e.length)];return this.zoomToNode(i)}selectNode(t){t.selected=!t.selected}getSelectedNodes(){return this.main.root.getAllNodes(!0)}getStructure(){if(!this.main.root)return null;var t=this.main.root.getAllNodes(!1,!0);const e=[];return this.main.root.getAllEdges(!1,e),{Nodes:t.map((t=>({Id:t.id}))),Edges:e.map((t=>({Source:t.source.id,Target:t.target.id,Id:t.id})))}}deselectAll(){this.getSelectedNodes().forEach((t=>t.selected=!1));const t=[];this.main.root.getAllEdges(!0,t),t.forEach((t=>t.selected=!1))}zoomToNode(t){const e=t.getNeighbors(this.data.settings.selector);this.deselectAll(),e.nodes.forEach((t=>t.selected=!0)),e.edges.forEach((t=>t.selected=!0));const i=it(this,e.nodes);if(this.data.settings.showBoundingBox){const t=2;this.main.container.selectAll(".boundingBox").remove(),this.main.container.append("rect").attr("class","boundingBox").attr("stroke-width",t).attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height)}return this.main.boundingbox={boundingBox:i,x:i.x,y:i.y,width:i.width,height:i.height,scale:this.main.transform.k},this.zoomToBoundingBox(i),this.main.boundingbox}zoomToBoundingBox(t){const e=this.main.width,i=this.main.height,a=e/t.width,s=i/t.height,n=Math.min(a,s);this.main.transform.x=-t.width*n/2-t.x*n,this.main.transform.y=-t.height*n/2-t.y*n,this.main.transform.k=n;const o=d3.zoomIdentity.translate(this.main.transform.x,this.main.transform.y).scale(this.main.transform.k);this.main.container.attr("transform",o),this.minimap.updateViewport(o),this.minimap.active&&this.minimap.svg.call(this.minimap.zoom.transform,o),this.isMainAndMinimapSyncing=!1}showLoading(){const t=Y(this.main?.svg);q.show(t)}hideLoading(){q.hide()}}function et(t,e){const i=[t];for(const a of e.nodes())(t.data.parentIds.includes(a.data.id)||t.data.childrenIds.includes(a.data.id))&&i.push(a);return i}function it(t,e){let[i,a,s,n]=[1/0,1/0,-1/0,-1/0];return e.forEach((e=>{let o;try{o=S(e.element,t.main.container)}catch{o=null}if(!o||!isFinite(o.width)||!isFinite(o.height)){const t="number"==typeof e.x?e.x:0,o="number"==typeof e.y?e.y:0,h=e.data&&"number"==typeof e.data.width?e.data.width:"number"==typeof e.width?e.width:0,r=e.data&&"number"==typeof e.data.height?e.data.height:"number"==typeof e.height?e.height:0;return i=Math.min(i,t-h/2),a=Math.min(a,o-r/2),s=Math.max(s,t+h/2),void(n=Math.max(n,o+r/2))}i=Math.min(i,o.x),a=Math.min(a,o.y),s=Math.max(s,o.x+o.width),n=Math.max(n,o.y+o.height)})),{x:i-2,y:a-2,width:s-i+4,height:n-a+4}}function at(t,e,i=null){let a=null;if(i&&"string"==typeof i)a=i;else if(i&&"object"==typeof i){const e=t&&t.settings?t.settings:{};t.settings=p.mergeWithDefaults({...e,...i})}const s=new tt(t);return s.initialize(e,a),s}async function st(t,e,i){let a=null;try{showLoading();const s=await K(e);if("function"==typeof i)try{i(s)}catch{}return a=new tt(s),a.initialize(t),a}catch(t){throw hideLoading(),t}}function nt(t,e,i){const a=e.split(".");let s=t;for(let t=0;t<a.length-1;t++)s=s[a[t]];s[a[a.length-1]]=i;try{if(!e.includes("minimap"))return;const a=t,s=a.data?.settings?.minimap;if(!s||!a.minimap?.active)return;const n=()=>{a.minimap?.svg&&a.minimap.resize()};if((e.endsWith("minimap.size")||e.includes(".minimap.size"))&&(n(),a.minimap.update(),a.minimap.scale=Math.min(a.minimap.width/a.main.width,a.minimap.height/a.main.height),a.minimap.position()),(e.endsWith("minimap.position")||e.includes(".minimap.position"))&&a.minimap.position(),(e.endsWith("minimap.collapsedIcon.position")||e.includes(".minimap.collapsedIcon.position"))&&a.minimap.position(),(e.endsWith("minimap.collapsed")||e.includes(".minimap.collapsed"))&&a.minimap.setCollapsed(!!i,!0),e.endsWith("minimap.mode")||e.includes(".minimap.mode")){const t="hidden"===i?"disabled":i;s.mode=t,"always"===t?(s.enabled=!0,s.pinned=!0):"hover"===t?s.pinned=!1:"disabled"===t&&a.minimap.setCollapsed(!0),a.minimap.position(),a.minimap.updateHoverBindings()}(e.endsWith("minimap.pinned")||e.includes(".minimap.pinned"))&&(a.minimap.updatePinVisualState(),a.minimap.updateVisibilityByZoom(),a.minimap.updateHoverBindings()),(e.endsWith("scaleIndicator.visible")||e.includes(".minimap.scaleIndicator.visible"))&&(i?(!a.minimap.scaleText&&a.minimap.footer&&(a.minimap.scaleText=a.minimap.footer.append("text").attr("class","minimap-scale").attr("text-anchor","end")),a.minimap.scaleText.style("display","block")):a.minimap.scaleText&&a.minimap.scaleText.style("display","none"),a.minimap.position(),a.minimap.updateScaleIndicator())}catch(t){console.warn("setDashboardProperty post-update failed",t)}}"undefined"!=typeof window&&(window.showFlowDashLoading=X);const ot={...a,...i};"undefined"!=typeof window&&(window.flowDashboard=ot);const ht=ot;flowdash=e})();