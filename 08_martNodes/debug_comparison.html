<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mart Node Comparison - Full vs Role Mode</title>
    
    <!-- Standard CSS -->
    <link rel="stylesheet" href="../dashboard/flowdash.css">
    <link rel="stylesheet" href="../dashboard/flowdash-demo.css">
    
    <!-- Required Libraries -->
    <script src="../dashboard/libs/d3.min.js"></script>
    <script src="../dashboard/libs/d3-shape.min.js"></script>
    <script src="../dashboard/libs/d3-dag.iife.min.js"></script>
    <script>window.FLOWDASH_THEME = { default: 'light' };</script>
    <script src="../dashboard/js/themeManager.js"></script>
    
    <style>
        .comparison-container {
            display: flex;
            gap: 20px;
            padding: 20px;
        }
        .comparison-item {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }
        .comparison-item h3 {
            margin-top: 0;
            text-align: center;
        }
        .canvas {
            width: 100%;
            height: 300px;
            border: 1px solid #eee;
            background-color: #fafafa;
        }
        .debug-info {
            margin-top: 10px;
            font-size: 12px;
            font-family: monospace;
            background: #f5f5f5;
            padding: 8px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <header class="demo-header">
        <h1>Mart Node Comparison</h1>
        <p class="demo-description">Comparing Full Mode vs Role Mode side by side to debug sizing and edge issues.</p>
    </header>

    <div class="comparison-container">
        <div class="comparison-item">
            <h3>Full Mode</h3>
            <svg id="graph-full" class="canvas"></svg>
            <div id="full-debug" class="debug-info"></div>
        </div>
        <div class="comparison-item">
            <h3>Role Mode</h3>
            <svg id="graph-role" class="canvas"></svg>
            <div id="role-debug" class="debug-info"></div>
        </div>
    </div>

    <script type="module">
        import flowDashboard from '../dashboard/js/index.js';

        const fullModeData = {
            settings: {
                showCenterMark: false,
                showGrid: false,
                showGroupLabels: true,
                showGroupTitles: true,
                showGhostlines: false,
                curved: false,
                showConnectionPoints: true, // Enable to see connection points
                demoMode: true,
                enableTesting: true,
                debugMode: false
            },
            nodes: [
                {
                    id: "mart-full-1",
                    label: "Mart (Full)",
                    code: "MRT-FULL",
                    type: "mart",
                    x: 160,
                    y: 150,
                    layout: {
                        mode: "auto",
                        displayMode: "full",
                        orientation: "horizontal"
                    },
                    status: "active",
                    state: "ready",
                    children: []
                }
            ],
            edges: []
        };

        const roleModeData = {
            settings: {
                showCenterMark: false,
                showGrid: false,
                showGroupLabels: true,
                showGroupTitles: true,
                showGhostlines: false,
                curved: false,
                showConnectionPoints: true, // Enable to see connection points
                demoMode: true,
                enableTesting: true,
                debugMode: false
            },
            nodes: [
                {
                    id: "mart-role-1",
                    label: "Mart (Role)",
                    code: "MRT-ROLE",
                    type: "mart",
                    x: 160,
                    y: 150,
                    layout: {
                        mode: "auto",
                        displayMode: "role",
                        orientation: "horizontal"
                    },
                    status: "active",
                    state: "ready",
                    children: []
                }
            ],
            edges: []
        };

        // Build full mode dashboard
        const fullDash = new flowDashboard.Dashboard(fullModeData);
        fullDash.initialize('#graph-full');

        // Build role mode dashboard
        const roleDash = new flowDashboard.Dashboard(roleModeData);
        roleDash.initialize('#graph-role');

        // Attach to window for debugging
        window.fullDash = fullDash;
        window.roleDash = roleDash;
        
        // Add debug information
        setTimeout(() => {
            const fullNode = fullDash.nodes.find(n => n.id === 'mart-full-1');
            const roleNode = roleDash.nodes.find(n => n.id === 'mart-role-1');
            
            if (fullNode) {
                document.getElementById('full-debug').innerHTML = `
                    Container: ${fullNode.data.width}x${fullNode.data.height}<br>
                    Load: ${fullNode.loadNode?.data.width || 'N/A'}x${fullNode.loadNode?.data.height || 'N/A'}<br>
                    Report: ${fullNode.reportNode?.data.width || 'N/A'}x${fullNode.reportNode?.data.height || 'N/A'}<br>
                    Display Mode: ${fullNode.data.layout.displayMode}
                `;
            }
            
            if (roleNode) {
                document.getElementById('role-debug').innerHTML = `
                    Container: ${roleNode.data.width}x${roleNode.data.height}<br>
                    Load: ${roleNode.loadNode?.data.width || 'N/A'}x${roleNode.loadNode?.data.height || 'N/A'}<br>
                    Report: ${roleNode.reportNode?.data.width || 'N/A'}x${roleNode.reportNode?.data.height || 'N/A'}<br>
                    Display Mode: ${roleNode.data.layout.displayMode}
                `;
            }
        }, 1000);
        
        console.log('Dashboards initialized. Check window.fullDash and window.roleDash for debugging.');
    </script>
</body>
</html>
